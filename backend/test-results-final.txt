
> movietier-backend@1.0.0 test
> jest

[2m[2025-10-29T06:26:35.895Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:35.895Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:35.984Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:36.024Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:36.043Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:36.118Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:36.210Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:36.248Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:38.007Z][0m [36mINFO[0m Profile update request for user 6901b39d1f7b7110f7ae00b0 {
  "name": "updating"
}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:38.119Z][0m [32mSUCCESS[0m Profile updated for user 6901b39d1f7b7110f7ae00b0
🌐 TMDB ⬅️  GET /movie/27205 ERROR 128ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.147Z][0m [36mINFO[0m Profile update request for user 6901b39d1f7b7110f7ae00b0 {
  "name": "unchanged"
}
[2m[2025-10-29T06:26:38.148Z][0m [33mWARN[0m Profile update failed: no name provided
[2m[2025-10-29T06:26:38.155Z][0m [36mINFO[0m Profile update request for user 6901b39d1f7b7110f7ae00b0 {
  "name": "updating"
}
[2m[2025-10-29T06:26:38.159Z][0m [32mSUCCESS[0m Profile updated for user 6901b39d1f7b7110f7ae00b0
[2m[2025-10-29T06:26:38.164Z][0m [36mINFO[0m Profile update request for user 6901b39d1f7b7110f7ae00b0 {
  "name": "unchanged"
}
[2m[2025-10-29T06:26:38.164Z][0m [33mWARN[0m Profile update failed: no name provided
[2m[2025-10-29T06:26:38.169Z][0m [36mINFO[0m Profile update request for user 6901b39d1f7b7110f7ae00b0 {
  "name": "updating"
}
[2m[2025-10-29T06:26:38.169Z][0m [33mWARN[0m Profile update failed: empty name
🌐 TMDB ⬅️  GET /movie/278 ERROR 205ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:38.274Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 76ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/238 ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.351Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.425Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39db703f8fb62cce734",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 74ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.491Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39db703f8fb62cce734",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 118ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 94ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.586Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39db703f8fb62cce734",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 69ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.659Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39db703f8fb62cce734",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 175ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/155 ERROR 72ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:38.787Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 69ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/155 ERROR 86ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.874Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:26:38.948Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 157336,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /search/movie params={"query":"Inception","include_adult":false,"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 120ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.019Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155/similar ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.099Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/157336/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /search/movie ERROR 146ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/157336/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.169Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 157336,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.243Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 77ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155/recommendations ERROR 95ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.338Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/157336/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.411Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 157336,
  "error": "Request failed with status code 401"
}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 120ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 118ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.549Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.621Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 161ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.691Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 147ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 142ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.857Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27206 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 73ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205 ERROR 147ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27206 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:39.929Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27206,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27207 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 75ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205 ERROR 70ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27207 ERROR 101ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.031Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27207,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27208 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27208 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.100Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27208,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27209 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 119ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.143Z][0m [31mERROR[0m Error sending feed notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27209 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.170Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27209,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 73ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/278 ERROR 73ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.242Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27206/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:40.265Z][0m [31mERROR[0m Error sending feed notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/27206/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.314Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27206,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27207/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 123ms: Request failed with status code 401
FAIL tests/unmocked/friendRoutesAdvanced.unmocked.test.ts (9.441 s)
  Advanced Friend Routes Tests
    ✓ should send friend request using email (56 ms)
    ✓ should create bilateral friendship on accept (42 ms)
    ✕ should remove bilateral friendships on delete (19 ms)
    ✓ should reject friend request with accept=false (17 ms)
    ✓ should reject friend request to self (10 ms)
    ✓ should reject duplicate friend request (20 ms)
    ✓ should handle reverse pending request (11 ms)
    ✓ should get all friends with populated data (29 ms)
    ✓ should get pending requests with sender populated (16 ms)
    ✓ should get detailed pending requests (16 ms)
    ✓ should get outgoing friend requests (11 ms)
    ✓ should get detailed outgoing friend requests (29 ms)
    ✓ should handle request to non-existent email (13 ms)
    ✓ should reject invalid email format (5 ms)
    ✓ should reject request without email (8 ms)
    ✓ should handle respond to non-existent request (7 ms)
    ✓ should reject respond to request for different receiver (10 ms)
    ✓ should reject respond to already accepted request (7 ms)
    ✓ should reject respond to already rejected request (9 ms)
    ✓ should handle delete of non-existent friendship (4 ms)
    ✓ should handle delete with invalid friendId format (5 ms)
    ✓ should reject unauthorized access to friends list (3 ms)
    ✓ should reject unauthorized access to pending requests (5 ms)
    ✓ should reject unauthorized friend request (4 ms)
    ✓ should reject unauthorized respond (4 ms)
    ✓ should reject unauthorized delete friendship (4 ms)
    ✓ should handle multiple rapid friend requests (7 ms)
    ✓ should reject request to existing friend (8 ms)
    ✓ should get empty friends list when no friends (19 ms)
    ✓ should get empty pending requests when none exist (5 ms)
    ✓ should get empty detailed requests when none exist (5 ms)
    ✓ should get empty outgoing requests when none exist (5 ms)
    ✓ should get empty detailed outgoing requests when none exist (4 ms)
    ✓ should handle respond with missing accept field (5 ms)
    ✓ should handle respond with missing requestId field (3 ms)
    ✓ should handle complex friendship network (26 ms)
    ✓ should prevent double acceptance of friend request (19 ms)
    ✓ should handle invalid requestId format in respond (4 ms)
    ✓ should only return pending requests, not accepted/rejected (8 ms)
    ✓ should only return outgoing requests from user (9 ms)

  ● Advanced Friend Routes Tests › should remove bilateral friendships on delete

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

      114 |     const count2 = await Friendship.countDocuments({ userId: user2._id, friendId: user1._id });
      115 |
    > 116 |     expect(count1).toBe(0);
          |                    ^
      117 |     expect(count2).toBe(0);
      118 |   });
      119 |

      at Object.<anonymous> (tests/unmocked/friendRoutesAdvanced.unmocked.test.ts:116:20)

🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/200000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27207/similar ERROR 143ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.457Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27207,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000 ERROR 73ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/278 ERROR 111ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/200000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 119ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 95ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.553Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27206/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000 ERROR 70ms: Request failed with status code 401
FAIL tests/unmocked/movieComparisonAdvanced.unmocked.test.ts (9.555 s)
  Advanced Movie Comparison Controller Tests
    ✓ should complete binary search taking left path (79 ms)
    ✓ should complete binary search taking right path (26 ms)
    ✕ should remove movie from watchlist when ranking (20 ms)
    ✓ should handle comparison with 10 existing movies (40 ms)
    ✓ should correctly rank movie at position 1 (15 ms)
    ✓ should correctly rank movie at last position (12 ms)
    ✕ should handle multiple watchlist items during ranking (15 ms)
    ✓ should handle comparison with exact middle movie selection (13 ms)
    ✓ should handle invalid movie ID in comparison (10 ms)
    ✓ should handle comparison without active ranking session (4 ms)
    ✓ should handle ranking with incomplete movie data (6 ms)
    ✓ should handle sequential ranking of multiple movies (13 ms)
    ✓ should handle ranking 15 movies with comparisons (114 ms)
    ✓ should handle all preference combinations in 4-movie ranking (14 ms)
    ✓ should handle deep binary search with 20 movies (36 ms)

  ● Advanced Movie Comparison Controller Tests › should remove movie from watchlist when ranking

    expect(received).toBeNull()

    Received: {"__v": 0, "_id": "6901b39f610bb0c1ece4e2b1", "createdAt": 2025-10-29T06:26:39.140Z, "movieId": 27205, "overview": "A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea.", "posterPath": "/oYm8f6YSxFab6XwaxmTeGa90RWl.jpg", "title": "Inception", "updatedAt": 2025-10-29T06:26:39.140Z, "userId": "6901b39d610bb0c1ece4e28e"}

      165 |       movieId: mockMovies.inception.id
      166 |     });
    > 167 |     expect(watchlistItem).toBeNull();
          |                           ^
      168 |   });
      169 |
      170 |   // Test Case 4: Complex comparison with 10 movies

      at Object.<anonymous> (tests/unmocked/movieComparisonAdvanced.unmocked.test.ts:167:27)

  ● Advanced Movie Comparison Controller Tests › should handle multiple watchlist items during ranking

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 2

      364 |     // Both should be removed from watchlist
      365 |     const count = await WatchlistItem.countDocuments({ userId: user._id });
    > 366 |     expect(count).toBe(0);
          |                   ^
      367 |   });
      368 |
      369 |   // Test Case 8: Comparison with exact middle selection

      at Object.<anonymous> (tests/unmocked/movieComparisonAdvanced.unmocked.test.ts:366:19)

🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27206/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.622Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27206,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27207/recommendations params={"page":1,"api_key":"***"}
[2m[2025-10-29T06:26:40.625Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:40.630Z][0m [31mERROR[0m Error sending feed notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/278 ERROR 72ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27207/recommendations ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.690Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27207,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /trending/movie/week ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.775Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.861Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
[2m[2025-10-29T06:26:40.919Z][0m [32mSUCCESS[0m FCM token registered for user 6901b3a01f7b7110f7ae00b7
[2m[2025-10-29T06:26:40.933Z][0m [32mSUCCESS[0m FCM token registered for user 6901b3a01f7b7110f7ae00b7
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:40.934Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.007Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.086Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.158Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 112ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /trending/movie/week ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.272Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
[2m[2025-10-29T06:26:41.273Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.363Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.436Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.506Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.578Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.649Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:41.718Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b39dfec937ad2b981a5c",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
FAIL tests/unmocked/movieComparisonController.unmocked.test.ts (11.36 s)
  Movie Comparison Controller - Complete Coverage
    ✓ should add first movie with rank 1 (73 ms)
    ✓ should remove from watchlist when adding first movie (238 ms)
    ✓ should create feed activity when adding first movie (28 ms)
    ✓ should delete old feed activities when adding first movie (172 ms)
    ✓ should enrich missing posterPath and overview from TMDB (190 ms)
    ✓ should send SSE notification to friends when adding first movie (236 ms)
    ✓ should handle FCM notification failure gracefully (122 ms)
    ✓ should reject duplicate movie (12 ms)
    ✓ should remove from watchlist even for duplicate movie (13 ms)
    ✓ should start comparison session with existing movies (19 ms)
    ✓ should remove from watchlist when starting comparison (11 ms)
    ✓ should calculate middle index correctly for comparison (10 ms)
    ✕ should reject comparison without active session (8 ms)
    ✓ should handle preferring new movie in comparison (15 ms)
    ✓ should handle preferring existing movie in comparison (12 ms)
    ✕ should finalize ranking when low > high (13 ms)
    ✕ should update ranks when finalizing (13 ms)
    ✓ should create feed activity when finalizing (103 ms)
    ✓ should send notifications when finalizing (131 ms)
    ✓ should continue comparison when not finalized (22 ms)
    ✓ should handle error in addMovie (47 ms)
    ✓ should handle error in compareMovies (35 ms)

  ● Movie Comparison Controller - Complete Coverage › should reject comparison without active session

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      354 |       });
      355 |
    > 356 |     expect(res.status).toBe(400);
          |                        ^
      357 |     expect(res.body.message).toContain('No active comparison');
      358 |   });
      359 |

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:356:24)

  ● Movie Comparison Controller - Complete Coverage › should finalize ranking when low > high

    expect(received).toBe(expected) // Object.is equality

    Expected: "added"
    Received: "compare"

      490 |       });
      491 |
    > 492 |     expect(res.body.status).toBe('added');
          |                             ^
      493 |     const movie = await RankedMovie.findOne({
      494 |       userId: user1._id,
      495 |       movieId: 200000

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:492:29)

  ● Movie Comparison Controller - Complete Coverage › should update ranks when finalizing

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 2

      533 |
      534 |     const movies = await RankedMovie.find({ userId: user1._id }).sort({ rank: 1 });
    > 535 |     expect(movies.length).toBe(3);
          |                           ^
      536 |   });
      537 |
      538 |   it('should create feed activity when finalizing', async () => {

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:535:27)

FAIL tests/unmocked/recommendations.unmocked.test.ts (12.097 s)
  Unmocked: GET /recommendations
    ✓ should return recommendations for user with ranked movies (693 ms)
    ✓ should return empty recommendations for user with no ranked movies (11 ms)
    ✓ should reject unauthenticated recommendation request (5 ms)
  Unmocked: GET /recommendations/trending
    ✕ should return trending movies (81 ms)
    ✓ should reject unauthenticated trending request (3 ms)

  ● Unmocked: GET /recommendations/trending › should return trending movies

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      127 |       .set('Authorization', `Bearer ${token}`);
      128 |
    > 129 |     expect(res.status).toStrictEqual(200);
          |                        ^
      130 |     expect(res.body.success).toBe(true);
      131 |     expect(Array.isArray(res.body.data)).toBe(true);
      132 |   });

      at Object.<anonymous> (tests/unmocked/recommendations.unmocked.test.ts:129:24)

🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:43.254Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41b9a {
  "name": "updating"
}
[2m[2025-10-29T06:26:43.260Z][0m [32mSUCCESS[0m Profile updated for user 6901b3a3fcec224f82b41b9a
[2m[2025-10-29T06:26:43.270Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41ba4 {
  "name": "updating"
}
[2m[2025-10-29T06:26:43.273Z][0m [32mSUCCESS[0m Profile updated for user 6901b3a3fcec224f82b41ba4
[2m[2025-10-29T06:26:43.283Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41bad {
  "name": "unchanged"
}
[2m[2025-10-29T06:26:43.283Z][0m [33mWARN[0m Profile update failed: no name provided
🌐 TMDB ⬅️  GET /movie/157336 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:43.294Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41bb5 {
  "name": "unchanged"
}
[2m[2025-10-29T06:26:43.294Z][0m [33mWARN[0m Profile update failed: no name provided
[2m[2025-10-29T06:26:43.301Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41bbd {
  "name": "updating"
}
[2m[2025-10-29T06:26:43.301Z][0m [33mWARN[0m Profile update failed: empty name
[2m[2025-10-29T06:26:43.308Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41bcb {
  "name": "updating"
}
[2m[2025-10-29T06:26:43.310Z][0m [31mERROR[0m Profile update failed: user 6901b3a3fcec224f82b41bcb not found
[2m[2025-10-29T06:26:43.316Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41bcf {
  "name": "updating"
}
[2m[2025-10-29T06:26:43.318Z][0m [32mSUCCESS[0m Profile updated for user 6901b3a3fcec224f82b41bcf
[2m[2025-10-29T06:26:43.343Z][0m [36mINFO[0m Profile update request for user 6901b3a3fcec224f82b41bd9 {
  "name": "updating"
}
[2m[2025-10-29T06:26:43.345Z][0m [31mERROR[0m Profile update error: {
  "errorLabelSet": {}
}
[2m[2025-10-29T06:26:43.362Z][0m [32mSUCCESS[0m FCM token registered for user 6901b3a3fcec224f82b41be5
[2m[2025-10-29T06:26:43.373Z][0m [32mSUCCESS[0m FCM token registered for user 6901b3a3fcec224f82b41bef
[2m[2025-10-29T06:26:43.382Z][0m [32mSUCCESS[0m FCM token registered for user 6901b3a3fcec224f82b41bfa
[2m[2025-10-29T06:26:43.423Z][0m [31mERROR[0m FCM token registration error: {
  "errorLabelSet": {}
}
FAIL tests/unmocked/allRecommendationRoutes.unmocked.test.ts (12.698 s)
  Comprehensive Recommendation Routes Tests
    ✓ should get recommendations with no ranked movies (38 ms)
    ✓ should get recommendations based on ranked movies (890 ms)
    ✓ should handle recommendations with minimal data (278 ms)
    ✓ should handle recommendations with many ranked movies (999 ms)
    ✓ should get trending movie recommendations (85 ms)
    ✓ should handle trending without auth (4 ms)
    ✓ should incorporate friend rankings in recommendations (227 ms)
    ✓ should handle recommendation query parameters (265 ms)
    ✓ should reject unauthorized recommendation request (8 ms)
    ✓ should handle recommendations with different genres (440 ms)
    ✕ should handle recommendation errors gracefully (3 ms)

  ● Comprehensive Recommendation Routes Tests › should handle recommendation errors gracefully

    ValidationError: RankedMovie validation failed: movieId: Path `movieId` is required., title: Path `title` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1416:9

FAIL tests/unmocked/userRoutes.unmocked.test.ts
  User Routes - Unmocked Tests
    GET /search
      ✓ should search users by name (1261 ms)
      ✓ should search users by email (11 ms)
      ✓ should exclude current user from search results (8 ms)
      ✓ should return empty array when no users match (7 ms)
      ✓ should reject query with less than 2 characters (6 ms)
      ✓ should reject empty query (7 ms)
      ✓ should reject missing query parameter (6 ms)
      ✓ should handle case-insensitive search (8 ms)
      ✓ should limit results to 20 users (18 ms)
      ✓ should trim whitespace from query (9 ms)
      ✓ should handle database error gracefully (47 ms)
    PUT /profile
      ✓ should update user profile name successfully (20 ms)
      ✓ should trim whitespace from name (12 ms)
      ✓ should reject missing name (10 ms)
      ✓ should reject empty name (11 ms)
      ✓ should reject whitespace-only name (6 ms)
      ✓ should handle user not found (10 ms)
      ✓ should preserve other user fields (9 ms)
      ✓ should handle database error gracefully (29 ms)
    POST /fcm-token
      ✓ should register FCM token successfully (15 ms)
      ✓ should update existing FCM token (11 ms)
      ✓ should trim whitespace from token (9 ms)
      ✓ should reject missing token (5 ms)
      ✓ should reject empty token (7 ms)
      ✓ should reject whitespace-only token (7 ms)
      ✓ should handle user not found (11 ms)
      ✓ should handle database error gracefully (15 ms)
    GET /:userId
      ✕ should get user by ID successfully (20 ms)
      ✓ should reject invalid user ID format (7 ms)
      ✕ should handle user not found (8 ms)
      ✕ should return selected fields only (6 ms)
      ✕ should handle database error gracefully (10 ms)
    GET /:userId/watchlist
      ✕ should get user watchlist successfully
      ✕ should return empty array for user with no watchlist items
      ✕ should sort watchlist by createdAt descending
      ✕ should reject invalid user ID format
      ✕ should return watchlist even for non-existent user (empty array)
      ✕ should handle database error gracefully

  ● User Routes - Unmocked Tests › GET /:userId › should get user by ID successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      420 |         .set('Authorization', `Bearer ${token1}`);
      421 |
    > 422 |       expect(res.status).toBe(200);
          |                          ^
      423 |       expect(res.body.success).toBe(true);
      424 |       expect(res.body.data._id).toBe((user2 as any)._id.toString());
      425 |       expect(res.body.data.email).toBe(user2.email);

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:422:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle user not found

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

      445 |
      446 |       expect(res.status).toBe(404);
    > 447 |       expect(res.body.success).toBe(false);
          |                                ^
      448 |       expect(res.body.message).toContain('not found');
      449 |     });
      450 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:447:32)

  ● User Routes - Unmocked Tests › GET /:userId › should return selected fields only

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      454 |         .set('Authorization', `Bearer ${token1}`);
      455 |
    > 456 |       expect(res.status).toBe(200);
          |                          ^
      457 |       expect(res.body.data).toHaveProperty('_id');
      458 |       expect(res.body.data).toHaveProperty('email');
      459 |       expect(res.body.data).toHaveProperty('name');

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:456:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle database error gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 404

      469 |         .set('Authorization', `Bearer ${token1}`);
      470 |
    > 471 |       expect(res.status).toBe(500);
          |                          ^
      472 |       expect(res.body.success).toBe(false);
      473 |       expect(res.body.message).toContain('Unable to load user');
      474 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:471:26)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should get user watchlist successfully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return empty array for user with no watchlist items

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should sort watchlist by createdAt descending

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should reject invalid user ID format

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return watchlist even for non-existent user (empty array)

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should handle database error gracefully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

FAIL tests/unmocked/movieComparison.unmocked.test.ts (13.824 s)
  Unmocked: POST /movies/rank
    ✓ should add first movie without comparison (282 ms)
    ✓ should start comparison for second movie (27 ms)
    ✓ should reject duplicate movie (14 ms)
    ✕ should reject missing required fields (10 ms)
    ✓ should reject unauthenticated rank request (10 ms)
    ✓ should remove movie from watchlist when ranked (100 ms)
  Unmocked: POST /movies/compare
    ✓ should process comparison choice (14 ms)
    ✕ should reject comparison without preferredMovieId (8 ms)
    ✕ should reject comparison without active session (99 ms)
    ✓ should reject unauthenticated compare request (10 ms)

  ● Unmocked: POST /movies/rank › should reject missing required fields

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      150 |       });
      151 |
    > 152 |     expect(res.status).toStrictEqual(400);
          |                        ^
      153 |   });
      154 |
      155 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:152:24)

  ● Unmocked: POST /movies/compare › should reject comparison without preferredMovieId

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      300 |       .send({});
      301 |
    > 302 |     expect(res.status).toStrictEqual(400);
          |                        ^
      303 |   });
      304 |
      305 |   // Input: No active comparison session

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:302:24)

  ● Unmocked: POST /movies/compare › should reject comparison without active session

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 200

      315 |       });
      316 |
    > 317 |     expect(res.status).toStrictEqual(400);
          |                        ^
      318 |   });
      319 |
      320 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:317:24)

[2m[2025-10-29T06:26:44.903Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:44.937Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
FAIL tests/mocked/apis.mocked.test.ts
  Mocked: Feed API Errors
    ✕ should handle feed fetch failure (6 ms)
    ✕ should handle like creation failure (4 ms)
    ✕ should handle invalid comment text (1 ms)
  Mocked: Friends API Errors
    ✕ should handle friends list fetch failure (1 ms)
    ✕ should handle friend request creation failure (1 ms)
    ✕ should handle user lookup failure (2 ms)
  Mocked: Watchlist API Errors
    ✕ should handle watchlist fetch failure (2 ms)
    ✕ should handle watchlist item creation failure (1 ms)
    ✕ should handle watchlist item deletion failure (1 ms)
  Mocked: Recommendations API Errors
    ✕ should handle trending movies fetch failure (2 ms)
    ✕ should handle recommendations generation failure
  Mocked: User API Errors
    ✕ should handle profile update failure (2 ms)
    ✕ should handle FCM token registration failure (1 ms)

  ● Mocked: Feed API Errors › should handle feed fetch failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      44 |       .set('Authorization', `Bearer ${token}`);
      45 |
    > 46 |     expect(res.status).toStrictEqual(500);
         |                        ^
      47 |   });
      48 |
      49 |   // Mocked behavior: Like creation fails due to database error

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:46:24)

  ● Mocked: Feed API Errors › should handle like creation failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      62 |       .send({});
      63 |
    > 64 |     expect(res.status).toStrictEqual(500);
         |                        ^
      65 |   });
      66 |
      67 |   // Mocked behavior: Comment validation fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:64:24)

  ● Mocked: Feed API Errors › should handle invalid comment text

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      76 |       .send({ text: null });
      77 |
    > 78 |     expect(res.status).toStrictEqual(400);
         |                        ^
      79 |   });
      80 | });
      81 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:78:24)

  ● Mocked: Friends API Errors › should handle friends list fetch failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      105 |       .set('Authorization', `Bearer ${token}`);
      106 |
    > 107 |     expect(res.status).toStrictEqual(500);
          |                        ^
      108 |   });
      109 |
      110 |   // Mocked behavior: Friend request database error

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:107:24)

  ● Mocked: Friends API Errors › should handle friend request creation failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      123 |       .send({ email: 'test@example.com' });
      124 |
    > 125 |     expect(res.status).toStrictEqual(500);
          |                        ^
      126 |   });
      127 |
      128 |   // Mocked behavior: User lookup fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:125:24)

  ● Mocked: Friends API Errors › should handle user lookup failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      141 |       .send({ email: 'nonexistent@example.com' });
      142 |
    > 143 |     expect(res.status).toStrictEqual(500);
          |                        ^
      144 |   });
      145 | });
      146 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:143:24)

  ● Mocked: Watchlist API Errors › should handle watchlist fetch failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      170 |       .set('Authorization', `Bearer ${token}`);
      171 |
    > 172 |     expect(res.status).toStrictEqual(500);
          |                        ^
      173 |   });
      174 |
      175 |   // Mocked behavior: Item creation fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:172:24)

  ● Mocked: Watchlist API Errors › should handle watchlist item creation failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      188 |       .send({ movieId: 278, title: 'Movie' });
      189 |
    > 190 |     expect(res.status).toStrictEqual(500);
          |                        ^
      191 |   });
      192 |
      193 |   // Mocked behavior: Delete operation fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:190:24)

  ● Mocked: Watchlist API Errors › should handle watchlist item deletion failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      205 |       .set('Authorization', `Bearer ${token}`);
      206 |
    > 207 |     expect(res.status).toStrictEqual(500);
          |                        ^
      208 |   });
      209 | });
      210 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:207:24)

  ● Mocked: Recommendations API Errors › should handle trending movies fetch failure

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [500, 200]

      235 |       .set('Authorization', `Bearer ${token}`);
      236 |
    > 237 |     expect([500, 200]).toContain(res.status); // May cache or fail
          |                        ^
      238 |   });
      239 |
      240 |   // Mocked behavior: Database query fails for recommendations

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:237:24)

  ● Mocked: Recommendations API Errors › should handle recommendations generation failure

    Property `find` does not exist in the provided object

      244 |   // Expected output: Error message
      245 |   it('should handle recommendations generation failure', async () => {
    > 246 |     jest.spyOn(require('../../src/models/movie/RankedMovie'), 'find')
          |          ^
      247 |       .mockRejectedValueOnce(new Error('Database error'));
      248 |
      249 |     const res = await request(app)

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:246:10)

  ● Mocked: User API Errors › should handle profile update failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      281 |       .send({ name: 'New Name' });
      282 |
    > 283 |     expect(res.status).toStrictEqual(500);
          |                        ^
      284 |   });
      285 |
      286 |   // Mocked behavior: FCM token registration fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:283:24)

  ● Mocked: User API Errors › should handle FCM token registration failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      299 |       .send({ token: 'eODL6-Yk3jg:APA91bE...' });
      300 |
    > 301 |     expect(res.status).toStrictEqual(500);
          |                        ^
      302 |   });
      303 | });
      304 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:301:24)

FAIL tests/mocked/movie.mocked.test.ts
  Mocked: GET /movies/search - TMDB API Failure
    ✓ should handle TMDB API server error (6 ms)
    ✓ should handle TMDB API timeout (3 ms)
    ✕ should return empty array for no matching results (2 ms)
    ✓ should handle invalid TMDB API key (3 ms)
  Mocked: Movie Comparison and Addition - Database Failures
    ✓ should handle ranking creation database error (7 ms)
    ✕ should reject duplicate movie ranking (2 ms)
  Mocked: GET /movies/ranked - Database Query Failure
    ✕ should handle ranked movies query failure (2 ms)
  Mocked: DELETE /movies/ranked/:id - Database Errors
    ✓ should handle rank adjustment failure (4 ms)

  ● Mocked: GET /movies/search - TMDB API Failure › should return empty array for no matching results

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      75 |       .query({ query: 'xyz123nonexistent' });
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      79 |   });
      80 |

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:77:24)

  ● Mocked: Movie Comparison and Addition - Database Failures › should reject duplicate movie ranking

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      153 |       });
      154 |
    > 155 |     expect(res.status).toStrictEqual(400);
          |                        ^
      156 |     findOneySpy.mockRestore();
      157 |   });
      158 | });

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:155:24)

  ● Mocked: GET /movies/ranked - Database Query Failure › should handle ranked movies query failure

    Database connection lost

      175 |   it('should handle ranked movies query failure', async () => {
      176 |     const findSpy = jest.spyOn(RankedMovie, 'find')
    > 177 |       .mockRejectedValueOnce(new Error('Database connection lost'));
          |                              ^
      178 |
      179 |     const res = await request(app)
      180 |       .get('/api/movies/ranked')

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:177:30)

🌐 TMDB ➡️  GET  params={"query":"test","api_key":"***"}
🌐 TMDB ➡️  GET  params={"api_key":"***"}
🌐 TMDB ➡️  GET /test params={"api_key":"***"}
🌐 TMDB ➡️  GET /movie/123 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /test params={"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/123 200 100ms
🌐 TMDB ⬅️  GET /test 200 150ms
🌐 TMDB ⬅️  GET /test ERROR 50ms: Network Error
🌐 TMDB ⬅️  GET  ERROR: Network Error
FAIL tests/mocked/tmdbServices.mocked.test.ts
  TMDB Client Tests
    ✓ should create axios instance with correct baseURL (2 ms)
    ✓ should add API key to request params (2 ms)
    ✓ should use TMDB_KEY environment variable as fallback
    ✓ should handle request with no existing params (1 ms)
    ✕ should log outgoing request (1 ms)
    ✕ should redact API key in request logs (1 ms)
    ✕ should log successful response (1 ms)
    ✕ should calculate and log response time (1 ms)
    ✕ should log error response (1 ms)
    ✕ should handle error without config
  TMDB Tagline Service Tests
    ✓ should fetch tagline successfully (1 ms)
    ✓ should return cached tagline on cache hit
    ✓ should refetch after cache expires (1 ms)
    ✓ should search without year parameter (1 ms)
    ✓ should return null when no search results
    ✓ should return null when result has no ID (1 ms)
    ✓ should return null when movie has no tagline
    ✓ should return null when movie has empty tagline (1 ms)
    ✓ should return null on API error (1 ms)
    ✕ should treat titles as case-insensitive for caching (3 ms)
    ✓ should create different cache entries for same title with different years (1 ms)
    ✕ should handle year as string parameter (1 ms)
    ✓ should trim whitespace from title for cache key (1 ms)
    ✓ should include year in search query (1 ms)
    ✓ should send correct search parameters (1 ms)

  ● TMDB Client Tests › should log outgoing request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ➡️"

    Number of calls: 0

      140 |     getTmdbClient();
      141 |
    > 142 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      143 |       expect.stringContaining('TMDB ➡️')
      144 |     );
      145 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:142:27)

  ● TMDB Client Tests › should redact API key in request logs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "***"

    Number of calls: 0

      167 |     getTmdbClient();
      168 |
    > 169 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      170 |       expect.stringContaining('***')
      171 |     );
      172 |     expect(consoleLogSpy).not.toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:169:27)

  ● TMDB Client Tests › should log successful response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ⬅️"

    Number of calls: 0

      201 |     responseInterceptor(mockResponse);
      202 |
    > 203 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      204 |       expect.stringContaining('TMDB ⬅️')
      205 |     );
      206 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:203:27)

  ● TMDB Client Tests › should calculate and log response time

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringMatching /\d+ms/

    Number of calls: 0

      235 |     responseInterceptor(mockResponse);
      236 |
    > 237 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      238 |       expect.stringMatching(/\d+ms/)
      239 |     );
      240 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:237:27)

  ● TMDB Client Tests › should log error response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "ERROR"

    Number of calls: 0

      266 |     expect(() => errorInterceptor(mockError)).toThrow();
      267 |
    > 268 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      269 |       expect.stringContaining('ERROR')
      270 |     );
      271 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:268:27)

  ● TMDB Client Tests › should handle error without config

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      292 |
      293 |     expect(() => errorInterceptor(mockError)).toThrow();
    > 294 |     expect(consoleLogSpy).toHaveBeenCalled();
          |                           ^
      295 |   });
      296 | });
      297 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:294:27)

  ● TMDB Tagline Service Tests › should treat titles as case-insensitive for caching

    expect(received).toBe(expected) // Object.is equality

    Expected: "Cached"
    Received: "An amazing movie"

      519 |     const tagline = await fetchMovieTagline('TEST MOVIE', 2024);
      520 |
    > 521 |     expect(tagline).toBe('Cached');
          |                     ^
      522 |     expect(mockClient.get).toHaveBeenCalledTimes(2);
      523 |   });
      524 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:521:21)

  ● TMDB Tagline Service Tests › should handle year as string parameter

    expect(received).toBe(expected) // Object.is equality

    Expected: "String year"
    Received: "New tagline"

      570 |     const tagline = await fetchMovieTagline('Movie', '2024');
      571 |
    > 572 |     expect(tagline).toBe('String year');
          |                     ^
      573 |   });
      574 |
      575 |   // Test Case 23: Trim whitespace from title

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:572:21)

[2m[2025-10-29T06:26:45.229Z][0m [36mINFO[0m Test info message
FAIL tests/unmocked/rerankController.unmocked.test.ts
  Rerank Controller - Complete Coverage
    ✓ should reject missing rankedId (9 ms)
    ✓ should reject invalid rankedId format (4 ms)
    ✓ should reject empty string rankedId (3 ms)
    ✓ should reject null rankedId (3 ms)
    ✓ should return 404 when ranked movie not found (6 ms)
    ✓ should return 404 when trying to rerank another users movie (110 ms)
    ✓ should remove movie and decrement ranks of higher movies (22 ms)
    ✓ should handle removing movie from rank 1 (11 ms)
    ✓ should handle removing movie from last rank (12 ms)
    ✓ should insert at rank 1 when list becomes empty (8 ms)
    ✓ should preserve movie data when reinserting after empty list (10 ms)
    ✓ should start comparison session with remaining movies (13 ms)
    ✓ should calculate correct middle index for comparison (14 ms)
    ✓ should return compareWith with all required fields (12 ms)
    ✓ should handle movie without posterPath (9 ms)
    ✓ should handle rerank with 2 movies (10 ms)
    ✓ should handle rerank with 20 movies (20 ms)
    ✓ should handle database error gracefully (55 ms)
    ✓ should handle error during rank update (19 ms)
    ✕ should handle reranking immediately after ranking (8 ms)
    ✕ should handle movie with special characters in title (1 ms)
    ✕ should handle rerank of movie with very long title

  ● Rerank Controller - Complete Coverage › should handle reranking immediately after ranking

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      529 |       .send({ rankedId: (movie as any)._id.toString() });
      530 |
    > 531 |     expect(res.status).toBe(200);
          |                        ^
      532 |     expect(res.body.status).toBe('added');
      533 |   });
      534 |

      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:531:24)

  ● Rerank Controller - Complete Coverage › should handle movie with special characters in title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

  ● Rerank Controller - Complete Coverage › should handle rerank of movie with very long title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

[2m[2025-10-29T06:26:45.273Z][0m [36mINFO[0m User logged in {
  "userId": "123",
  "email": "test@example.com"
}
[2m[2025-10-29T06:26:45.273Z][0m [36mINFO[0m Multiple args arg1 123 true
[2m[2025-10-29T06:26:45.274Z][0m [32mSUCCESS[0m Operation completed
[2m[2025-10-29T06:26:45.275Z][0m [32mSUCCESS[0m Movie ranked {
  "movieId": 550,
  "rank": 1
}
[2m[2025-10-29T06:26:45.275Z][0m [33mWARN[0m API rate limit approaching
[2m[2025-10-29T06:26:45.276Z][0m [33mWARN[0m Slow query detected {
  "duration": 5000,
  "query": "complex query"
}
[2m[2025-10-29T06:26:45.276Z][0m [31mERROR[0m Database connection failed
[2m[2025-10-29T06:26:45.277Z][0m [31mERROR[0m Unexpected error {
  "error": "Something went wrong",
  "stack": "stack trace"
}
[2m[2025-10-29T06:26:45.277Z][0m [35mDEBUG[0m Debug information
[2m[2025-10-29T06:26:45.278Z][0m [35mDEBUG[0m State dump {
  "user": {
    "id": 1,
    "name": "Test"
  },
  "session": {
    "active": true
  }
}
[2m[2025-10-29T06:26:45.279Z][0m [1m[34mGET[0m /api/movies [32m200[0m [2m(45ms)[0m
[2m[2025-10-29T06:26:45.283Z][0m [1m[34mPOST[0m /api/auth/signin [32m[0m
[2m[2025-10-29T06:26:45.284Z][0m [1m[34mDELETE[0m /api/friends/123 [32m204[0m
[2m[2025-10-29T06:26:45.285Z][0m [1m[34mGET[0m /api/users [32m200[0m [2m(10ms)[0m
[2m[2025-10-29T06:26:45.285Z][0m [1m[34mPOST[0m /api/movies [31m404[0m [2m(20ms)[0m
[2m[2025-10-29T06:26:45.287Z][0m [1m[34mGET[0m /api/recommendations [31m500[0m [2m(100ms)[0m
[2m[2025-10-29T06:26:45.287Z][0m [1m[34mPUT[0m /api/profile [32m200[0m
[2m[2025-10-29T06:26:45.287Z][0m [1m[34mPATCH[0m /api/movies/123 [32m200[0m
[2m[2025-10-29T06:26:45.287Z][0m [1m[34mHEAD[0m /api/health [32m200[0m
[2m[2025-10-29T06:26:45.289Z][0m [36mINFO[0m Test message
[2m[2025-10-29T06:26:45.289Z][0m [36mINFO[0m Message string arg
[2m[2025-10-29T06:26:45.290Z][0m [36mINFO[0m Message 42 3.14
[2m[2025-10-29T06:26:45.290Z][0m [36mINFO[0m Message true false
[2m[2025-10-29T06:26:45.291Z][0m [36mINFO[0m Message {
  "key": "value",
  "nested": {
    "data": 123
  }
}
[2m[2025-10-29T06:26:45.291Z][0m [36mINFO[0m Message [
  1,
  2,
  3
]
[2m[2025-10-29T06:26:45.293Z][0m [36mINFO[0m Message null undefined
[2m[2025-10-29T06:26:45.293Z][0m [36mINFO[0m Message {}
[2m[2025-10-29T06:26:45.294Z][0m [36mINFO[0m Message []
[2m[2025-10-29T06:26:45.295Z][0m [36mINFO[0m Message 1
[2m[2025-10-29T06:26:45.295Z][0m [32mSUCCESS[0m Message 2
[2m[2025-10-29T06:26:45.295Z][0m [33mWARN[0m Message 3
[2m[2025-10-29T06:26:45.295Z][0m [31mERROR[0m Message 4
[2m[2025-10-29T06:26:45.297Z][0m [36mINFO[0m Complex data {
  "user": {
    "id": 123,
    "profile": {
      "name": "Test User",
      "preferences": {
        "theme": "dark",
        "notifications": true
      }
    }
  },
  "timestamp": "2025-10-29T06:26:45.297Z"
}
FAIL tests/unit/logger.unit.test.ts
  Logger Utility
    info
      ✕ should log info message (32 ms)
      ✕ should log info message with arguments (1 ms)
      ✕ should handle multiple arguments (1 ms)
    success
      ✕ should log success message
      ✕ should log success with object data
    warn
      ✕ should log warning message
      ✕ should log warning with details
    error
      ✕ should log error message (1 ms)
      ✕ should log error with error object
    debug
      ✕ should log debug message in development mode
      ✓ should NOT log debug message in production mode (1 ms)
      ✓ should NOT log debug message when NODE_ENV is test
      ✕ should log debug with detailed data in development
    http
      ✕ should log HTTP request with all parameters (1 ms)
      ✕ should log HTTP request without status code (1 ms)
      ✕ should log HTTP request without duration
      ✕ should handle successful status codes (200-399)
      ✕ should handle error status codes (400+)
      ✕ should handle server error status codes (500+) (1 ms)
      ✕ should handle various HTTP methods (1 ms)
    Timestamp formatting
      ✕ should include ISO timestamp in all log messages
    Argument formatting
      ✕ should format string arguments
      ✕ should format number arguments
      ✕ should format boolean arguments (1 ms)
      ✕ should format object arguments as JSON
      ✕ should format array arguments (1 ms)
      ✕ should handle null and undefined arguments
      ✕ should handle empty object (1 ms)
      ✕ should handle empty array
    Integration scenarios
      ✕ should handle rapid sequential log calls (1 ms)
      ✕ should handle complex nested objects

  ● Logger Utility › info › should log info message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      23 |       logger.info('Test info message');
      24 |
    > 25 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      26 |       const call = consoleLogSpy.mock.calls[0][0];
      27 |       expect(call).toContain('INFO');
      28 |       expect(call).toContain('Test info message');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:25:29)

  ● Logger Utility › info › should log info message with arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      32 |       logger.info('User logged in', { userId: '123', email: 'test@example.com' });
      33 |
    > 34 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      35 |       const call = consoleLogSpy.mock.calls[0][0];
      36 |       expect(call).toContain('INFO');
      37 |       expect(call).toContain('User logged in');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:34:29)

  ● Logger Utility › info › should handle multiple arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      43 |       logger.info('Multiple args', 'arg1', 123, true);
      44 |
    > 45 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      46 |       const call = consoleLogSpy.mock.calls[0][0];
      47 |       expect(call).toContain('arg1');
      48 |       expect(call).toContain('123');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:45:29)

  ● Logger Utility › success › should log success message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      55 |       logger.success('Operation completed');
      56 |
    > 57 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      58 |       const call = consoleLogSpy.mock.calls[0][0];
      59 |       expect(call).toContain('SUCCESS');
      60 |       expect(call).toContain('Operation completed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:57:29)

  ● Logger Utility › success › should log success with object data

    TypeError: Cannot read properties of undefined (reading '0')

      64 |       logger.success('Movie ranked', { movieId: 550, rank: 1 });
      65 |
    > 66 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      67 |       expect(call).toContain('SUCCESS');
      68 |       expect(call).toContain('Movie ranked');
      69 |       expect(call).toContain('movieId');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:66:47)

  ● Logger Utility › warn › should log warning message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      75 |       logger.warn('API rate limit approaching');
      76 |
    > 77 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      78 |       const call = consoleLogSpy.mock.calls[0][0];
      79 |       expect(call).toContain('WARN');
      80 |       expect(call).toContain('API rate limit approaching');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:77:29)

  ● Logger Utility › warn › should log warning with details

    TypeError: Cannot read properties of undefined (reading '0')

      84 |       logger.warn('Slow query detected', { duration: 5000, query: 'complex query' });
      85 |
    > 86 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      87 |       expect(call).toContain('WARN');
      88 |       expect(call).toContain('Slow query detected');
      89 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:86:47)

  ● Logger Utility › error › should log error message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      94 |       logger.error('Database connection failed');
      95 |
    > 96 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      97 |       const call = consoleLogSpy.mock.calls[0][0];
      98 |       expect(call).toContain('ERROR');
      99 |       expect(call).toContain('Database connection failed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:96:29)

  ● Logger Utility › error › should log error with error object

    TypeError: Cannot read properties of undefined (reading '0')

      104 |       logger.error('Unexpected error', { error: error.message, stack: 'stack trace' });
      105 |
    > 106 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      107 |       expect(call).toContain('ERROR');
      108 |       expect(call).toContain('Unexpected error');
      109 |       expect(call).toContain('Something went wrong');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:106:47)

  ● Logger Utility › debug › should log debug message in development mode

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      117 |       logger.debug('Debug information');
      118 |
    > 119 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      120 |       const call = consoleLogSpy.mock.calls[0][0];
      121 |       expect(call).toContain('DEBUG');
      122 |       expect(call).toContain('Debug information');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:119:29)

  ● Logger Utility › debug › should log debug with detailed data in development

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      147 |       });
      148 |
    > 149 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      150 |       const call = consoleLogSpy.mock.calls[0][0];
      151 |       expect(call).toContain('DEBUG');
      152 |       expect(call).toContain('State dump');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:149:29)

  ● Logger Utility › http › should log HTTP request with all parameters

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      158 |       logger.http('GET', '/api/movies', 200, 45);
      159 |
    > 160 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      161 |       const call = consoleLogSpy.mock.calls[0][0];
      162 |       expect(call).toContain('GET');
      163 |       expect(call).toContain('/api/movies');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:160:29)

  ● Logger Utility › http › should log HTTP request without status code

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      169 |       logger.http('POST', '/api/auth/signin');
      170 |
    > 171 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      172 |       const call = consoleLogSpy.mock.calls[0][0];
      173 |       expect(call).toContain('POST');
      174 |       expect(call).toContain('/api/auth/signin');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:171:29)

  ● Logger Utility › http › should log HTTP request without duration

    TypeError: Cannot read properties of undefined (reading '0')

      178 |       logger.http('DELETE', '/api/friends/123', 204);
      179 |
    > 180 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      181 |       expect(call).toContain('DELETE');
      182 |       expect(call).toContain('/api/friends/123');
      183 |       expect(call).toContain('204');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:180:47)

  ● Logger Utility › http › should handle successful status codes (200-399)

    TypeError: Cannot read properties of undefined (reading '0')

      187 |       logger.http('GET', '/api/users', 200, 10);
      188 |
    > 189 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      190 |       expect(call).toContain('200');
      191 |     });
      192 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:189:47)

  ● Logger Utility › http › should handle error status codes (400+)

    TypeError: Cannot read properties of undefined (reading '0')

      194 |       logger.http('POST', '/api/movies', 404, 20);
      195 |
    > 196 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      197 |       expect(call).toContain('404');
      198 |     });
      199 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:196:47)

  ● Logger Utility › http › should handle server error status codes (500+)

    TypeError: Cannot read properties of undefined (reading '0')

      201 |       logger.http('GET', '/api/recommendations', 500, 100);
      202 |
    > 203 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      204 |       expect(call).toContain('500');
      205 |       expect(call).toContain('100ms');
      206 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:203:47)

  ● Logger Utility › http › should handle various HTTP methods

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 3
    Received number of calls: 0

      211 |       logger.http('HEAD', '/api/health', 200);
      212 |
    > 213 |       expect(consoleLogSpy).toHaveBeenCalledTimes(3);
          |                             ^
      214 |       expect(consoleLogSpy.mock.calls[0][0]).toContain('PUT');
      215 |       expect(consoleLogSpy.mock.calls[1][0]).toContain('PATCH');
      216 |       expect(consoleLogSpy.mock.calls[2][0]).toContain('HEAD');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:213:29)

  ● Logger Utility › Timestamp formatting › should include ISO timestamp in all log messages

    TypeError: Cannot read properties of undefined (reading '0')

      222 |       logger.info('Test message');
      223 |
    > 224 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      225 |       // ISO format: YYYY-MM-DDTHH:mm:ss.sssZ
      226 |       expect(call).toMatch(/\[\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z\]/);
      227 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:224:47)

  ● Logger Utility › Argument formatting › should format string arguments

    TypeError: Cannot read properties of undefined (reading '0')

      232 |       logger.info('Message', 'string arg');
      233 |
    > 234 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      235 |       expect(call).toContain('string arg');
      236 |     });
      237 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:234:47)

  ● Logger Utility › Argument formatting › should format number arguments

    TypeError: Cannot read properties of undefined (reading '0')

      239 |       logger.info('Message', 42, 3.14);
      240 |
    > 241 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      242 |       expect(call).toContain('42');
      243 |       expect(call).toContain('3.14');
      244 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:241:47)

  ● Logger Utility › Argument formatting › should format boolean arguments

    TypeError: Cannot read properties of undefined (reading '0')

      247 |       logger.info('Message', true, false);
      248 |
    > 249 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      250 |       expect(call).toContain('true');
      251 |       expect(call).toContain('false');
      252 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:249:47)

  ● Logger Utility › Argument formatting › should format object arguments as JSON

    TypeError: Cannot read properties of undefined (reading '0')

      255 |       logger.info('Message', { key: 'value', nested: { data: 123 } });
      256 |
    > 257 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      258 |       expect(call).toContain('"key"');
      259 |       expect(call).toContain('"value"');
      260 |       expect(call).toContain('"nested"');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:257:47)

  ● Logger Utility › Argument formatting › should format array arguments

    TypeError: Cannot read properties of undefined (reading '0')

      264 |       logger.info('Message', [1, 2, 3]);
      265 |
    > 266 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      267 |       expect(call).toContain('[');
      268 |       expect(call).toContain('1');
      269 |       expect(call).toContain('2');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:266:47)

  ● Logger Utility › Argument formatting › should handle null and undefined arguments

    TypeError: Cannot read properties of undefined (reading '0')

      274 |       logger.info('Message', null, undefined);
      275 |
    > 276 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      277 |       expect(call).toContain('null');
      278 |       expect(call).toContain('undefined');
      279 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:276:47)

  ● Logger Utility › Argument formatting › should handle empty object

    TypeError: Cannot read properties of undefined (reading '0')

      282 |       logger.info('Message', {});
      283 |
    > 284 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      285 |       expect(call).toContain('{}');
      286 |     });
      287 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:284:47)

  ● Logger Utility › Argument formatting › should handle empty array

    TypeError: Cannot read properties of undefined (reading '0')

      289 |       logger.info('Message', []);
      290 |
    > 291 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      292 |       expect(call).toContain('[]');
      293 |     });
      294 |   });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:291:47)

  ● Logger Utility › Integration scenarios › should handle rapid sequential log calls

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 4
    Received number of calls: 0

      301 |       logger.error('Message 4');
      302 |
    > 303 |       expect(consoleLogSpy).toHaveBeenCalledTimes(4);
          |                             ^
      304 |     });
      305 |
      306 |     it('should handle complex nested objects', () => {

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:303:29)

  ● Logger Utility › Integration scenarios › should handle complex nested objects

    TypeError: Cannot read properties of undefined (reading '0')

      321 |       logger.info('Complex data', complexObject);
      322 |
    > 323 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      324 |       expect(call).toContain('Complex data');
      325 |       expect(call).toContain('user');
      326 |       expect(call).toContain('profile');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:323:47)

[2m[2025-10-29T06:26:45.324Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
FAIL tests/unmocked/allFeedRoutes.unmocked.test.ts
  Comprehensive Feed Routes Tests
    ✕ should get empty feed with no friends
    ✕ should get feed with friend activities
    ✕ should like a feed activity
    ✕ should handle duplicate like
    ✕ should unlike a feed activity
    ✕ should get comments for activity
    ✕ should add comment to activity
    ✕ should handle empty comment
    ✕ should handle long comment
    ✕ should handle liking non-existent activity
    ✕ should handle unliking when no like exists
    ✕ should handle commenting on non-existent activity
    ✕ should handle feed pagination
    ✕ should get multiple comments
    ✕ should handle different activity types
    ✕ should reject unauthorized feed access
    ✕ should handle invalid activity ID format

  ● Comprehensive Feed Routes Tests › should get empty feed with no friends

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should get feed with friend activities

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should like a feed activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle duplicate like

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should unlike a feed activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should get comments for activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should add comment to activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle empty comment

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle long comment

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle liking non-existent activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle unliking when no like exists

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle commenting on non-existent activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle feed pagination

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should get multiple comments

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle different activity types

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should reject unauthorized feed access

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle invalid activity ID format

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

FAIL tests/unmocked/userProfile.unmocked.test.ts (14.489 s)
  Unmocked: PUT /users/profile
    ✕ should update user profile name (147 ms)
    ✕ should update user profile image (11 ms)
    ✕ should update multiple profile fields (9 ms)
    ✓ should reject empty name (4 ms)
    ✓ should reject whitespace-only name (6 ms)
    ✓ should reject unauthenticated profile update (4 ms)
    ✓ should reject invalid token (2 ms)
  Unmocked: POST /users/fcm-token
    ✓ should register FCM token (122 ms)
    ✓ should update existing FCM token (12 ms)
    ✓ should reject missing FCM token (12 ms)
    ✓ should reject empty FCM token (2 ms)
    ✓ should reject unauthenticated FCM token registration (2 ms)
  Unmocked: GET /users/profile/:userId
    ✕ should get user profile by ID (11 ms)
    ✕ should get own profile (3 ms)
    ✓ should return 404 for non-existent user (1 ms)
    ✕ should reject invalid user ID format (2 ms)
    ✕ should reject unauthenticated profile request (1 ms)

  ● Unmocked: PUT /users/profile › should update user profile name

    TypeError: Cannot read properties of undefined (reading 'name')

      47 |
      48 |     expect(res.status).toStrictEqual(200);
    > 49 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      50 |
      51 |     const updatedUser = await User.findById(user._id);
      52 |     expect(updatedUser!.name).toStrictEqual(newName);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:49:26)

  ● Unmocked: PUT /users/profile › should update user profile image

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      64 |       .send({ profileImageUrl: newImageUrl });
      65 |
    > 66 |     expect(res.status).toStrictEqual(200);
         |                        ^
      67 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      68 |
      69 |     const updatedUser = await User.findById(user._id);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:66:24)

  ● Unmocked: PUT /users/profile › should update multiple profile fields

    TypeError: Cannot read properties of undefined (reading 'name')

      88 |
      89 |     expect(res.status).toStrictEqual(200);
    > 90 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      91 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      92 |   });
      93 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:90:26)

  ● Unmocked: GET /users/profile/:userId › should get user profile by ID

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      283 |       .set('Authorization', `Bearer ${token}`);
      284 |
    > 285 |     expect(res.status).toStrictEqual(200);
          |                        ^
      286 |     expect(res.body.user).toBeDefined();
      287 |     expect(res.body.user.email).toStrictEqual(otherUser.email);
      288 |   });

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:285:24)

  ● Unmocked: GET /users/profile/:userId › should get own profile

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      297 |       .set('Authorization', `Bearer ${token}`);
      298 |
    > 299 |     expect(res.status).toStrictEqual(200);
          |                        ^
      300 |     expect(res.body.user.email).toStrictEqual(user.email);
      301 |   });
      302 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:299:24)

  ● Unmocked: GET /users/profile/:userId › should reject invalid user ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      323 |       .set('Authorization', `Bearer ${token}`);
      324 |
    > 325 |     expect(res.status).toStrictEqual(400);
          |                        ^
      326 |   });
      327 |
      328 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:325:24)

  ● Unmocked: GET /users/profile/:userId › should reject unauthenticated profile request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      334 |       .get(`/api/users/profile/${otherUser._id}`);
      335 |
    > 336 |     expect(res.status).toStrictEqual(401);
          |                        ^
      337 |   });
      338 | });
      339 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:336:24)

[2m[2025-10-29T06:26:45.475Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:26:45.582Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
FAIL tests/mocked/friendRoutes.mocked.test.ts
  Friend Routes - Mocked Error Tests
    GET / (friends list) error handling
      ✓ should handle database error gracefully (984 ms)
    GET /requests error handling
      ✓ should handle database error gracefully (15 ms)
    GET /requests/detailed error handling
      ✓ should handle database error gracefully (10 ms)
    GET /requests/outgoing error handling
      ✓ should handle database error gracefully (7 ms)
    GET /requests/outgoing/detailed error handling
      ✓ should handle database error gracefully (7 ms)
    POST /request error handling
      ✓ should return 401 when authenticated user not found in database (16 ms)
      ✓ should handle database error when creating friend request (12 ms)
      ✕ should handle notification service failure gracefully (12 ms)
    POST /respond error handling
      ✓ should handle database error when finding friend request (9 ms)
      ✓ should handle database error when creating friendships (16 ms)
      ✓ should handle notification failure when accepting request (18 ms)
    DELETE /:friendId error handling
      ✓ should handle database error gracefully (10 ms)
      ✓ should return 404 when friendship not found (11 ms)
    Additional edge cases
      ✓ should handle missing accept field in respond request (8 ms)
      ✓ should handle missing requestId field in respond request (6 ms)
      ✓ should reject friend request when user not found (7 ms)
      ✓ should reject responding to non-existent friend request (7 ms)
      ✓ should reject responding to request not directed to user (9 ms)

  ● Friend Routes - Mocked Error Tests › POST /request error handling › should handle notification service failure gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      194 |
      195 |       // Should still succeed even if notification fails
    > 196 |       expect(res.status).toBe(200);
          |                          ^
      197 |       expect(res.body.success).toBe(true);
      198 |     });
      199 |   });

      at Object.<anonymous> (tests/mocked/friendRoutes.mocked.test.ts:196:26)

FAIL tests/unmocked/watchlistOperations.unmocked.test.ts (15.18 s)
  Unmocked: POST /watchlist - Additional Tests
    ✕ should add movie to watchlist with all fields (232 ms)
    ✓ should add movie with only required fields (96 ms)
    ✕ should reject duplicate movie in watchlist (14 ms)
    ✓ should reject missing movieId (6 ms)
    ✓ should reject missing title (6 ms)
    ✕ should reject missing year (87 ms)
    ✕ should reject missing posterUrl (129 ms)
    ✓ should reject unauthenticated watchlist addition (4 ms)
    ✓ should add multiple movies to watchlist (243 ms)
  Unmocked: DELETE /watchlist/:movieId - Additional Tests
    ✕ should delete movie from watchlist (10 ms)
    ✓ should return 404 for non-existent movie (5 ms)
    ✕ should delete only specified movie from watchlist (5 ms)
    ✕ should reject unauthenticated delete request (3 ms)
    ✕ should handle invalid movieId format (22 ms)
  Unmocked: GET /watchlist - Additional Tests
    ✕ should get multiple watchlist items (13 ms)
    ✕ should return only authenticated user watchlist (36 ms)
    ✕ should return empty array for empty watchlist (6 ms)
    ✓ should reject unauthenticated get watchlist request (4 ms)
    ✕ should return complete movie details in watchlist (15 ms)

  ● Unmocked: POST /watchlist - Additional Tests › should add movie to watchlist with all fields

    expect(received).toBeDefined()

    Received: undefined

      61 |     expect(res.status).toStrictEqual(201);
      62 |     expect(res.body.success).toStrictEqual(true);
    > 63 |     expect(res.body.watchlistItem).toBeDefined();
         |                                    ^
      64 |     expect(res.body.watchlistItem.movieId).toStrictEqual(mockMovies.inception.id);
      65 |
      66 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:63:36)

  ● Unmocked: POST /watchlist - Additional Tests › should reject duplicate movie in watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      119 |       });
      120 |
    > 121 |     expect(res.status).toStrictEqual(400);
          |                        ^
      122 |     expect(res.body.message).toMatch(/already|watchlist/i);
      123 |   });
      124 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:121:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing year

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      171 |       });
      172 |
    > 173 |     expect(res.status).toStrictEqual(400);
          |                        ^
      174 |   });
      175 |
      176 |   // Input: Missing posterUrl

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:173:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing posterUrl

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      188 |       });
      189 |
    > 190 |     expect(res.status).toStrictEqual(400);
          |                        ^
      191 |   });
      192 |
      193 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:190:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      296 |       .set('Authorization', `Bearer ${token}`);
      297 |
    > 298 |     expect(res.status).toStrictEqual(200);
          |                        ^
      299 |     expect(res.body.success).toStrictEqual(true);
      300 |
      301 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:298:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete only specified movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      343 |       .set('Authorization', `Bearer ${token}`);
      344 |
    > 345 |     expect(res.status).toStrictEqual(200);
          |                        ^
      346 |
      347 |     const deletedItem = await WatchlistItem.findOne({
      348 |       userId: user._id,

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:345:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should reject unauthenticated delete request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      366 |       .delete(`/api/watchlist/${mockMovies.inception.id}`);
      367 |
    > 368 |     expect(res.status).toStrictEqual(401);
          |                        ^
      369 |   });
      370 |
      371 |   // Input: Invalid movieId format

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:368:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should handle invalid movieId format

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [400, 404]

      378 |       .set('Authorization', `Bearer ${token}`);
      379 |
    > 380 |     expect([400, 404]).toContain(res.status);
          |                        ^
      381 |   });
      382 | });
      383 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:380:24)

  ● Unmocked: GET /watchlist - Additional Tests › should get multiple watchlist items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      443 |
      444 |     expect(res.status).toStrictEqual(200);
    > 445 |     expect(Array.isArray(res.body.watchlist || res.body)).toBe(true);
          |                                                           ^
      446 |     const watchlist = res.body.watchlist || res.body;
      447 |     expect(watchlist.length).toStrictEqual(2);
      448 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:445:59)

  ● Unmocked: GET /watchlist - Additional Tests › should return only authenticated user watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 1
    Received: undefined

      475 |     expect(res.status).toStrictEqual(200);
      476 |     const watchlist = res.body.watchlist || res.body;
    > 477 |     expect(watchlist.length).toStrictEqual(1);
          |                              ^
      478 |     expect(watchlist[0].movieId).toStrictEqual(mockMovies.inception.id);
      479 |   });
      480 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:477:30)

  ● Unmocked: GET /watchlist - Additional Tests › should return empty array for empty watchlist

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      490 |     expect(res.status).toStrictEqual(200);
      491 |     const watchlist = res.body.watchlist || res.body;
    > 492 |     expect(Array.isArray(watchlist)).toBe(true);
          |                                      ^
      493 |     expect(watchlist.length).toStrictEqual(0);
      494 |   });
      495 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:492:38)

  ● Unmocked: GET /watchlist - Additional Tests › should return complete movie details in watchlist

    TypeError: Cannot read properties of undefined (reading 'title')

      527 |     expect(res.status).toStrictEqual(200);
      528 |     const watchlist = res.body.watchlist || res.body;
    > 529 |     expect(watchlist[0].title).toStrictEqual(mockMovies.inception.title);
          |                         ^
      530 |     expect(watchlist[0].year).toStrictEqual(mockMovies.inception.year);
      531 |     expect(watchlist[0].rating).toStrictEqual(mockMovies.inception.rating);
      532 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:529:25)

FAIL tests/unmocked/quote.unmocked.test.ts
  Unmocked: GET /quotes
    ✕ should return quote for movie (9 ms)
    ✕ should return fallback quote for unknown movie (2 ms)
    ✕ should reject unauthenticated quote request (2 ms)
    ✕ should reject quote request without title (2 ms)

  ● Unmocked: GET /quotes › should return quote for movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      45 |       .query({ title: 'Inception' });
      46 |
    > 47 |     expect(res.status).toStrictEqual(200);
         |                        ^
      48 |     expect(res.body).toHaveProperty('quote');
      49 |   });
      50 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:47:24)

  ● Unmocked: GET /quotes › should return fallback quote for unknown movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      59 |       .query({ title: 'NonexistentMoviexyz123' });
      60 |
    > 61 |     expect(res.status).toStrictEqual(200);
         |                        ^
      62 |     expect(res.body).toHaveProperty('quote');
      63 |   });
      64 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:61:24)

  ● Unmocked: GET /quotes › should reject unauthenticated quote request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      72 |       .query({ title: 'Inception' });
      73 |
    > 74 |     expect(res.status).toStrictEqual(401);
         |                        ^
      75 |   });
      76 |
      77 |   // Input: Missing title query parameter

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:74:24)

  ● Unmocked: GET /quotes › should reject quote request without title

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      84 |       .set('Authorization', `Bearer ${token}`);
      85 |
    > 86 |     expect(res.status).toStrictEqual(400);
         |                        ^
      87 |   });
      88 | });
      89 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:86:24)

[2m[2025-10-29T06:26:46.365Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
FAIL tests/unmocked/watchlistRoutes.unmocked.test.ts
  Watchlist Routes - Unmocked Tests
    GET /
      ✓ should get user watchlist successfully (713 ms)
      ✓ should return empty array for empty watchlist (11 ms)
      ✓ should only return current user watchlist items (16 ms)
      ✓ should sort watchlist by createdAt descending (39 ms)
      ✓ should handle database error gracefully (88 ms)
    POST /
      ✓ should add movie to watchlist successfully (59 ms)
      ✓ should add movie with minimal fields (movieId and title only) (25 ms)
      ✓ should enrich missing posterPath from TMDB (58 ms)
      ✓ should enrich missing overview from TMDB (25 ms)
      ✓ should handle TMDB enrichment failure gracefully (18 ms)
      ✓ should reject missing movieId (8 ms)
      ✓ should reject missing title (13 ms)
      ✓ should reject duplicate movie (15 ms)
      ✓ should allow different users to add same movie (15 ms)
      ✓ should handle movieId as number (11 ms)
      ✓ should preserve all provided fields (13 ms)
      ✓ should handle database save error gracefully (22 ms)
    DELETE /:movieId
      ✓ should remove movie from watchlist successfully (46 ms)
      ✓ should only remove from current user watchlist (28 ms)
      ✓ should return 404 when movie not in watchlist (17 ms)
      ✓ should handle movieId as number parameter (49 ms)
      ✓ should handle invalid movieId format gracefully (27 ms)
      ✓ should handle database error gracefully (23 ms)
      ✓ should not affect other watchlist items (37 ms)
    Edge Cases
      ✕ should handle very long movie titles (33 ms)
      ✕ should handle special characters in title (13 ms)
      ✓ should handle zero as movieId (10 ms)
      ✕ should handle large movieId numbers (16 ms)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle very long movie titles

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      521 |         });
      522 |
    > 523 |       expect(res.status).toBe(200);
          |                          ^
      524 |       expect(res.body.data.title).toBe(longTitle);
      525 |     });
      526 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:523:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle special characters in title

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      536 |         });
      537 |
    > 538 |       expect(res.status).toBe(200);
          |                          ^
      539 |       expect(res.body.data.title).toBe(specialTitle);
      540 |     });
      541 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:538:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle large movieId numbers

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      565 |         });
      566 |
    > 567 |       expect(res.status).toBe(200);
          |                          ^
      568 |       expect(res.body.data.movieId).toBe(largeId);
      569 |     });
      570 |   });

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:567:26)

🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 119ms: Request failed with status code 401
[2m[2025-10-29T06:26:47.791Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:47.864Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:47.934Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.017Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.090Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:48.129Z][0m [36mINFO[0m Profile update request for user 6901b3a78eb8222e6d55c71b {
  "name": "updating"
}
🌐 TMDB ⬅️  GET /movie/278 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.162Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.235Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
[2m[2025-10-29T06:26:48.294Z][0m [32mSUCCESS[0m Profile updated for user 6901b3a78eb8222e6d55c71b
[2m[2025-10-29T06:26:48.300Z][0m [36mINFO[0m Profile update request for user 6901b3a78eb8222e6d55c71b {
  "name": "unchanged"
}
[2m[2025-10-29T06:26:48.300Z][0m [33mWARN[0m Profile update failed: no name provided
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.307Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.378Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 76ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.455Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.527Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.596Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 83ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/100000 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.677Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100001 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.751Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100002 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.822Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100003 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.892Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 85ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100004 ERROR 102ms: Request failed with status code 401
[2m[2025-10-29T06:26:48.995Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 72ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100005 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.066Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 72ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/100006 ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.142Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100007 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.211Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100000/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.280Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 112ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100001/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.352Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100002/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.424Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 115ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
FAIL tests/unmocked/movie.unmocked.test.ts (18.506 s)
  Unmocked: GET /movies/search
    ✕ should return search results for valid movie query (244 ms)
    ✓ should reject search query shorter than 2 characters (8 ms)
    ✓ should reject empty search query (4 ms)
    ✓ should reject unauthenticated search (4 ms)
  Unmocked: GET /movies/ranked
    ✓ should return user ranked movies sorted by rank (34 ms)
    ✓ should return empty array for user with no ranked movies (60 ms)
    ✓ should reject unauthenticated ranked movies request (5 ms)
  Unmocked: DELETE /movies/ranked/:id
    ✕ should delete ranked movie and adjust ranks (13 ms)
    ✓ should reject deletion of non-existent movie (6 ms)
    ✓ should reject deletion with invalid ID format (9 ms)

  ● Unmocked: GET /movies/search › should return search results for valid movie query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      46 |       .query({ query: 'Inception' });
      47 |
    > 48 |     expect(res.status).toStrictEqual(200);
         |                        ^
      49 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      50 |   });
      51 |

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:48:24)

  ● Unmocked: DELETE /movies/ranked/:id › should delete ranked movie and adjust ranks

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      216 |       .set('Authorization', `Bearer ${token}`);
      217 |
    > 218 |     expect(res.status).toStrictEqual(200);
          |                        ^
      219 |
      220 |     // Verify movie is deleted
      221 |     const remaining = await RankedMovie.find({ userId: user._id });

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:218:24)

🌐 TMDB ⬅️  GET /movie/100003/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.492Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100004/similar params={"language":"en-US","page":1,"api_key":"***"}
FAIL tests/unmocked/auth.unmocked.test.ts (18.659 s)
  Unmocked: POST /auth/signin
    ✕ should successfully sign in an existing user (865 ms)
    ✓ should reject signin without idToken (83 ms)
    ✕ should reject signin for non-existent user (6 ms)
  Unmocked: POST /auth/signup
    ✕ should successfully create a new user account (19 ms)
    ✓ should reject signup without idToken (7 ms)
    ✕ should reject signup with existing email (586 ms)
  Unmocked: POST /auth/signout
    ✓ should successfully sign out authenticated user (687 ms)
    ✓ should reject signout without authentication token (171 ms)
    ✓ should reject signout with invalid token (13 ms)
  Unmocked: DELETE /auth/account
    ✓ should successfully delete user account and cascade delete related data (1126 ms)
    ✓ should reject account deletion without authentication (8 ms)
    ✓ should reject account deletion with invalid token (6 ms)

  ● Unmocked: POST /auth/signin › should successfully sign in an existing user

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      63 |       });
      64 |
    > 65 |     expect(res.status).toStrictEqual(200);
         |                        ^
      66 |     expect(res.body).toHaveProperty('user');
      67 |     expect(res.body).toHaveProperty('token');
      68 |     expect(res.body.user.email).toStrictEqual('test@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:65:24)

  ● Unmocked: POST /auth/signin › should reject signin for non-existent user

    expect(received).toMatch(expected)

    Expected pattern: /not found|error/i
    Received string:  "Invalid Google token"

      101 |
      102 |     expect([400, 404]).toContain(res.status);
    > 103 |     expect(res.body.message).toMatch(/not found|error/i);
          |                              ^
      104 |   });
      105 | });
      106 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:103:30)

  ● Unmocked: POST /auth/signup › should successfully create a new user account

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 201
    Received: 400

      143 |       });
      144 |
    > 145 |     expect(res.status).toStrictEqual(201);
          |                        ^
      146 |     expect(res.body).toHaveProperty('user');
      147 |     expect(res.body).toHaveProperty('token');
      148 |     expect(res.body.user.email).toStrictEqual('newuser@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:145:24)

  ● Unmocked: POST /auth/signup › should reject signup with existing email

    expect(received).toMatch(expected)

    Expected pattern: /already exists|duplicate/i
    Received string:  "Invalid Google token"

      194 |
      195 |     expect(res.status).toStrictEqual(400);
    > 196 |     expect(res.body.message).toMatch(/already exists|duplicate/i);
          |                              ^
      197 |   });
      198 | });
      199 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:196:30)

🌐 TMDB ⬅️  GET /movie/27205 ERROR 167ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100004/similar ERROR 142ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.635Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100000/recommendations params={"page":1,"api_key":"***"}
[2m[2025-10-29T06:26:49.645Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ⬅️  GET /movie/155 ERROR 73ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/100000/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.711Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 70ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
FAIL tests/unmocked/friendOperations.unmocked.test.ts (18.828 s)
  Unmocked: POST /friends/request - Additional Tests
    ✓ should send friend request by email (55 ms)
    ✓ should reject friend request to self (13 ms)
    ✕ should reject duplicate friend request (18 ms)
    ✕ should reject request to existing friend (28 ms)
    ✓ should reject request without email (9 ms)
    ✓ should reject invalid email format (5 ms)
  Unmocked: POST /friends/respond - Additional Tests
    ✕ should accept friend request (9 ms)
    ✕ should reject friend request (11 ms)
    ✓ should reject invalid action (6 ms)
    ✕ should return 404 for non-existent request (14 ms)
    ✓ should reject missing requestId (5 ms)
    ✓ should reject missing action (4 ms)
  Unmocked: DELETE /friends/:friendId - Additional Tests
    ✕ should remove friend (bidirectional) (565 ms)
    ✓ should return 404 for non-existent friend (34 ms)
    ✕ should reject invalid friend ID format (7 ms)
    ✕ should reject removing self (6 ms)
  Unmocked: GET /friends/search - Search Users
    ✕ should search users by email (7 ms)
    ✕ should search users by name (3 ms)
    ✕ should reject empty search query (3 ms)
    ✕ should return empty array for no matches (2 ms)

  ● Unmocked: POST /friends/request - Additional Tests › should reject duplicate friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      104 |       .send({ email: user2.email });
      105 |
    > 106 |     expect(res.status).toStrictEqual(400);
          |                        ^
      107 |     expect(res.body.message).toMatch(/already|pending/i);
      108 |   });
      109 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:106:24)

  ● Unmocked: POST /friends/request - Additional Tests › should reject request to existing friend

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      124 |       .send({ email: user2.email });
      125 |
    > 126 |     expect(res.status).toStrictEqual(400);
          |                        ^
      127 |     expect(res.body.message).toMatch(/already.*friend/i);
      128 |   });
      129 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:126:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should accept friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      209 |       });
      210 |
    > 211 |     expect(res.status).toStrictEqual(200);
          |                        ^
      212 |     expect(res.body.success).toStrictEqual(true);
      213 |
      214 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:211:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should reject friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      241 |       });
      242 |
    > 243 |     expect(res.status).toStrictEqual(200);
          |                        ^
      244 |     expect(res.body.success).toStrictEqual(true);
      245 |
      246 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:243:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should return 404 for non-existent request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 404
    Received: 400

      284 |       });
      285 |
    > 286 |     expect(res.status).toStrictEqual(404);
          |                        ^
      287 |   });
      288 |
      289 |   // Input: Missing requestId

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:286:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should remove friend (bidirectional)

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      369 |       .set('Authorization', `Bearer ${token1}`);
      370 |
    > 371 |     expect(res.status).toStrictEqual(200);
          |                        ^
      372 |     expect(res.body.success).toStrictEqual(true);
      373 |
      374 |     const friendship1 = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:371:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject invalid friend ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      407 |       .set('Authorization', `Bearer ${token1}`);
      408 |
    > 409 |     expect(res.status).toStrictEqual(400);
          |                        ^
      410 |   });
      411 |
      412 |   // Input: Remove self as friend

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:409:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject removing self

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      419 |       .set('Authorization', `Bearer ${token1}`);
      420 |
    > 421 |     expect(res.status).toStrictEqual(400);
          |                        ^
      422 |   });
      423 | });
      424 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:421:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by email

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      463 |       .query({ query: 'searchable' });
      464 |
    > 465 |     expect(res.status).toStrictEqual(200);
          |                        ^
      466 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      467 |   });
      468 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:465:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by name

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      477 |       .query({ query: 'Searchable' });
      478 |
    > 479 |     expect(res.status).toStrictEqual(200);
          |                        ^
      480 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      481 |   });
      482 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:479:24)

  ● Unmocked: GET /friends/search - Search Users › should reject empty search query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      491 |       .query({ query: '' });
      492 |
    > 493 |     expect(res.status).toStrictEqual(400);
          |                        ^
      494 |   });
      495 |
      496 |   // Input: Search with no matches

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:493:24)

  ● Unmocked: GET /friends/search - Search Users › should return empty array for no matches

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      504 |       .query({ query: 'nonexistentuser12345' });
      505 |
    > 506 |     expect(res.status).toStrictEqual(200);
          |                        ^
      507 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      508 |   });
      509 | });

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:506:24)

🌐 TMDB ⬅️  GET /movie/100001/recommendations ERROR 140ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.852Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100002/recommendations params={"page":1,"api_key":"***"}
FAIL tests/nfr/performance.test.ts (18.954 s)
  NFR: Performance - Response Time
    ✕ should respond to GET /movies/ranked within acceptable time (28 ms)
    ✕ should sign out user within acceptable time (31 ms)
    ✕ should limit feed results to prevent memory bloat (233 ms)
  NFR: Performance - Database Index Efficiency
    ✕ should efficiently fetch ranked movies using indexes (28 ms)
  NFR: Performance - Bulk Operations
    ✕ should complete cascade delete within acceptable time (276 ms)

  ● NFR: Performance - Response Time › should respond to GET /movies/ranked within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      60 |     const responseTime = Date.now() - startTime;
      61 |
    > 62 |     expect(res.status).toStrictEqual(200);
         |                        ^
      63 |     expect(responseTime).toBeLessThan(ACCEPTABLE_RESPONSE_TIME_MS);
      64 |   });
      65 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:62:24)

  ● NFR: Performance - Response Time › should sign out user within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      75 |     const responseTime = Date.now() - startTime;
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(responseTime).toBeLessThan(500);
      79 |   });
      80 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:77:24)

  ● NFR: Performance - Response Time › should limit feed results to prevent memory bloat

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      117 |       .set('Authorization', `Bearer ${token}`);
      118 |
    > 119 |     expect(res.status).toStrictEqual(200);
          |                        ^
      120 |     expect(Array.isArray(res.body)).toBe(true);
      121 |     // Feed should limit results, verify it's not unbounded
      122 |     expect(res.body.length).toBeLessThanOrEqual(50);

      at Object.<anonymous> (tests/nfr/performance.test.ts:119:24)

  ● NFR: Performance - Database Index Efficiency › should efficiently fetch ranked movies using indexes

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      166 |     const queryTime = Date.now() - startTime;
      167 |
    > 168 |     expect(res.status).toStrictEqual(200);
          |                        ^
      169 |     expect(Array.isArray(res.body)).toBe(true);
      170 |     expect(res.body.length).toBe(100);
      171 |     // With proper indexing, 100 items should still be fast

      at Object.<anonymous> (tests/nfr/performance.test.ts:168:24)

  ● NFR: Performance - Bulk Operations › should complete cascade delete within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      236 |     const deleteTime = Date.now() - startTime;
      237 |
    > 238 |     expect(res.status).toStrictEqual(200);
          |                        ^
      239 |     expect(deleteTime).toBeLessThan(ACCEPTABLE_BULK_TIME_MS);
      240 |   });
      241 | });

      at Object.<anonymous> (tests/nfr/performance.test.ts:238:24)

🌐 TMDB ⬅️  GET /movie/100002/recommendations ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:26:49.920Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 100002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ⬅️  GET /movie/155 ERROR 122ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.009Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.082Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.155Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.229Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.303Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.375Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.445Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.513Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.587Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.670Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200001 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.743Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200002 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/feedRoutes.mocked.test.ts
  Feed Routes - Mocked Error Tests
    GET / (friends feed) error handling
      ✓ should handle TMDB enrichment errors gracefully (1653 ms)
      ✓ should handle database error gracefully (9 ms)
    GET /me error handling
      ✓ should handle TMDB enrichment errors gracefully (18 ms)
      ✓ should handle database error gracefully (8 ms)
    GET /stream error handling
      ✓ should handle SSE setup errors gracefully (7 ms)
    POST /:activityId/like error handling
      ✓ should handle notification errors gracefully (22 ms)
      ✓ should handle duplicate like error (18 ms)
      ✓ should handle database error gracefully (14 ms)
    DELETE /:activityId/like error handling
      ✓ should handle database error gracefully (9 ms)
    GET /:activityId/comments error handling
      ✓ should handle database error gracefully (8 ms)
    POST /:activityId/comments error handling
      ✓ should handle notification errors gracefully (31 ms)
      ✓ should handle database error gracefully (14 ms)

🌐 TMDB ⬅️  GET /movie/200002 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.812Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200003 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.884Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200004 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:50.958Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200005 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:50.984Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ⬅️  GET /movie/200005 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.031Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200006 params={"language":"en-US","api_key":"***"}
PASS tests/unmocked/allMovieRoutes.unmocked.test.ts
  Comprehensive Movie Routes Tests
    ✓ should rank first movie directly (149 ms)
    ✓ should trigger comparison when ranking second movie (86 ms)
    ✓ should handle movie comparison (87 ms)
    ✓ should delete ranked movie and adjust ranks (8 ms)
    ✓ should get all ranked movies in order (8 ms)
    ✓ should handle watchlist removal when ranking movie (126 ms)
    ✓ should handle ranking with missing fields (7 ms)
    ✓ should handle comparison without session (4 ms)
    ✓ should handle deleting non-existent movie (4 ms)
    ✓ should handle duplicate movie ranking (129 ms)
    ✓ should handle multiple movie rankings (361 ms)
    ✓ should handle comparison with invalid movie ID (141 ms)

[2m[2025-10-29T06:26:51.093Z][0m [32mSUCCESS[0m FCM token registered for user 6901b3aa8eb8222e6d55c722
🌐 TMDB ⬅️  GET /movie/200006 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.103Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200007 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.173Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200008 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.245Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200009 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200009 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.318Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.391Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200001/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.460Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200002/similar ERROR 77ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.537Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200003/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.610Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200004/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.681Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200005/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.754Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.827Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200001/recommendations params={"page":1,"api_key":"***"}
PASS tests/mocked/movieComparisionController.mocked.test.ts
  Movie Comparison Controller - Mocked Tests
    POST /add
      Case 1: First movie (empty ranking)
        ✓ should add first movie without comparison (1085 ms)
        ✓ should remove from watchlist when adding first movie (124 ms)
        ✓ should enrich missing poster and overview from TMDB (14 ms)
        ✓ should create feed activity when adding first movie (13 ms)
        ✓ should notify friends via SSE when adding first movie (21 ms)
        ✓ should send FCM notification to friends with tokens (19 ms)
        ✓ should handle TMDB enrichment failure gracefully (13 ms)
        ✓ should handle FCM notification failure gracefully (21 ms)
      Case 2: Duplicate movie
        ✓ should reject duplicate movie (17 ms)
        ✓ should remove from watchlist even when rejecting duplicate (15 ms)
      Case 3: Begin comparison
        ✓ should start comparison session for second movie (12 ms)
        ✓ should remove from watchlist when starting comparison (14 ms)
        ✓ should use middle index for first comparison (21 ms)
      Error handling
        ✓ should handle database errors gracefully (9 ms)
    POST /compare
      ✓ should return error when no active session (20 ms)
      ✓ should continue comparison when not finished (24 ms)
      ✓ should insert movie when comparison finishes (prefer new) (44 ms)
      ✓ should insert movie at correct position (prefer existing) (70 ms)
      ✓ should remove from watchlist when finalizing insert (31 ms)
      ✓ should enrich with TMDB data when finalizing (28 ms)
      ✓ should create feed activity when finalizing (37 ms)
      ✓ should notify friends when finalizing (39 ms)
      ✓ should send FCM notification when finalizing (67 ms)
      ✓ should handle TMDB enrichment failure when finalizing (40 ms)
      ✓ should handle FCM notification failure when finalizing (29 ms)
      ✓ should handle database errors gracefully (12 ms)

🌐 TMDB ⬅️  GET /movie/200001/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.901Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200002/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:51.973Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200003/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.042Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 200003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300000 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:26:52.143Z][0m [36mINFO[0m Sign in attempt for email: test@example.com
[2m[2025-10-29T06:26:52.145Z][0m [36mINFO[0m Sign in attempt for email: test@example.com
[2m[2025-10-29T06:26:52.149Z][0m [36mINFO[0m Sign up attempt for email: existing@example.com
[2m[2025-10-29T06:26:52.149Z][0m [33mWARN[0m Sign up failed: user already exists for existing@example.com
🌐 TMDB ⬅️  GET /movie/300000 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.150Z][0m [36mINFO[0m Sign up attempt for email: newuser@example.com
[2m[2025-10-29T06:26:52.151Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300001 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/auth.mocked.test.ts
  Mocked: POST /auth/signin
    ✓ should handle Google token verification error (6 ms)
    ✓ should handle database error during signin (3 ms)
    ✓ should handle JWT generation failure (2 ms)
    ✓ should successfully sign in with valid credentials (2 ms)
  Mocked: POST /auth/signup
    ✓ should handle database duplicate key error (1 ms)
    ✓ should handle database write failure (2 ms)
    ✓ should reject invalid Google token during signup (1 ms)
    ✓ should successfully sign up with valid credentials (2 ms)
  Mocked: POST /auth/signout
    ✓ should reject signout with tampered JWT (2 ms)
    ✓ should reject signout with expired token (4 ms)
  Mocked: DELETE /auth/account
    ✓ should handle cascading delete failure (4 ms)
    ✓ should reject deletion with invalid token signature (2 ms)

🌐 TMDB ⬅️  GET /movie/300001 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.222Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300002 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/notificationService.mocked.test.ts
  Notification Service Tests - Mocked
    ✓ should send feed notification successfully (12 ms)
    ✓ should handle invalid registration token error (2 ms)
    ✓ should handle registration token not registered error (2 ms)
    ✓ should handle generic sending error (1 ms)
    ✓ should send friend request notification (2 ms)
    ✓ should send friend request accepted notification (1 ms)
    ✓ should send like notification (2 ms)
    ✓ should send comment notification (3 ms)
    ✓ should truncate long comments in notification (2 ms)
    ✓ should send multicast notification to multiple tokens (2 ms)
    ✓ should handle multicast with partial failures (1 ms)
    ✓ should handle multicast with empty token array (1 ms)
    ✓ should handle multicast network error (2 ms)
    ✓ should include Android configuration in feed notification (2 ms)
    ✓ should use normal priority for friend request accepted (2 ms)
    ✓ should handle invalid token error in sendLikeNotification (2 ms)
    ✓ should handle token not registered error in sendLikeNotification (1 ms)
    ✓ should handle generic error in sendLikeNotification (3 ms)
    ✓ should handle invalid token error in sendCommentNotification (3 ms)
    ✓ should handle token not registered error in sendCommentNotification (2 ms)
    ✓ should handle generic error in sendCommentNotification (1 ms)
    ✓ should handle errors in sendFriendRequestNotification (5 ms)
    ✓ should handle errors in sendFriendRequestAcceptedNotification (4 ms)
    ✓ should handle multicast with all failures (2 ms)
    ✓ should include data payload in multicast notification (1 ms)

🌐 TMDB ⬅️  GET /movie/300002 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.294Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300003 params={"language":"en-US","api_key":"***"}
PASS tests/unmocked/user.unmocked.test.ts (6.246 s)
  Unmocked: PUT /users/profile
    ✓ should successfully update user profile name (174 ms)
    ✓ should reject empty name update (2 ms)
    ✓ should reject profile update without authentication (1 ms)
  Unmocked: POST /users/fcm-token
    ✓ should successfully register FCM token (199 ms)
    ✓ should reject missing FCM token (3 ms)
    ✓ should reject FCM token registration without authentication (1 ms)

[2m[2025-10-29T06:26:52.324Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:26:52.324Z][0m [32mSUCCESS[0m All SSE connections closed
[2m[2025-10-29T06:26:52.325Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:26:52.325Z][0m [32mSUCCESS[0m All SSE connections closed
[2m[2025-10-29T06:26:52.325Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:26:52.325Z][0m [32mSUCCESS[0m All SSE connections closed
[2m[2025-10-29T06:26:52.325Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:26:52.325Z][0m [32mSUCCESS[0m All SSE connections closed
PASS tests/unmocked/sseService.unmocked.test.ts
  SSE Service Tests
    ✓ should add client for new user
    ✓ should add multiple clients for same user (1 ms)
    ✓ should add clients for different users (1 ms)
    ✓ should auto-remove client when connection closes
    ✓ should remove client manually
    ✓ should delete user entry when last client is removed
    ✓ should handle removing client from non-existent user
    ✓ should send event to existing client (1 ms)
    ✓ should handle sending to non-existent user
    ✓ should send event to all clients of same user (1 ms)
    ✓ should skip sending to closed connection
    ✓ should skip sending to destroyed connection (1 ms)
    ✓ should remove client when write throws error
    ✓ should remove only failed clients and keep working ones
    ✓ should clear all connections (1 ms)
    ✓ should handle clearing already-closed connections
    ✓ should handle clearing destroyed connections
    ✓ should handle errors during clear
    ✓ should serialize various data types correctly
    ✓ should format event name correctly
    ✓ should handle multiple sends to same client (1 ms)
    ✓ should handle complex nested data structures
    ✓ should handle concurrent add and remove operations
    ✓ should handle empty event name
    ✓ should handle special characters in data

PASS tests/unit/comparisonSession.unit.test.ts
  Comparison Session Utility
    startSession
      ✓ should create a new session with correct initial values (2 ms)
      ✓ should overwrite existing session for same user (1 ms)
      ✓ should handle movie without posterPath
    getSession
      ✓ should return session for existing user (1 ms)
      ✓ should return undefined for non-existent user
    updateSession
      ✓ should update session low and high values
      ✓ should not affect newMovie when updating
      ✓ should handle updating to same values
      ✓ should handle non-existent session gracefully (1 ms)
      ✓ should return early when session does not exist
    endSession
      ✓ should delete existing session
      ✓ should handle deleting non-existent session gracefully
      ✓ should only delete specified user session (1 ms)
    Integration scenarios
      ✓ should handle complete comparison workflow (1 ms)
      ✓ should handle multiple concurrent users

🌐 TMDB ⬅️  GET /movie/300003 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.363Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300004 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.436Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300005 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.506Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300006 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.577Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300007 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.649Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300008 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.721Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300009 params={"language":"en-US","api_key":"***"}
FAIL tests/unmocked/feedRouteHandlers.unmocked.test.ts (21.797 s)
  Feed Route Handlers - Inline Handlers
    ✓ should get friends feed activities with enrichment (341 ms)
    ✓ should return empty feed when user has no friends (25 ms)
    ✓ should handle activities missing overview and poster (98 ms)
    ✓ should include like counts in feed (109 ms)
    ✓ should include comment counts in feed (166 ms)
    ✓ should mark activities liked by user (102 ms)
    ✓ should show current rank from RankedMovie collection (146 ms)
    ✓ should aggregate activities from multiple friends (145 ms)
    ✓ should handle errors gracefully (43 ms)
    ✓ should get users own activities (108 ms)
    ✓ should return empty array when user has no activities (21 ms)
    ✕ should establish SSE stream (10007 ms)
    ✕ should like an activity (12 ms)
    ✓ should return 404 when liking non-existent activity (6 ms)
    ✕ should allow liking own activity without notification (7 ms)
    ✕ should handle duplicate like gracefully (8 ms)
    ✕ should unlike an activity (9 ms)
    ✓ should handle unlike when not previously liked (6 ms)
    ✕ should get comments for an activity (9 ms)
    ✕ should return empty array when no comments (6 ms)
    ✕ should add comment to activity (15 ms)
    ✕ should reject comment without text (16 ms)
    ✓ should return 404 when commenting on non-existent activity (10 ms)
    ✕ should send notification when commenting (7 ms)
    ✕ should not send notification when commenting on own activity (10 ms)
    ✓ should reject unauthorized access to feed (5 ms)
    ✓ should reject unauthorized access to /me (4 ms)
    ✓ should reject unauthorized access to /stream (5 ms)
    ✕ should reject unauthorized like (7 ms)
    ✕ should reject unauthorized comment (8 ms)

  ● Feed Route Handlers - Inline Handlers › should establish SSE stream

    thrown: "Exceeded timeout of 10000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      289 |
      290 |   // Test Case 12: GET /stream (SSE)
    > 291 |   it('should establish SSE stream', async () => {
          |   ^
      292 |     const res = await request(app)
      293 |       .get('/stream')
      294 |       .set('Authorization', `Bearer ${token1}`)

      at tests/unmocked/feedRouteHandlers.unmocked.test.ts:291:3
      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:19:1)

  ● Feed Route Handlers - Inline Handlers › should like an activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      313 |       .set('Authorization', `Bearer ${token1}`);
      314 |
    > 315 |     expect(res.status).toBe(200);
          |                        ^
      316 |
      317 |     // Verify like was created
      318 |     const like = await Like.findOne({

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:315:24)

  ● Feed Route Handlers - Inline Handlers › should allow liking own activity without notification

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      348 |       .set('Authorization', `Bearer ${token1}`);
      349 |
    > 350 |     expect(res.status).toBe(200);
          |                        ^
      351 |   });
      352 |
      353 |   // Test Case 16: POST /:activityId/like duplicate

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:350:24)

  ● Feed Route Handlers - Inline Handlers › should handle duplicate like gracefully

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400, 409, 500]

      372 |
      373 |     // Should handle duplicate (unique index error)
    > 374 |     expect([200, 400, 409, 500]).toContain(res.status);
          |                                  ^
      375 |   });
      376 |
      377 |   // Test Case 17: DELETE /:activityId/like

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:374:34)

  ● Feed Route Handlers - Inline Handlers › should unlike an activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      395 |       .set('Authorization', `Bearer ${token1}`);
      396 |
    > 397 |     expect(res.status).toBe(200);
          |                        ^
      398 |
      399 |     // Verify like was deleted
      400 |     const like = await Like.findOne({

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:397:24)

  ● Feed Route Handlers - Inline Handlers › should get comments for an activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      450 |       .set('Authorization', `Bearer ${token1}`);
      451 |
    > 452 |     expect(res.status).toBe(200);
          |                        ^
      453 |   });
      454 |
      455 |   // Test Case 20: GET /:activityId/comments with no comments

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:452:24)

  ● Feed Route Handlers - Inline Handlers › should return empty array when no comments

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      467 |       .set('Authorization', `Bearer ${token1}`);
      468 |
    > 469 |     expect(res.status).toBe(200);
          |                        ^
      470 |   });
      471 |
      472 |   // Test Case 21: POST /:activityId/comments

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:469:24)

  ● Feed Route Handlers - Inline Handlers › should add comment to activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      485 |       .send({ text: 'Great movie!' });
      486 |
    > 487 |     expect(res.status).toBe(200);
          |                        ^
      488 |
      489 |     // Verify comment was created
      490 |     const comment = await Comment.findOne({

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:487:24)

  ● Feed Route Handlers - Inline Handlers › should reject comment without text

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 404

      510 |       .send({});
      511 |
    > 512 |     expect(res.status).toBe(400);
          |                        ^
      513 |   });
      514 |
      515 |   // Test Case 23: POST /:activityId/comments on non-existent activity

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:512:24)

  ● Feed Route Handlers - Inline Handlers › should send notification when commenting

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      540 |       .send({ text: 'Amazing!' });
      541 |
    > 542 |     expect(res.status).toBe(200);
          |                        ^
      543 |   });
      544 |
      545 |   // Test Case 25: POST /:activityId/comments on own activity (no notification)

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:542:24)

  ● Feed Route Handlers - Inline Handlers › should not send notification when commenting on own activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      558 |       .send({ text: 'Self comment' });
      559 |
    > 560 |     expect(res.status).toBe(200);
          |                        ^
      561 |   });
      562 |
      563 |   // Test Case 26: Unauthorized access to feed

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:560:24)

  ● Feed Route Handlers - Inline Handlers › should reject unauthorized like

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      598 |       .post(`/api/feed/${(activity as any)._id.toString()}/like`);
      599 |
    > 600 |     expect(res.status).toBe(401);
          |                        ^
      601 |   });
      602 |
      603 |   // Test Case 30: Unauthorized comment

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:600:24)

  ● Feed Route Handlers - Inline Handlers › should reject unauthorized comment

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      615 |       .send({ text: 'Comment' });
      616 |
    > 617 |     expect(res.status).toBe(401);
          |                        ^
      618 |   });
      619 | });

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:617:24)

🌐 TMDB ⬅️  GET /movie/300009 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.789Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300010 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300010 ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.864Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300011 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:52.937Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300012 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300012 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.009Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300013 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300013 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.080Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300013,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300014 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300014 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.153Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300014,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300015 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300015 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.223Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300015,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300016 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300016 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.292Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300016,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300017 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/recommendationController.mocked.test.ts
  Recommendation Controller - Mocked Tests
    GET /trending
      ✓ should return trending movies successfully (762 ms)
      ✓ should return empty array when no trending movies (191 ms)
      ✓ should return empty array when TMDB returns no data (14 ms)
      ✓ should limit results to 20 movies (11 ms)
      ✓ should handle null/undefined movie fields (11 ms)
      ✓ should handle TMDB API error (15 ms)
    GET /
      ✓ should return empty array when user has no ranked movies (18 ms)
      ✓ should analyze preferences and return recommendations (22 ms)
      ✓ should handle discover API failure gracefully (13 ms)
      ✓ should handle similar movies API failure gracefully (16 ms)
      ✓ should handle recommendations API failure gracefully (7 ms)
      ✓ should return empty array when all API sources fail (9 ms)
      ✓ should filter out already seen movies (10 ms)
      ✓ should deduplicate recommendations from multiple sources (10 ms)
      ✓ should score movies based on genre matching (8 ms)
      ✓ should handle preference analysis failures gracefully (15 ms)
      ✓ should limit final recommendations to 20 movies (11 ms)
      ✓ should handle database error gracefully (42 ms)
      ✓ should calculate top 50% of ranked movies for preferences (20 ms)
      ✓ should handle discover recommendations failure gracefully (9 ms)

🌐 TMDB ⬅️  GET /movie/300017 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.365Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300017,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300018 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300018 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.438Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300018,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300019 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300019 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.508Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300019,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300020 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/authService.mocked.test.ts
  AuthService - Mocked Tests
    ✓ should verify valid Google token successfully (7 ms)
    ✓ should throw error when token payload missing email (12 ms)
    ✓ should throw error when token payload missing sub (2 ms)
    ✓ should throw error when token payload is null (1 ms)
    ✓ should throw error when token verification fails (1 ms)
    ✓ should use email as name when name is missing (1 ms)
    ✓ should sign in existing user successfully (511 ms)
    ✓ should throw error when user not found (165 ms)
    ✓ should fail signin when Google token is invalid (2 ms)
    ✓ should create new user successfully (9 ms)
    ✓ should throw error when user already exists (3 ms)
    ✓ should fail signup when Google token is invalid (2 ms)
    ✓ should generate valid JWT token (3 ms)
    ✓ should generate unique tokens for different users (19 ms)
    ✓ should set token expiration to 30 days (4 ms)
    ✓ should handle signup without picture (8 ms)
    ✓ should return JWT token on successful signin (5 ms)
    ✓ should handle multiple signin attempts for same user (1010 ms)
    ✓ should create user with all Google profile fields (4 ms)
    ✓ should handle empty token string (1 ms)
    ✓ should use default secret when JWT_SECRET not provided (1 ms)
    ✓ should handle undefined fields in payload gracefully (1 ms)

PASS tests/unmocked/rerankAdvanced.unmocked.test.ts
  Advanced Rerank Controller Tests
    ✓ should rerank movie from middle to top position (58 ms)
    ✓ should rerank movie from middle to bottom position (14 ms)
    ✓ should handle rerank with 10 movies (91 ms)
    ✓ should handle rerank with 20 movies (58 ms)
    ✓ should rerank movie from top position (11 ms)
    ✓ should rerank movie from bottom position (8 ms)
    ✓ should handle rerank with invalid format movieId (3 ms)
    ✓ should reject rerank of another users movie (4 ms)
    ✓ should handle compare without active rerank session (3 ms)
    ✓ should handle rerank start without movieId (2 ms)
    ✓ should handle compare with invalid preferredMovieId (10 ms)
    ✓ should handle multiple sequential rerank sessions (14 ms)
    ✓ should handle rerank with only 2 movies (9 ms)
    ✓ should reject unauthorized rerank request (5 ms)
    ✓ should reject unauthorized rerank compare (3 ms)
    ✓ should handle rerank where movie stays at same position (7 ms)
    ✓ should handle rerank with 15 movies (24 ms)
    ✓ should handle reranking all movies one by one (23 ms)
    ✓ should handle compare with missing preferredMovieId field (9 ms)
    ✓ should handle rerank with 7 movies (balanced binary tree) (10 ms)

PASS tests/unmocked/quoteRoutes.unmocked.test.ts
  Quote Routes - Unmocked Tests
    GET /
      ✓ should fetch tagline with title and year (334 ms)
      ✓ should fetch tagline with title only (122 ms)
      ✓ should reject request with missing title (5 ms)
      ✓ should reject request with empty title (5 ms)
      ✓ should return 404 when no tagline found (3 ms)
      ✓ should handle service errors gracefully (4 ms)
      ✓ should trim title whitespace (3 ms)
      ✓ should handle title with special characters (3 ms)
      ✓ should handle empty year parameter (4 ms)
      ✓ should require authentication (4 ms)

🌐 TMDB ⬅️  GET /movie/300020 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.581Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300020,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300021 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/movieRoutes.mocked.test.ts
  Movie Routes - Mocked Tests
    GET /search
      ✓ should search movies successfully (1208 ms)
      ✓ should reject query shorter than 2 characters (170 ms)
      ✓ should search with includeCast parameter (12 ms)
      ✓ should handle Chinese characters and fallback to zh-CN (10 ms)
      ✓ should handle CJK search when detail fetch fails (9 ms)
      ✓ should handle empty results (7 ms)
      ✓ should handle TMDB API errors (7 ms)
      ✓ should return 500 when TMDB API key not configured (5 ms)
      ✓ should handle cast enrichment API failure (8 ms)
    GET /ranked
      ✓ should get ranked movies (16 ms)
      ✓ should return empty array when no ranked movies (16 ms)
      ✓ should handle database error gracefully (11 ms)
    POST /rank
      ✓ should rank movie successfully (24 ms)
      ✓ should enrich missing overview and poster from TMDB (14 ms)
      ✓ should create feed activity when ranking (17 ms)
      ✓ should handle TMDB enrichment failure gracefully (13 ms)
      ✓ should notify friends via SSE when ranking (20 ms)
      ✓ should handle database error gracefully (9 ms)
    DELETE /ranked/:id
      ✓ should delete ranked movie and resequence ranks (21 ms)
      ✓ should reject invalid ID format (8 ms)
      ✓ should return 404 for non-existent movie (10 ms)
      ✓ should delete related feed activities (14 ms)
      ✓ should handle database error gracefully (8 ms)
    GET /:movieId/providers
      ✓ should get watch providers successfully (6 ms)
      ✓ should use fallback link when no provider link (7 ms)
      ✓ should reject invalid movie ID (6 ms)
      ✓ should return 500 when TMDB API key not configured (8 ms)
      ✓ should handle TMDB API error gracefully (6 ms)
    GET /:movieId/details
      ✓ should get movie details with cast (7 ms)
      ✓ should reject invalid movie ID (6 ms)
      ✓ should return 500 when TMDB API key not configured (5 ms)
      ✓ should handle TMDB API error gracefully (6 ms)
    GET /:movieId/videos
      ✓ should get official trailer (8 ms)
      ✓ should fallback to non-official trailer (6 ms)
      ✓ should fallback to teaser when no trailer available (5 ms)
      ✓ should return null when no videos available (7 ms)
      ✓ should reject invalid movie ID (7 ms)
      ✓ should return 500 when TMDB API key not configured (10 ms)
      ✓ should handle TMDB API error gracefully (7 ms)

🌐 TMDB ⬅️  GET /movie/300021 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.653Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300021,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300022 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300022 ERROR 118ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.772Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300022,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300023 params={"language":"en-US","api_key":"***"}
PASS tests/unmocked/watchlist.unmocked.test.ts (8.335 s)
  Unmocked: GET /watchlist
    ✓ should return user watchlist (17 ms)
    ✓ should return empty watchlist (6 ms)
    ✓ should reject unauthenticated watchlist request (2 ms)
  Unmocked: POST /watchlist
    ✓ should successfully add movie to watchlist (14 ms)
    ✓ should reject duplicate watchlist item (10 ms)
    ✓ should reject incomplete watchlist entry (3 ms)
  Unmocked: DELETE /watchlist/:movieId
    ✓ should successfully remove movie from watchlist (8 ms)
    ✓ should reject removal of non-existent watchlist item (4 ms)

PASS tests/unmocked/friendRoutesDetailed.unmocked.test.ts
  Friend Routes Detailed Endpoints
    ✓ should get detailed pending requests (32 ms)
    ✓ should get empty detailed pending requests (4 ms)
    ✓ should get multiple detailed pending requests (7 ms)
    ✓ should get outgoing friend requests (4 ms)
    ✓ should get empty outgoing requests (4 ms)
    ✓ should get multiple outgoing requests (5 ms)
    ✓ should get detailed outgoing requests (5 ms)
    ✓ should get empty detailed outgoing requests (4 ms)
    ✓ should get multiple detailed outgoing requests (6 ms)
    ✓ should handle multiple rapid friend requests (19 ms)
    ✓ should accept friend request with accept boolean (13 ms)
    ✓ should reject friend request with accept boolean (6 ms)
    ✓ should reject respond from non-receiver (5 ms)
    ✓ should reject respond to already accepted request (3 ms)
    ✓ should get friends list with population (6 ms)
    ✓ should reject unauthorized detailed requests (3 ms)
    ✓ should reject unauthorized outgoing requests (1 ms)
    ✓ should reject unauthorized outgoing detailed requests (1 ms)
    ✓ should handle reverse pending request scenario (7 ms)
    ✓ should create bilateral friendships on accept (10 ms)
    ✓ should handle delete with invalid friendId (4 ms)
    ✓ should validate email format in friend request (4 ms)
    ✓ should enforce rate limiting on friend requests (11 ms)

🌐 TMDB ⬅️  GET /movie/300023 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.842Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300023,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300024 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300024 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.911Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300024,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300000/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:53.983Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300001/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.052Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300002/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.124Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300003/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.193Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300004/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.262Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300005/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.334Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300006/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300006/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.405Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300007/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300007/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.477Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300008/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300008/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.549Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300009/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300009/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.618Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300000/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.686Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300001/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.759Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300002/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.830Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300003/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.902Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300004/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:54.974Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300005/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300005/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.046Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300006/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300006/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.116Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300007/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300007/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.188Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 300007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.277Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.350Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.423Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.495Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.567Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.639Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400000 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.722Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400001 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.794Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400002 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.865Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400003 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:55.936Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400000/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.007Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 400000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400001/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.078Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 400001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400002/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.148Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 400002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400000/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.221Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 400000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400001/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.290Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 400001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400002/recommendations params={"page":1,"api_key":"***"}
PASS tests/unmocked/feed.unmocked.test.ts (10.941 s)
  Unmocked: GET /feed
    ✓ should return feed activities from friends (153 ms)
    ✓ should return empty feed for user with no friends (10 ms)
    ✓ should reject unauthenticated feed request (2 ms)
  Unmocked: POST /feed/:activityId/like
    ✓ should successfully like an activity (16 ms)
    ✓ should reject like on non-existent activity (7 ms)
    ✓ should reject duplicate like on same activity (10 ms)
  Unmocked: GET /feed/:activityId/comments
    ✓ should return comments for activity (23 ms)
    ✓ should return empty array for activity with no comments (4 ms)
  Unmocked: POST /feed/:activityId/comments
    ✓ should successfully post a comment (19 ms)
    ✓ should reject empty comment (3 ms)
    ✓ should reject comment exceeding 500 characters (4 ms)

PASS tests/unmocked/friends.unmocked.test.ts (11.016 s)
  Unmocked: GET /friends
    ✓ should return user friends list (25 ms)
    ✓ should return empty friends list for isolated user (4 ms)
    ✓ should reject unauthenticated friends request (1 ms)
  Unmocked: GET /friends/requests
    ✓ should return pending friend requests (5 ms)
  Unmocked: POST /friends/request
    ✓ should successfully send friend request (15 ms)
    ✓ should reject request to non-existent user (5 ms)
    ✓ should reject self-friend request (3 ms)
    ✓ should reject request to existing friend (13 ms)
    ✓ should reject duplicate pending request (26 ms)
  Unmocked: POST /friends/respond
    ✓ should successfully accept friend request (14 ms)
    ✓ should successfully reject friend request (6 ms)
  Unmocked: DELETE /friends/:friendId
    ✓ should successfully remove friend (5 ms)
    ✓ should reject removal of non-existent friend (2 ms)

🌐 TMDB ⬅️  GET /movie/400002/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.364Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 400002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500000 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.448Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500001 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.519Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500002 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.592Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500003 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.664Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500004 ERROR 65ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.730Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500005 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.801Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500000/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.869Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 500000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500001/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:56.942Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 500001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500002/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.012Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 500002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500003/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.081Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 500003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500000/recommendations ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.148Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 500000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500001/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.217Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 500001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500002/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.289Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 500002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600000 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.374Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600001 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.445Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600002 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.517Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600003 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.590Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600004 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.661Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600005 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.733Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600006 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.802Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600007 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.872Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600008 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:26:57.945Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600009 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600009 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.015Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600010 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600010 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.086Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600011 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.158Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600012 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600012 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.228Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600000/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.298Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600001/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.371Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600002/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.443Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600003/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.515Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600004/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.588Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600005/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.659Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600006/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600006/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.730Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600007/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600007/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.799Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600000/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.867Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600001/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:58.939Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600002/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.007Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600003/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.079Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600004/recommendations ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.147Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 600004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700000 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.241Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700001 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.313Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700002 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.382Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700003 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.453Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700004 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.522Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700005 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.591Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700006 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.662Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700007 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.736Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700008 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.804Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700009 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700009 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.876Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700010 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700010 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:26:59.946Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700011 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.015Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700012 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700012 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.084Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700013 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700013 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.155Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700013,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700014 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700014 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.227Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700014,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700000/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.296Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700001/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.366Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700002/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.438Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700003/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.508Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700004/similar ERROR 77ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.588Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700005/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.662Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700006/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700006/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.730Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700007/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700007/similar ERROR 112ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.843Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700008/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700008/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.912Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700000/recommendations ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:27:00.978Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700001/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.051Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700002/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.124Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700003/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.196Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700004/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.271Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700005/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700005/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.342Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 700005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800000 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.486Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800001 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.558Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800002 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.630Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800003 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.698Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800004 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.767Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800005 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.839Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800006 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.909Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800007 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:01.981Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800008 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.050Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800009 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800009 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.122Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800010 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800010 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.190Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800011 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.260Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800012 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800012 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.332Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800013 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800013 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.400Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800013,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800014 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800014 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.473Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800014,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800015 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800015 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.541Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800015,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800016 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800016 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.612Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800016,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800017 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800017 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.683Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800017,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800018 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800018 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.753Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800018,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800019 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800019 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.826Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800019,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800000/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.896Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800001/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:02.965Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800002/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.038Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800003/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.109Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800004/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.177Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800005/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.251Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800006/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800006/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.319Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800007/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800007/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.391Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800008/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800008/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.463Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800009/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800009/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.536Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800000/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.609Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800001/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.681Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800002/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.753Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800003/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.823Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800004/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.893Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800005/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800005/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:27:03.962Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800006/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800006/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.034Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800007/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800007/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.105Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 800007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.185Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.258Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.330Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /trending/movie/week ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.408Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /trending/movie/week ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.486Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.563Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.635Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3b8fc83d559295ca395",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.708Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3b8fc83d559295ca395",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.787Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.859Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:04.932Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:27:05.005Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:27:05.077Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:27:05.146Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:27:05.216Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:27:05.290Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:27:05.361Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b3a6fc83d559295ca1bb",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
PASS tests/unmocked/recommendationController.unmocked.test.ts (20.303 s)
  Recommendation Controller Direct Tests
    ✓ should handle recommendations with 1 ranked movie (314 ms)
    ✓ should handle recommendations with 3 ranked movies (661 ms)
    ✓ should handle recommendations with many ranked movies (1324 ms)
    ✓ should handle recommendations with 5 ranked movies (667 ms)
    ✓ should handle recommendations with 20 ranked movies (1455 ms)
    ✓ should handle recommendations with 50 ranked movies (3145 ms)
    ✓ should handle recommendations with 2 ranked movies (451 ms)
    ✓ should handle recommendations with 7 ranked movies (725 ms)
    ✓ should handle recommendations with 12 ranked movies (925 ms)
    ✓ should handle recommendations with 25 ranked movies (1858 ms)
    ✓ should handle recommendations with 30 ranked movies (2200 ms)
    ✓ should handle recommendations with 40 ranked movies (2759 ms)
    ✓ should handle recommendations with limit param (224 ms)
    ✓ should get trending movies (79 ms)
    ✓ should get trending movies without query params (77 ms)
    ✓ should handle recommendations for different user (221 ms)
    ✓ should handle recommendations with varied movie IDs (654 ms)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
-----------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------
File                               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                 
-----------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------
All files                          |   90.28 |    72.45 |   91.87 |   90.84 |                                                                   
 src                               |   26.31 |    35.29 |       0 |   26.31 |                                                                   
  config.ts                        |   26.31 |    35.29 |       0 |   26.31 | 8-28,34,36                                                        
 src/controllers                   |   95.65 |    71.79 |     100 |   95.36 |                                                                   
  movieComparisionController.ts    |   96.12 |       70 |     100 |   95.86 | 23,26,36,154,183                                                  
  rerankController.ts              |   93.75 |    77.77 |     100 |   93.33 | 10,46                                                             
 src/controllers/auth              |   97.05 |    69.23 |     100 |   96.66 |                                                                   
  authController.ts                |   97.05 |    69.23 |     100 |   96.66 | 83                                                                
 src/controllers/recommendations   |   98.52 |    72.36 |     100 |   98.47 |                                                                   
  movieRecommendationController.ts |   98.52 |    72.36 |     100 |   98.47 | 108,135                                                           
 src/middleware                    |     100 |    66.66 |     100 |     100 |                                                                   
  auth.ts                          |     100 |    66.66 |     100 |     100 | 19                                                                
 src/models/feed                   |     100 |      100 |     100 |     100 |                                                                   
  Comment.ts                       |     100 |      100 |     100 |     100 |                                                                   
  FeedActivity.ts                  |     100 |      100 |     100 |     100 |                                                                   
  Like.ts                          |     100 |      100 |     100 |     100 |                                                                   
 src/models/friend                 |     100 |      100 |     100 |     100 |                                                                   
  Friend.ts                        |     100 |      100 |     100 |     100 |                                                                   
 src/models/movie                  |     100 |      100 |     100 |     100 |                                                                   
  RankedMovie.ts                   |     100 |      100 |     100 |     100 |                                                                   
 src/models/user                   |     100 |      100 |     100 |     100 |                                                                   
  User.ts                          |     100 |      100 |     100 |     100 |                                                                   
 src/models/watch                  |     100 |      100 |     100 |     100 |                                                                   
  WatchlistItem.ts                 |     100 |      100 |     100 |     100 |                                                                   
 src/routes                        |   87.64 |    72.24 |   86.84 |   88.82 |                                                                   
  authRoutes.ts                    |     100 |      100 |     100 |     100 |                                                                   
  feedRoutes.ts                    |    79.7 |    59.49 |   81.48 |   83.51 | 38-42,154-158,172-173,185-186,201-202,255,330-334,390,442-464     
  friendRoutes.ts                  |   80.83 |    77.77 |   81.25 |   80.24 | 173-180,252-258,278,305-321,327-347                               
  movieRoutes.ts                   |   99.45 |    73.22 |   95.65 |     100 | 20,52-60,71-93,114,194,200-201,327-328,374-387,411                
  quoteRoutes.ts                   |     100 |      100 |     100 |     100 |                                                                   
  recommendationRoutes.ts          |     100 |      100 |     100 |     100 |                                                                   
  userRoutes.ts                    |   82.08 |    88.23 |   83.33 |   82.08 | 114-120,126-134                                                   
  watchlistRoutes.ts               |     100 |    85.71 |     100 |     100 | 51-52                                                             
 src/services                      |      80 |       58 |     100 |      80 |                                                                   
  notification.service.ts          |      80 |       58 |     100 |      80 | 34,38,51-67,81-82,133-134,169,183-184,215,233-234,286-287,344-345 
 src/services/auth                 |     100 |      100 |     100 |     100 |                                                                   
  authService.ts                   |     100 |      100 |     100 |     100 |                                                                   
 src/services/sse                  |     100 |      100 |     100 |     100 |                                                                   
  sseService.ts                    |     100 |      100 |     100 |     100 |                                                                   
 src/services/tmdb                 |   98.59 |    84.44 |     100 |     100 |                                                                   
  tmdbClient.ts                    |   97.56 |       80 |     100 |     100 | 8,41-44,54                                                        
  tmdbTaglineService.ts            |     100 |    93.33 |     100 |     100 | 41                                                                
 src/utils                         |   97.82 |      100 |   94.11 |     100 |                                                                   
  asyncHandler.ts                  |      80 |      100 |   66.66 |     100 |                                                                   
  comparisonSession.ts             |     100 |      100 |     100 |     100 |                                                                   
  logger.ts                        |     100 |      100 |     100 |     100 |                                                                   
-----------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------

=============================== Coverage summary ===============================
Statements   : 90.28% ( 1255/1390 )
Branches     : 72.45% ( 405/559 )
Functions    : 91.87% ( 147/160 )
Lines        : 90.84% ( 1210/1332 )
================================================================================
Summary of all failing tests
FAIL tests/unmocked/friendRoutesAdvanced.unmocked.test.ts (9.441 s)
  ● Advanced Friend Routes Tests › should remove bilateral friendships on delete

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

      114 |     const count2 = await Friendship.countDocuments({ userId: user2._id, friendId: user1._id });
      115 |
    > 116 |     expect(count1).toBe(0);
          |                    ^
      117 |     expect(count2).toBe(0);
      118 |   });
      119 |

      at Object.<anonymous> (tests/unmocked/friendRoutesAdvanced.unmocked.test.ts:116:20)

FAIL tests/unmocked/movieComparisonAdvanced.unmocked.test.ts (9.555 s)
  ● Advanced Movie Comparison Controller Tests › should remove movie from watchlist when ranking

    expect(received).toBeNull()

    Received: {"__v": 0, "_id": "6901b39f610bb0c1ece4e2b1", "createdAt": 2025-10-29T06:26:39.140Z, "movieId": 27205, "overview": "A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea.", "posterPath": "/oYm8f6YSxFab6XwaxmTeGa90RWl.jpg", "title": "Inception", "updatedAt": 2025-10-29T06:26:39.140Z, "userId": "6901b39d610bb0c1ece4e28e"}

      165 |       movieId: mockMovies.inception.id
      166 |     });
    > 167 |     expect(watchlistItem).toBeNull();
          |                           ^
      168 |   });
      169 |
      170 |   // Test Case 4: Complex comparison with 10 movies

      at Object.<anonymous> (tests/unmocked/movieComparisonAdvanced.unmocked.test.ts:167:27)

  ● Advanced Movie Comparison Controller Tests › should handle multiple watchlist items during ranking

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 2

      364 |     // Both should be removed from watchlist
      365 |     const count = await WatchlistItem.countDocuments({ userId: user._id });
    > 366 |     expect(count).toBe(0);
          |                   ^
      367 |   });
      368 |
      369 |   // Test Case 8: Comparison with exact middle selection

      at Object.<anonymous> (tests/unmocked/movieComparisonAdvanced.unmocked.test.ts:366:19)

FAIL tests/unmocked/movieComparisonController.unmocked.test.ts (11.36 s)
  ● Movie Comparison Controller - Complete Coverage › should reject comparison without active session

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      354 |       });
      355 |
    > 356 |     expect(res.status).toBe(400);
          |                        ^
      357 |     expect(res.body.message).toContain('No active comparison');
      358 |   });
      359 |

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:356:24)

  ● Movie Comparison Controller - Complete Coverage › should finalize ranking when low > high

    expect(received).toBe(expected) // Object.is equality

    Expected: "added"
    Received: "compare"

      490 |       });
      491 |
    > 492 |     expect(res.body.status).toBe('added');
          |                             ^
      493 |     const movie = await RankedMovie.findOne({
      494 |       userId: user1._id,
      495 |       movieId: 200000

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:492:29)

  ● Movie Comparison Controller - Complete Coverage › should update ranks when finalizing

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 2

      533 |
      534 |     const movies = await RankedMovie.find({ userId: user1._id }).sort({ rank: 1 });
    > 535 |     expect(movies.length).toBe(3);
          |                           ^
      536 |   });
      537 |
      538 |   it('should create feed activity when finalizing', async () => {

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:535:27)

FAIL tests/unmocked/recommendations.unmocked.test.ts (12.097 s)
  ● Unmocked: GET /recommendations/trending › should return trending movies

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      127 |       .set('Authorization', `Bearer ${token}`);
      128 |
    > 129 |     expect(res.status).toStrictEqual(200);
          |                        ^
      130 |     expect(res.body.success).toBe(true);
      131 |     expect(Array.isArray(res.body.data)).toBe(true);
      132 |   });

      at Object.<anonymous> (tests/unmocked/recommendations.unmocked.test.ts:129:24)

FAIL tests/unmocked/allRecommendationRoutes.unmocked.test.ts (12.698 s)
  ● Comprehensive Recommendation Routes Tests › should handle recommendation errors gracefully

    ValidationError: RankedMovie validation failed: movieId: Path `movieId` is required., title: Path `title` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1416:9

FAIL tests/unmocked/userRoutes.unmocked.test.ts
  ● User Routes - Unmocked Tests › GET /:userId › should get user by ID successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      420 |         .set('Authorization', `Bearer ${token1}`);
      421 |
    > 422 |       expect(res.status).toBe(200);
          |                          ^
      423 |       expect(res.body.success).toBe(true);
      424 |       expect(res.body.data._id).toBe((user2 as any)._id.toString());
      425 |       expect(res.body.data.email).toBe(user2.email);

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:422:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle user not found

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

      445 |
      446 |       expect(res.status).toBe(404);
    > 447 |       expect(res.body.success).toBe(false);
          |                                ^
      448 |       expect(res.body.message).toContain('not found');
      449 |     });
      450 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:447:32)

  ● User Routes - Unmocked Tests › GET /:userId › should return selected fields only

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      454 |         .set('Authorization', `Bearer ${token1}`);
      455 |
    > 456 |       expect(res.status).toBe(200);
          |                          ^
      457 |       expect(res.body.data).toHaveProperty('_id');
      458 |       expect(res.body.data).toHaveProperty('email');
      459 |       expect(res.body.data).toHaveProperty('name');

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:456:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle database error gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 404

      469 |         .set('Authorization', `Bearer ${token1}`);
      470 |
    > 471 |       expect(res.status).toBe(500);
          |                          ^
      472 |       expect(res.body.success).toBe(false);
      473 |       expect(res.body.message).toContain('Unable to load user');
      474 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:471:26)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should get user watchlist successfully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return empty array for user with no watchlist items

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should sort watchlist by createdAt descending

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should reject invalid user ID format

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return watchlist even for non-existent user (empty array)

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should handle database error gracefully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

FAIL tests/unmocked/movieComparison.unmocked.test.ts (13.824 s)
  ● Unmocked: POST /movies/rank › should reject missing required fields

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      150 |       });
      151 |
    > 152 |     expect(res.status).toStrictEqual(400);
          |                        ^
      153 |   });
      154 |
      155 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:152:24)

  ● Unmocked: POST /movies/compare › should reject comparison without preferredMovieId

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      300 |       .send({});
      301 |
    > 302 |     expect(res.status).toStrictEqual(400);
          |                        ^
      303 |   });
      304 |
      305 |   // Input: No active comparison session

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:302:24)

  ● Unmocked: POST /movies/compare › should reject comparison without active session

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 200

      315 |       });
      316 |
    > 317 |     expect(res.status).toStrictEqual(400);
          |                        ^
      318 |   });
      319 |
      320 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:317:24)

FAIL tests/mocked/apis.mocked.test.ts
  ● Mocked: Feed API Errors › should handle feed fetch failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      44 |       .set('Authorization', `Bearer ${token}`);
      45 |
    > 46 |     expect(res.status).toStrictEqual(500);
         |                        ^
      47 |   });
      48 |
      49 |   // Mocked behavior: Like creation fails due to database error

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:46:24)

  ● Mocked: Feed API Errors › should handle like creation failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      62 |       .send({});
      63 |
    > 64 |     expect(res.status).toStrictEqual(500);
         |                        ^
      65 |   });
      66 |
      67 |   // Mocked behavior: Comment validation fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:64:24)

  ● Mocked: Feed API Errors › should handle invalid comment text

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      76 |       .send({ text: null });
      77 |
    > 78 |     expect(res.status).toStrictEqual(400);
         |                        ^
      79 |   });
      80 | });
      81 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:78:24)

  ● Mocked: Friends API Errors › should handle friends list fetch failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      105 |       .set('Authorization', `Bearer ${token}`);
      106 |
    > 107 |     expect(res.status).toStrictEqual(500);
          |                        ^
      108 |   });
      109 |
      110 |   // Mocked behavior: Friend request database error

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:107:24)

  ● Mocked: Friends API Errors › should handle friend request creation failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      123 |       .send({ email: 'test@example.com' });
      124 |
    > 125 |     expect(res.status).toStrictEqual(500);
          |                        ^
      126 |   });
      127 |
      128 |   // Mocked behavior: User lookup fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:125:24)

  ● Mocked: Friends API Errors › should handle user lookup failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      141 |       .send({ email: 'nonexistent@example.com' });
      142 |
    > 143 |     expect(res.status).toStrictEqual(500);
          |                        ^
      144 |   });
      145 | });
      146 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:143:24)

  ● Mocked: Watchlist API Errors › should handle watchlist fetch failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      170 |       .set('Authorization', `Bearer ${token}`);
      171 |
    > 172 |     expect(res.status).toStrictEqual(500);
          |                        ^
      173 |   });
      174 |
      175 |   // Mocked behavior: Item creation fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:172:24)

  ● Mocked: Watchlist API Errors › should handle watchlist item creation failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      188 |       .send({ movieId: 278, title: 'Movie' });
      189 |
    > 190 |     expect(res.status).toStrictEqual(500);
          |                        ^
      191 |   });
      192 |
      193 |   // Mocked behavior: Delete operation fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:190:24)

  ● Mocked: Watchlist API Errors › should handle watchlist item deletion failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      205 |       .set('Authorization', `Bearer ${token}`);
      206 |
    > 207 |     expect(res.status).toStrictEqual(500);
          |                        ^
      208 |   });
      209 | });
      210 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:207:24)

  ● Mocked: Recommendations API Errors › should handle trending movies fetch failure

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [500, 200]

      235 |       .set('Authorization', `Bearer ${token}`);
      236 |
    > 237 |     expect([500, 200]).toContain(res.status); // May cache or fail
          |                        ^
      238 |   });
      239 |
      240 |   // Mocked behavior: Database query fails for recommendations

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:237:24)

  ● Mocked: Recommendations API Errors › should handle recommendations generation failure

    Property `find` does not exist in the provided object

      244 |   // Expected output: Error message
      245 |   it('should handle recommendations generation failure', async () => {
    > 246 |     jest.spyOn(require('../../src/models/movie/RankedMovie'), 'find')
          |          ^
      247 |       .mockRejectedValueOnce(new Error('Database error'));
      248 |
      249 |     const res = await request(app)

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:246:10)

  ● Mocked: User API Errors › should handle profile update failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      281 |       .send({ name: 'New Name' });
      282 |
    > 283 |     expect(res.status).toStrictEqual(500);
          |                        ^
      284 |   });
      285 |
      286 |   // Mocked behavior: FCM token registration fails

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:283:24)

  ● Mocked: User API Errors › should handle FCM token registration failure

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 500
    Received: 404

      299 |       .send({ token: 'eODL6-Yk3jg:APA91bE...' });
      300 |
    > 301 |     expect(res.status).toStrictEqual(500);
          |                        ^
      302 |   });
      303 | });
      304 |

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:301:24)

FAIL tests/mocked/movie.mocked.test.ts
  ● Mocked: GET /movies/search - TMDB API Failure › should return empty array for no matching results

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      75 |       .query({ query: 'xyz123nonexistent' });
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      79 |   });
      80 |

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:77:24)

  ● Mocked: Movie Comparison and Addition - Database Failures › should reject duplicate movie ranking

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      153 |       });
      154 |
    > 155 |     expect(res.status).toStrictEqual(400);
          |                        ^
      156 |     findOneySpy.mockRestore();
      157 |   });
      158 | });

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:155:24)

  ● Mocked: GET /movies/ranked - Database Query Failure › should handle ranked movies query failure

    Database connection lost

      175 |   it('should handle ranked movies query failure', async () => {
      176 |     const findSpy = jest.spyOn(RankedMovie, 'find')
    > 177 |       .mockRejectedValueOnce(new Error('Database connection lost'));
          |                              ^
      178 |
      179 |     const res = await request(app)
      180 |       .get('/api/movies/ranked')

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:177:30)

FAIL tests/mocked/tmdbServices.mocked.test.ts
  ● TMDB Client Tests › should log outgoing request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ➡️"

    Number of calls: 0

      140 |     getTmdbClient();
      141 |
    > 142 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      143 |       expect.stringContaining('TMDB ➡️')
      144 |     );
      145 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:142:27)

  ● TMDB Client Tests › should redact API key in request logs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "***"

    Number of calls: 0

      167 |     getTmdbClient();
      168 |
    > 169 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      170 |       expect.stringContaining('***')
      171 |     );
      172 |     expect(consoleLogSpy).not.toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:169:27)

  ● TMDB Client Tests › should log successful response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ⬅️"

    Number of calls: 0

      201 |     responseInterceptor(mockResponse);
      202 |
    > 203 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      204 |       expect.stringContaining('TMDB ⬅️')
      205 |     );
      206 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:203:27)

  ● TMDB Client Tests › should calculate and log response time

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringMatching /\d+ms/

    Number of calls: 0

      235 |     responseInterceptor(mockResponse);
      236 |
    > 237 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      238 |       expect.stringMatching(/\d+ms/)
      239 |     );
      240 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:237:27)

  ● TMDB Client Tests › should log error response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "ERROR"

    Number of calls: 0

      266 |     expect(() => errorInterceptor(mockError)).toThrow();
      267 |
    > 268 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      269 |       expect.stringContaining('ERROR')
      270 |     );
      271 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:268:27)

  ● TMDB Client Tests › should handle error without config

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      292 |
      293 |     expect(() => errorInterceptor(mockError)).toThrow();
    > 294 |     expect(consoleLogSpy).toHaveBeenCalled();
          |                           ^
      295 |   });
      296 | });
      297 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:294:27)

  ● TMDB Tagline Service Tests › should treat titles as case-insensitive for caching

    expect(received).toBe(expected) // Object.is equality

    Expected: "Cached"
    Received: "An amazing movie"

      519 |     const tagline = await fetchMovieTagline('TEST MOVIE', 2024);
      520 |
    > 521 |     expect(tagline).toBe('Cached');
          |                     ^
      522 |     expect(mockClient.get).toHaveBeenCalledTimes(2);
      523 |   });
      524 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:521:21)

  ● TMDB Tagline Service Tests › should handle year as string parameter

    expect(received).toBe(expected) // Object.is equality

    Expected: "String year"
    Received: "New tagline"

      570 |     const tagline = await fetchMovieTagline('Movie', '2024');
      571 |
    > 572 |     expect(tagline).toBe('String year');
          |                     ^
      573 |   });
      574 |
      575 |   // Test Case 23: Trim whitespace from title

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:572:21)

FAIL tests/unmocked/rerankController.unmocked.test.ts
  ● Rerank Controller - Complete Coverage › should handle reranking immediately after ranking

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      529 |       .send({ rankedId: (movie as any)._id.toString() });
      530 |
    > 531 |     expect(res.status).toBe(200);
          |                        ^
      532 |     expect(res.body.status).toBe('added');
      533 |   });
      534 |

      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:531:24)

  ● Rerank Controller - Complete Coverage › should handle movie with special characters in title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

  ● Rerank Controller - Complete Coverage › should handle rerank of movie with very long title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

FAIL tests/unit/logger.unit.test.ts
  ● Logger Utility › info › should log info message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      23 |       logger.info('Test info message');
      24 |
    > 25 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      26 |       const call = consoleLogSpy.mock.calls[0][0];
      27 |       expect(call).toContain('INFO');
      28 |       expect(call).toContain('Test info message');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:25:29)

  ● Logger Utility › info › should log info message with arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      32 |       logger.info('User logged in', { userId: '123', email: 'test@example.com' });
      33 |
    > 34 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      35 |       const call = consoleLogSpy.mock.calls[0][0];
      36 |       expect(call).toContain('INFO');
      37 |       expect(call).toContain('User logged in');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:34:29)

  ● Logger Utility › info › should handle multiple arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      43 |       logger.info('Multiple args', 'arg1', 123, true);
      44 |
    > 45 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      46 |       const call = consoleLogSpy.mock.calls[0][0];
      47 |       expect(call).toContain('arg1');
      48 |       expect(call).toContain('123');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:45:29)

  ● Logger Utility › success › should log success message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      55 |       logger.success('Operation completed');
      56 |
    > 57 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      58 |       const call = consoleLogSpy.mock.calls[0][0];
      59 |       expect(call).toContain('SUCCESS');
      60 |       expect(call).toContain('Operation completed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:57:29)

  ● Logger Utility › success › should log success with object data

    TypeError: Cannot read properties of undefined (reading '0')

      64 |       logger.success('Movie ranked', { movieId: 550, rank: 1 });
      65 |
    > 66 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      67 |       expect(call).toContain('SUCCESS');
      68 |       expect(call).toContain('Movie ranked');
      69 |       expect(call).toContain('movieId');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:66:47)

  ● Logger Utility › warn › should log warning message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      75 |       logger.warn('API rate limit approaching');
      76 |
    > 77 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      78 |       const call = consoleLogSpy.mock.calls[0][0];
      79 |       expect(call).toContain('WARN');
      80 |       expect(call).toContain('API rate limit approaching');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:77:29)

  ● Logger Utility › warn › should log warning with details

    TypeError: Cannot read properties of undefined (reading '0')

      84 |       logger.warn('Slow query detected', { duration: 5000, query: 'complex query' });
      85 |
    > 86 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      87 |       expect(call).toContain('WARN');
      88 |       expect(call).toContain('Slow query detected');
      89 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:86:47)

  ● Logger Utility › error › should log error message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      94 |       logger.error('Database connection failed');
      95 |
    > 96 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      97 |       const call = consoleLogSpy.mock.calls[0][0];
      98 |       expect(call).toContain('ERROR');
      99 |       expect(call).toContain('Database connection failed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:96:29)

  ● Logger Utility › error › should log error with error object

    TypeError: Cannot read properties of undefined (reading '0')

      104 |       logger.error('Unexpected error', { error: error.message, stack: 'stack trace' });
      105 |
    > 106 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      107 |       expect(call).toContain('ERROR');
      108 |       expect(call).toContain('Unexpected error');
      109 |       expect(call).toContain('Something went wrong');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:106:47)

  ● Logger Utility › debug › should log debug message in development mode

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      117 |       logger.debug('Debug information');
      118 |
    > 119 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      120 |       const call = consoleLogSpy.mock.calls[0][0];
      121 |       expect(call).toContain('DEBUG');
      122 |       expect(call).toContain('Debug information');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:119:29)

  ● Logger Utility › debug › should log debug with detailed data in development

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      147 |       });
      148 |
    > 149 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      150 |       const call = consoleLogSpy.mock.calls[0][0];
      151 |       expect(call).toContain('DEBUG');
      152 |       expect(call).toContain('State dump');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:149:29)

  ● Logger Utility › http › should log HTTP request with all parameters

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      158 |       logger.http('GET', '/api/movies', 200, 45);
      159 |
    > 160 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      161 |       const call = consoleLogSpy.mock.calls[0][0];
      162 |       expect(call).toContain('GET');
      163 |       expect(call).toContain('/api/movies');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:160:29)

  ● Logger Utility › http › should log HTTP request without status code

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      169 |       logger.http('POST', '/api/auth/signin');
      170 |
    > 171 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      172 |       const call = consoleLogSpy.mock.calls[0][0];
      173 |       expect(call).toContain('POST');
      174 |       expect(call).toContain('/api/auth/signin');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:171:29)

  ● Logger Utility › http › should log HTTP request without duration

    TypeError: Cannot read properties of undefined (reading '0')

      178 |       logger.http('DELETE', '/api/friends/123', 204);
      179 |
    > 180 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      181 |       expect(call).toContain('DELETE');
      182 |       expect(call).toContain('/api/friends/123');
      183 |       expect(call).toContain('204');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:180:47)

  ● Logger Utility › http › should handle successful status codes (200-399)

    TypeError: Cannot read properties of undefined (reading '0')

      187 |       logger.http('GET', '/api/users', 200, 10);
      188 |
    > 189 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      190 |       expect(call).toContain('200');
      191 |     });
      192 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:189:47)

  ● Logger Utility › http › should handle error status codes (400+)

    TypeError: Cannot read properties of undefined (reading '0')

      194 |       logger.http('POST', '/api/movies', 404, 20);
      195 |
    > 196 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      197 |       expect(call).toContain('404');
      198 |     });
      199 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:196:47)

  ● Logger Utility › http › should handle server error status codes (500+)

    TypeError: Cannot read properties of undefined (reading '0')

      201 |       logger.http('GET', '/api/recommendations', 500, 100);
      202 |
    > 203 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      204 |       expect(call).toContain('500');
      205 |       expect(call).toContain('100ms');
      206 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:203:47)

  ● Logger Utility › http › should handle various HTTP methods

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 3
    Received number of calls: 0

      211 |       logger.http('HEAD', '/api/health', 200);
      212 |
    > 213 |       expect(consoleLogSpy).toHaveBeenCalledTimes(3);
          |                             ^
      214 |       expect(consoleLogSpy.mock.calls[0][0]).toContain('PUT');
      215 |       expect(consoleLogSpy.mock.calls[1][0]).toContain('PATCH');
      216 |       expect(consoleLogSpy.mock.calls[2][0]).toContain('HEAD');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:213:29)

  ● Logger Utility › Timestamp formatting › should include ISO timestamp in all log messages

    TypeError: Cannot read properties of undefined (reading '0')

      222 |       logger.info('Test message');
      223 |
    > 224 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      225 |       // ISO format: YYYY-MM-DDTHH:mm:ss.sssZ
      226 |       expect(call).toMatch(/\[\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z\]/);
      227 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:224:47)

  ● Logger Utility › Argument formatting › should format string arguments

    TypeError: Cannot read properties of undefined (reading '0')

      232 |       logger.info('Message', 'string arg');
      233 |
    > 234 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      235 |       expect(call).toContain('string arg');
      236 |     });
      237 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:234:47)

  ● Logger Utility › Argument formatting › should format number arguments

    TypeError: Cannot read properties of undefined (reading '0')

      239 |       logger.info('Message', 42, 3.14);
      240 |
    > 241 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      242 |       expect(call).toContain('42');
      243 |       expect(call).toContain('3.14');
      244 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:241:47)

  ● Logger Utility › Argument formatting › should format boolean arguments

    TypeError: Cannot read properties of undefined (reading '0')

      247 |       logger.info('Message', true, false);
      248 |
    > 249 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      250 |       expect(call).toContain('true');
      251 |       expect(call).toContain('false');
      252 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:249:47)

  ● Logger Utility › Argument formatting › should format object arguments as JSON

    TypeError: Cannot read properties of undefined (reading '0')

      255 |       logger.info('Message', { key: 'value', nested: { data: 123 } });
      256 |
    > 257 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      258 |       expect(call).toContain('"key"');
      259 |       expect(call).toContain('"value"');
      260 |       expect(call).toContain('"nested"');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:257:47)

  ● Logger Utility › Argument formatting › should format array arguments

    TypeError: Cannot read properties of undefined (reading '0')

      264 |       logger.info('Message', [1, 2, 3]);
      265 |
    > 266 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      267 |       expect(call).toContain('[');
      268 |       expect(call).toContain('1');
      269 |       expect(call).toContain('2');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:266:47)

  ● Logger Utility › Argument formatting › should handle null and undefined arguments

    TypeError: Cannot read properties of undefined (reading '0')

      274 |       logger.info('Message', null, undefined);
      275 |
    > 276 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      277 |       expect(call).toContain('null');
      278 |       expect(call).toContain('undefined');
      279 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:276:47)

  ● Logger Utility › Argument formatting › should handle empty object

    TypeError: Cannot read properties of undefined (reading '0')

      282 |       logger.info('Message', {});
      283 |
    > 284 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      285 |       expect(call).toContain('{}');
      286 |     });
      287 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:284:47)

  ● Logger Utility › Argument formatting › should handle empty array

    TypeError: Cannot read properties of undefined (reading '0')

      289 |       logger.info('Message', []);
      290 |
    > 291 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      292 |       expect(call).toContain('[]');
      293 |     });
      294 |   });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:291:47)

  ● Logger Utility › Integration scenarios › should handle rapid sequential log calls

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 4
    Received number of calls: 0

      301 |       logger.error('Message 4');
      302 |
    > 303 |       expect(consoleLogSpy).toHaveBeenCalledTimes(4);
          |                             ^
      304 |     });
      305 |
      306 |     it('should handle complex nested objects', () => {

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:303:29)

  ● Logger Utility › Integration scenarios › should handle complex nested objects

    TypeError: Cannot read properties of undefined (reading '0')

      321 |       logger.info('Complex data', complexObject);
      322 |
    > 323 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      324 |       expect(call).toContain('Complex data');
      325 |       expect(call).toContain('user');
      326 |       expect(call).toContain('profile');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:323:47)

FAIL tests/unmocked/allFeedRoutes.unmocked.test.ts
  ● Comprehensive Feed Routes Tests › should get empty feed with no friends

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should get feed with friend activities

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should like a feed activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle duplicate like

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should unlike a feed activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should get comments for activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should add comment to activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle empty comment

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle long comment

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle liking non-existent activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle unliking when no like exists

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle commenting on non-existent activity

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle feed pagination

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should get multiple comments

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle different activity types

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should reject unauthorized feed access

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

  ● Comprehensive Feed Routes Tests › should handle invalid activity ID format

    MongooseError: The `uri` parameter to `openUri()` must be a string, got "undefined". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.

      28 |
      29 |   beforeAll(async () => {
    > 30 |     await mongoose.connect(process.env.MONGO_URI_FOR_TESTS!);
         |                    ^
      31 |
      32 |     app = express();
      33 |     app.use(express.json());

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (tests/unmocked/allFeedRoutes.unmocked.test.ts:30:20)

FAIL tests/unmocked/userProfile.unmocked.test.ts (14.489 s)
  ● Unmocked: PUT /users/profile › should update user profile name

    TypeError: Cannot read properties of undefined (reading 'name')

      47 |
      48 |     expect(res.status).toStrictEqual(200);
    > 49 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      50 |
      51 |     const updatedUser = await User.findById(user._id);
      52 |     expect(updatedUser!.name).toStrictEqual(newName);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:49:26)

  ● Unmocked: PUT /users/profile › should update user profile image

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      64 |       .send({ profileImageUrl: newImageUrl });
      65 |
    > 66 |     expect(res.status).toStrictEqual(200);
         |                        ^
      67 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      68 |
      69 |     const updatedUser = await User.findById(user._id);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:66:24)

  ● Unmocked: PUT /users/profile › should update multiple profile fields

    TypeError: Cannot read properties of undefined (reading 'name')

      88 |
      89 |     expect(res.status).toStrictEqual(200);
    > 90 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      91 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      92 |   });
      93 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:90:26)

  ● Unmocked: GET /users/profile/:userId › should get user profile by ID

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      283 |       .set('Authorization', `Bearer ${token}`);
      284 |
    > 285 |     expect(res.status).toStrictEqual(200);
          |                        ^
      286 |     expect(res.body.user).toBeDefined();
      287 |     expect(res.body.user.email).toStrictEqual(otherUser.email);
      288 |   });

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:285:24)

  ● Unmocked: GET /users/profile/:userId › should get own profile

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      297 |       .set('Authorization', `Bearer ${token}`);
      298 |
    > 299 |     expect(res.status).toStrictEqual(200);
          |                        ^
      300 |     expect(res.body.user.email).toStrictEqual(user.email);
      301 |   });
      302 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:299:24)

  ● Unmocked: GET /users/profile/:userId › should reject invalid user ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      323 |       .set('Authorization', `Bearer ${token}`);
      324 |
    > 325 |     expect(res.status).toStrictEqual(400);
          |                        ^
      326 |   });
      327 |
      328 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:325:24)

  ● Unmocked: GET /users/profile/:userId › should reject unauthenticated profile request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      334 |       .get(`/api/users/profile/${otherUser._id}`);
      335 |
    > 336 |     expect(res.status).toStrictEqual(401);
          |                        ^
      337 |   });
      338 | });
      339 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:336:24)

FAIL tests/mocked/friendRoutes.mocked.test.ts
  ● Friend Routes - Mocked Error Tests › POST /request error handling › should handle notification service failure gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      194 |
      195 |       // Should still succeed even if notification fails
    > 196 |       expect(res.status).toBe(200);
          |                          ^
      197 |       expect(res.body.success).toBe(true);
      198 |     });
      199 |   });

      at Object.<anonymous> (tests/mocked/friendRoutes.mocked.test.ts:196:26)

FAIL tests/unmocked/watchlistOperations.unmocked.test.ts (15.18 s)
  ● Unmocked: POST /watchlist - Additional Tests › should add movie to watchlist with all fields

    expect(received).toBeDefined()

    Received: undefined

      61 |     expect(res.status).toStrictEqual(201);
      62 |     expect(res.body.success).toStrictEqual(true);
    > 63 |     expect(res.body.watchlistItem).toBeDefined();
         |                                    ^
      64 |     expect(res.body.watchlistItem.movieId).toStrictEqual(mockMovies.inception.id);
      65 |
      66 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:63:36)

  ● Unmocked: POST /watchlist - Additional Tests › should reject duplicate movie in watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      119 |       });
      120 |
    > 121 |     expect(res.status).toStrictEqual(400);
          |                        ^
      122 |     expect(res.body.message).toMatch(/already|watchlist/i);
      123 |   });
      124 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:121:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing year

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      171 |       });
      172 |
    > 173 |     expect(res.status).toStrictEqual(400);
          |                        ^
      174 |   });
      175 |
      176 |   // Input: Missing posterUrl

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:173:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing posterUrl

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      188 |       });
      189 |
    > 190 |     expect(res.status).toStrictEqual(400);
          |                        ^
      191 |   });
      192 |
      193 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:190:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      296 |       .set('Authorization', `Bearer ${token}`);
      297 |
    > 298 |     expect(res.status).toStrictEqual(200);
          |                        ^
      299 |     expect(res.body.success).toStrictEqual(true);
      300 |
      301 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:298:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete only specified movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      343 |       .set('Authorization', `Bearer ${token}`);
      344 |
    > 345 |     expect(res.status).toStrictEqual(200);
          |                        ^
      346 |
      347 |     const deletedItem = await WatchlistItem.findOne({
      348 |       userId: user._id,

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:345:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should reject unauthenticated delete request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      366 |       .delete(`/api/watchlist/${mockMovies.inception.id}`);
      367 |
    > 368 |     expect(res.status).toStrictEqual(401);
          |                        ^
      369 |   });
      370 |
      371 |   // Input: Invalid movieId format

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:368:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should handle invalid movieId format

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [400, 404]

      378 |       .set('Authorization', `Bearer ${token}`);
      379 |
    > 380 |     expect([400, 404]).toContain(res.status);
          |                        ^
      381 |   });
      382 | });
      383 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:380:24)

  ● Unmocked: GET /watchlist - Additional Tests › should get multiple watchlist items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      443 |
      444 |     expect(res.status).toStrictEqual(200);
    > 445 |     expect(Array.isArray(res.body.watchlist || res.body)).toBe(true);
          |                                                           ^
      446 |     const watchlist = res.body.watchlist || res.body;
      447 |     expect(watchlist.length).toStrictEqual(2);
      448 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:445:59)

  ● Unmocked: GET /watchlist - Additional Tests › should return only authenticated user watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 1
    Received: undefined

      475 |     expect(res.status).toStrictEqual(200);
      476 |     const watchlist = res.body.watchlist || res.body;
    > 477 |     expect(watchlist.length).toStrictEqual(1);
          |                              ^
      478 |     expect(watchlist[0].movieId).toStrictEqual(mockMovies.inception.id);
      479 |   });
      480 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:477:30)

  ● Unmocked: GET /watchlist - Additional Tests › should return empty array for empty watchlist

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      490 |     expect(res.status).toStrictEqual(200);
      491 |     const watchlist = res.body.watchlist || res.body;
    > 492 |     expect(Array.isArray(watchlist)).toBe(true);
          |                                      ^
      493 |     expect(watchlist.length).toStrictEqual(0);
      494 |   });
      495 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:492:38)

  ● Unmocked: GET /watchlist - Additional Tests › should return complete movie details in watchlist

    TypeError: Cannot read properties of undefined (reading 'title')

      527 |     expect(res.status).toStrictEqual(200);
      528 |     const watchlist = res.body.watchlist || res.body;
    > 529 |     expect(watchlist[0].title).toStrictEqual(mockMovies.inception.title);
          |                         ^
      530 |     expect(watchlist[0].year).toStrictEqual(mockMovies.inception.year);
      531 |     expect(watchlist[0].rating).toStrictEqual(mockMovies.inception.rating);
      532 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:529:25)

FAIL tests/unmocked/quote.unmocked.test.ts
  ● Unmocked: GET /quotes › should return quote for movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      45 |       .query({ title: 'Inception' });
      46 |
    > 47 |     expect(res.status).toStrictEqual(200);
         |                        ^
      48 |     expect(res.body).toHaveProperty('quote');
      49 |   });
      50 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:47:24)

  ● Unmocked: GET /quotes › should return fallback quote for unknown movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      59 |       .query({ title: 'NonexistentMoviexyz123' });
      60 |
    > 61 |     expect(res.status).toStrictEqual(200);
         |                        ^
      62 |     expect(res.body).toHaveProperty('quote');
      63 |   });
      64 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:61:24)

  ● Unmocked: GET /quotes › should reject unauthenticated quote request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      72 |       .query({ title: 'Inception' });
      73 |
    > 74 |     expect(res.status).toStrictEqual(401);
         |                        ^
      75 |   });
      76 |
      77 |   // Input: Missing title query parameter

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:74:24)

  ● Unmocked: GET /quotes › should reject quote request without title

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      84 |       .set('Authorization', `Bearer ${token}`);
      85 |
    > 86 |     expect(res.status).toStrictEqual(400);
         |                        ^
      87 |   });
      88 | });
      89 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:86:24)

FAIL tests/unmocked/watchlistRoutes.unmocked.test.ts
  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle very long movie titles

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      521 |         });
      522 |
    > 523 |       expect(res.status).toBe(200);
          |                          ^
      524 |       expect(res.body.data.title).toBe(longTitle);
      525 |     });
      526 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:523:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle special characters in title

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      536 |         });
      537 |
    > 538 |       expect(res.status).toBe(200);
          |                          ^
      539 |       expect(res.body.data.title).toBe(specialTitle);
      540 |     });
      541 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:538:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle large movieId numbers

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      565 |         });
      566 |
    > 567 |       expect(res.status).toBe(200);
          |                          ^
      568 |       expect(res.body.data.movieId).toBe(largeId);
      569 |     });
      570 |   });

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:567:26)

FAIL tests/unmocked/movie.unmocked.test.ts (18.506 s)
  ● Unmocked: GET /movies/search › should return search results for valid movie query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      46 |       .query({ query: 'Inception' });
      47 |
    > 48 |     expect(res.status).toStrictEqual(200);
         |                        ^
      49 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      50 |   });
      51 |

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:48:24)

  ● Unmocked: DELETE /movies/ranked/:id › should delete ranked movie and adjust ranks

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      216 |       .set('Authorization', `Bearer ${token}`);
      217 |
    > 218 |     expect(res.status).toStrictEqual(200);
          |                        ^
      219 |
      220 |     // Verify movie is deleted
      221 |     const remaining = await RankedMovie.find({ userId: user._id });

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:218:24)

FAIL tests/unmocked/auth.unmocked.test.ts (18.659 s)
  ● Unmocked: POST /auth/signin › should successfully sign in an existing user

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      63 |       });
      64 |
    > 65 |     expect(res.status).toStrictEqual(200);
         |                        ^
      66 |     expect(res.body).toHaveProperty('user');
      67 |     expect(res.body).toHaveProperty('token');
      68 |     expect(res.body.user.email).toStrictEqual('test@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:65:24)

  ● Unmocked: POST /auth/signin › should reject signin for non-existent user

    expect(received).toMatch(expected)

    Expected pattern: /not found|error/i
    Received string:  "Invalid Google token"

      101 |
      102 |     expect([400, 404]).toContain(res.status);
    > 103 |     expect(res.body.message).toMatch(/not found|error/i);
          |                              ^
      104 |   });
      105 | });
      106 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:103:30)

  ● Unmocked: POST /auth/signup › should successfully create a new user account

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 201
    Received: 400

      143 |       });
      144 |
    > 145 |     expect(res.status).toStrictEqual(201);
          |                        ^
      146 |     expect(res.body).toHaveProperty('user');
      147 |     expect(res.body).toHaveProperty('token');
      148 |     expect(res.body.user.email).toStrictEqual('newuser@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:145:24)

  ● Unmocked: POST /auth/signup › should reject signup with existing email

    expect(received).toMatch(expected)

    Expected pattern: /already exists|duplicate/i
    Received string:  "Invalid Google token"

      194 |
      195 |     expect(res.status).toStrictEqual(400);
    > 196 |     expect(res.body.message).toMatch(/already exists|duplicate/i);
          |                              ^
      197 |   });
      198 | });
      199 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:196:30)

FAIL tests/unmocked/friendOperations.unmocked.test.ts (18.828 s)
  ● Unmocked: POST /friends/request - Additional Tests › should reject duplicate friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      104 |       .send({ email: user2.email });
      105 |
    > 106 |     expect(res.status).toStrictEqual(400);
          |                        ^
      107 |     expect(res.body.message).toMatch(/already|pending/i);
      108 |   });
      109 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:106:24)

  ● Unmocked: POST /friends/request - Additional Tests › should reject request to existing friend

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      124 |       .send({ email: user2.email });
      125 |
    > 126 |     expect(res.status).toStrictEqual(400);
          |                        ^
      127 |     expect(res.body.message).toMatch(/already.*friend/i);
      128 |   });
      129 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:126:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should accept friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      209 |       });
      210 |
    > 211 |     expect(res.status).toStrictEqual(200);
          |                        ^
      212 |     expect(res.body.success).toStrictEqual(true);
      213 |
      214 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:211:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should reject friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      241 |       });
      242 |
    > 243 |     expect(res.status).toStrictEqual(200);
          |                        ^
      244 |     expect(res.body.success).toStrictEqual(true);
      245 |
      246 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:243:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should return 404 for non-existent request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 404
    Received: 400

      284 |       });
      285 |
    > 286 |     expect(res.status).toStrictEqual(404);
          |                        ^
      287 |   });
      288 |
      289 |   // Input: Missing requestId

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:286:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should remove friend (bidirectional)

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      369 |       .set('Authorization', `Bearer ${token1}`);
      370 |
    > 371 |     expect(res.status).toStrictEqual(200);
          |                        ^
      372 |     expect(res.body.success).toStrictEqual(true);
      373 |
      374 |     const friendship1 = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:371:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject invalid friend ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      407 |       .set('Authorization', `Bearer ${token1}`);
      408 |
    > 409 |     expect(res.status).toStrictEqual(400);
          |                        ^
      410 |   });
      411 |
      412 |   // Input: Remove self as friend

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:409:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject removing self

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      419 |       .set('Authorization', `Bearer ${token1}`);
      420 |
    > 421 |     expect(res.status).toStrictEqual(400);
          |                        ^
      422 |   });
      423 | });
      424 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:421:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by email

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      463 |       .query({ query: 'searchable' });
      464 |
    > 465 |     expect(res.status).toStrictEqual(200);
          |                        ^
      466 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      467 |   });
      468 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:465:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by name

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      477 |       .query({ query: 'Searchable' });
      478 |
    > 479 |     expect(res.status).toStrictEqual(200);
          |                        ^
      480 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      481 |   });
      482 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:479:24)

  ● Unmocked: GET /friends/search - Search Users › should reject empty search query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      491 |       .query({ query: '' });
      492 |
    > 493 |     expect(res.status).toStrictEqual(400);
          |                        ^
      494 |   });
      495 |
      496 |   // Input: Search with no matches

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:493:24)

  ● Unmocked: GET /friends/search - Search Users › should return empty array for no matches

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      504 |       .query({ query: 'nonexistentuser12345' });
      505 |
    > 506 |     expect(res.status).toStrictEqual(200);
          |                        ^
      507 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      508 |   });
      509 | });

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:506:24)

FAIL tests/nfr/performance.test.ts (18.954 s)
  ● NFR: Performance - Response Time › should respond to GET /movies/ranked within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      60 |     const responseTime = Date.now() - startTime;
      61 |
    > 62 |     expect(res.status).toStrictEqual(200);
         |                        ^
      63 |     expect(responseTime).toBeLessThan(ACCEPTABLE_RESPONSE_TIME_MS);
      64 |   });
      65 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:62:24)

  ● NFR: Performance - Response Time › should sign out user within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      75 |     const responseTime = Date.now() - startTime;
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(responseTime).toBeLessThan(500);
      79 |   });
      80 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:77:24)

  ● NFR: Performance - Response Time › should limit feed results to prevent memory bloat

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      117 |       .set('Authorization', `Bearer ${token}`);
      118 |
    > 119 |     expect(res.status).toStrictEqual(200);
          |                        ^
      120 |     expect(Array.isArray(res.body)).toBe(true);
      121 |     // Feed should limit results, verify it's not unbounded
      122 |     expect(res.body.length).toBeLessThanOrEqual(50);

      at Object.<anonymous> (tests/nfr/performance.test.ts:119:24)

  ● NFR: Performance - Database Index Efficiency › should efficiently fetch ranked movies using indexes

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      166 |     const queryTime = Date.now() - startTime;
      167 |
    > 168 |     expect(res.status).toStrictEqual(200);
          |                        ^
      169 |     expect(Array.isArray(res.body)).toBe(true);
      170 |     expect(res.body.length).toBe(100);
      171 |     // With proper indexing, 100 items should still be fast

      at Object.<anonymous> (tests/nfr/performance.test.ts:168:24)

  ● NFR: Performance - Bulk Operations › should complete cascade delete within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      236 |     const deleteTime = Date.now() - startTime;
      237 |
    > 238 |     expect(res.status).toStrictEqual(200);
          |                        ^
      239 |     expect(deleteTime).toBeLessThan(ACCEPTABLE_BULK_TIME_MS);
      240 |   });
      241 | });

      at Object.<anonymous> (tests/nfr/performance.test.ts:238:24)

FAIL tests/unmocked/feedRouteHandlers.unmocked.test.ts (21.797 s)
  ● Feed Route Handlers - Inline Handlers › should establish SSE stream

    thrown: "Exceeded timeout of 10000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      289 |
      290 |   // Test Case 12: GET /stream (SSE)
    > 291 |   it('should establish SSE stream', async () => {
          |   ^
      292 |     const res = await request(app)
      293 |       .get('/stream')
      294 |       .set('Authorization', `Bearer ${token1}`)

      at tests/unmocked/feedRouteHandlers.unmocked.test.ts:291:3
      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:19:1)

  ● Feed Route Handlers - Inline Handlers › should like an activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      313 |       .set('Authorization', `Bearer ${token1}`);
      314 |
    > 315 |     expect(res.status).toBe(200);
          |                        ^
      316 |
      317 |     // Verify like was created
      318 |     const like = await Like.findOne({

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:315:24)

  ● Feed Route Handlers - Inline Handlers › should allow liking own activity without notification

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      348 |       .set('Authorization', `Bearer ${token1}`);
      349 |
    > 350 |     expect(res.status).toBe(200);
          |                        ^
      351 |   });
      352 |
      353 |   // Test Case 16: POST /:activityId/like duplicate

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:350:24)

  ● Feed Route Handlers - Inline Handlers › should handle duplicate like gracefully

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400, 409, 500]

      372 |
      373 |     // Should handle duplicate (unique index error)
    > 374 |     expect([200, 400, 409, 500]).toContain(res.status);
          |                                  ^
      375 |   });
      376 |
      377 |   // Test Case 17: DELETE /:activityId/like

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:374:34)

  ● Feed Route Handlers - Inline Handlers › should unlike an activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      395 |       .set('Authorization', `Bearer ${token1}`);
      396 |
    > 397 |     expect(res.status).toBe(200);
          |                        ^
      398 |
      399 |     // Verify like was deleted
      400 |     const like = await Like.findOne({

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:397:24)

  ● Feed Route Handlers - Inline Handlers › should get comments for an activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      450 |       .set('Authorization', `Bearer ${token1}`);
      451 |
    > 452 |     expect(res.status).toBe(200);
          |                        ^
      453 |   });
      454 |
      455 |   // Test Case 20: GET /:activityId/comments with no comments

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:452:24)

  ● Feed Route Handlers - Inline Handlers › should return empty array when no comments

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      467 |       .set('Authorization', `Bearer ${token1}`);
      468 |
    > 469 |     expect(res.status).toBe(200);
          |                        ^
      470 |   });
      471 |
      472 |   // Test Case 21: POST /:activityId/comments

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:469:24)

  ● Feed Route Handlers - Inline Handlers › should add comment to activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      485 |       .send({ text: 'Great movie!' });
      486 |
    > 487 |     expect(res.status).toBe(200);
          |                        ^
      488 |
      489 |     // Verify comment was created
      490 |     const comment = await Comment.findOne({

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:487:24)

  ● Feed Route Handlers - Inline Handlers › should reject comment without text

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 404

      510 |       .send({});
      511 |
    > 512 |     expect(res.status).toBe(400);
          |                        ^
      513 |   });
      514 |
      515 |   // Test Case 23: POST /:activityId/comments on non-existent activity

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:512:24)

  ● Feed Route Handlers - Inline Handlers › should send notification when commenting

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      540 |       .send({ text: 'Amazing!' });
      541 |
    > 542 |     expect(res.status).toBe(200);
          |                        ^
      543 |   });
      544 |
      545 |   // Test Case 25: POST /:activityId/comments on own activity (no notification)

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:542:24)

  ● Feed Route Handlers - Inline Handlers › should not send notification when commenting on own activity

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      558 |       .send({ text: 'Self comment' });
      559 |
    > 560 |     expect(res.status).toBe(200);
          |                        ^
      561 |   });
      562 |
      563 |   // Test Case 26: Unauthorized access to feed

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:560:24)

  ● Feed Route Handlers - Inline Handlers › should reject unauthorized like

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      598 |       .post(`/api/feed/${(activity as any)._id.toString()}/like`);
      599 |
    > 600 |     expect(res.status).toBe(401);
          |                        ^
      601 |   });
      602 |
      603 |   // Test Case 30: Unauthorized comment

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:600:24)

  ● Feed Route Handlers - Inline Handlers › should reject unauthorized comment

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      615 |       .send({ text: 'Comment' });
      616 |
    > 617 |     expect(res.status).toBe(401);
          |                        ^
      618 |   });
      619 | });

      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:617:24)


Test Suites: 23 failed, 18 passed, 41 total
Tests:       157 failed, 579 passed, 736 total
Snapshots:   0 total
Time:        36.152 s
Ran all test suites.
