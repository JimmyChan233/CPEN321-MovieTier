
> movietier-backend@1.0.0 test
> jest

[2m[2025-10-29T06:53:41.763Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:41.760Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:41.759Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:41.761Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:41.778Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:41.782Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:41.833Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:43.509Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:43.622Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 137ms: Request failed with status code 401
[2m[2025-10-29T06:53:44.257Z][0m [36mINFO[0m Profile update request for user 6901b9f77c134792a9328be9 {
  "name": "updating"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 75ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:44.431Z][0m [32mSUCCESS[0m Profile updated for user 6901b9f77c134792a9328be9
[2m[2025-10-29T06:53:44.464Z][0m [36mINFO[0m Profile update request for user 6901b9f77c134792a9328be9 {
  "name": "unchanged"
}
[2m[2025-10-29T06:53:44.464Z][0m [33mWARN[0m Profile update failed: no name provided
[2m[2025-10-29T06:53:44.471Z][0m [36mINFO[0m Profile update request for user 6901b9f77c134792a9328be9 {
  "name": "updating"
}
[2m[2025-10-29T06:53:44.474Z][0m [32mSUCCESS[0m Profile updated for user 6901b9f77c134792a9328be9
[2m[2025-10-29T06:53:44.479Z][0m [36mINFO[0m Profile update request for user 6901b9f77c134792a9328be9 {
  "name": "unchanged"
}
[2m[2025-10-29T06:53:44.479Z][0m [33mWARN[0m Profile update failed: no name provided
[2m[2025-10-29T06:53:44.483Z][0m [36mINFO[0m Profile update request for user 6901b9f77c134792a9328be9 {
  "name": "updating"
}
[2m[2025-10-29T06:53:44.483Z][0m [33mWARN[0m Profile update failed: empty name
🌐 TMDB ⬅️  GET /movie/27205 ERROR 68ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 123ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 117ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 74ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 115ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/157336 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:44.960Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.033Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.107Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 157336,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.181Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.252Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/157336/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.323Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 157336,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.397Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155/recommendations ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.472Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/157336/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 112ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/157336/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.543Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 157336,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /search/movie params={"query":"Inception","include_adult":false,"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 76ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.636Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.706Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /search/movie ERROR 156ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205 ERROR 127ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205 ERROR 131ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 141ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.848Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:45.939Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27206 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 76ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27206 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.010Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27206,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27207 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 138ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27207 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.079Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27207,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27208 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 99ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27208 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.150Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27208,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27209 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 71ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/278 ERROR 69ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27209 ERROR 96ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.246Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27209,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.312Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27206/similar params={"language":"en-US","page":1,"api_key":"***"}
[2m[2025-10-29T06:53:46.365Z][0m [31mERROR[0m Error sending feed notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/278 ERROR 169ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27206/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.381Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27206,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27207/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.491Z][0m [31mERROR[0m Error sending feed notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/278 ERROR 117ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27207/similar ERROR 137ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.519Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27207,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.588Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27206/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 73ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/200000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27206/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.662Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27206,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27207/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000 ERROR 70ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/200000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 135ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27207/recommendations ERROR 143ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.805Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27207,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000 ERROR 126ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:46.915Z][0m [31mERROR[0m Error sending feed notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/278 ERROR 147ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /trending/movie/week ERROR 152ms: Request failed with status code 401
[2m[2025-10-29T06:53:46.962Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
FAIL tests/unmocked/rerankController.unmocked.test.ts (10.084 s)
  Rerank Controller - Complete Coverage
    ✓ should reject missing rankedId (32 ms)
    ✓ should reject invalid rankedId format (8 ms)
    ✓ should reject empty string rankedId (5 ms)
    ✓ should reject null rankedId (5 ms)
    ✓ should return 404 when ranked movie not found (9 ms)
    ✓ should return 404 when trying to rerank another users movie (124 ms)
    ✓ should remove movie and decrement ranks of higher movies (28 ms)
    ✓ should handle removing movie from rank 1 (21 ms)
    ✓ should handle removing movie from last rank (17 ms)
    ✓ should insert at rank 1 when list becomes empty (19 ms)
    ✓ should preserve movie data when reinserting after empty list (10 ms)
    ✓ should start comparison session with remaining movies (11 ms)
    ✓ should calculate correct middle index for comparison (15 ms)
    ✓ should return compareWith with all required fields (13 ms)
    ✓ should handle movie without posterPath (11 ms)
    ✓ should handle rerank with 2 movies (17 ms)
    ✓ should handle rerank with 20 movies (21 ms)
    ✓ should handle database error gracefully (95 ms)
    ✓ should handle error during rank update (19 ms)
    ✕ should handle reranking immediately after ranking (7 ms)
    ✕ should handle movie with special characters in title (1 ms)
    ✕ should handle rerank of movie with very long title (1 ms)

  ● Rerank Controller - Complete Coverage › should handle reranking immediately after ranking

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      529 |       .send({ rankedId: (movie as any)._id.toString() });
      530 |
    > 531 |     expect(res.status).toBe(200);
          |                        ^
      532 |     expect(res.body.status).toBe('added');
      533 |   });
      534 |

      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:531:24)

  ● Rerank Controller - Complete Coverage › should handle movie with special characters in title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

  ● Rerank Controller - Complete Coverage › should handle rerank of movie with very long title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

🌐 TMDB ⬅️  GET /movie/238 ERROR 235ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 220ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205 ERROR 194ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.177Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
[2m[2025-10-29T06:53:47.192Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.247Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 144ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.317Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27219 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27218 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27217 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27216 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27215 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27214 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27213 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27212 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.400Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27219 ERROR 84ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27217 ERROR 91ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27218 ERROR 151ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27216 ERROR 163ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27213 ERROR 225ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27215 ERROR 233ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 234ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.634Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27214 ERROR 308ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27212 ERROR 378ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 153ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.788Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 76ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205 ERROR 77ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/27205 ERROR 106ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.910Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:47.982Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
[2m[2025-10-29T06:53:48.027Z][0m [32mSUCCESS[0m FCM token registered for user 6901b9fb7c134792a9328bf0
[2m[2025-10-29T06:53:48.040Z][0m [32mSUCCESS[0m FCM token registered for user 6901b9fb7c134792a9328bf0
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:48.054Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/similar params={"language":"en-US","page":1,"api_key":"***"}
PASS tests/unmocked/movieComparisonAdvanced.unmocked.test.ts (11.177 s)
  Advanced Movie Comparison Controller Tests
    ✓ should complete binary search taking left path (60 ms)
    ✓ should complete binary search taking right path (21 ms)
    ✓ should remove movie from watchlist when ranking (22 ms)
    ✓ should handle comparison with 10 existing movies (34 ms)
    ✓ should correctly rank movie at position 1 (13 ms)
    ✓ should correctly rank movie at last position (11 ms)
    ✓ should handle multiple watchlist items during ranking (25 ms)
    ✓ should handle comparison with exact middle movie selection (12 ms)
    ✓ should handle invalid movie ID in comparison (10 ms)
    ✓ should handle comparison without active ranking session (4 ms)
    ✓ should handle ranking with incomplete movie data (5 ms)
    ✓ should handle sequential ranking of multiple movies (10 ms)
    ✓ should handle ranking 15 movies with comparisons (92 ms)
    ✓ should handle all preference combinations in 4-movie ranking (9 ms)
    ✓ should handle deep binary search with 20 movies (26 ms)

🌐 TMDB ⬅️  GET /movie/155/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:48.128Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:48.198Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/155/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:48.268Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901b9f74524f97f5e7f0897",
  "movieId": 155,
  "error": "Request failed with status code 401"
}
FAIL tests/unmocked/movieComparisonController.unmocked.test.ts (11.886 s)
  Movie Comparison Controller - Complete Coverage
    ✓ should add first movie with rank 1 (56 ms)
    ✓ should remove from watchlist when adding first movie (222 ms)
    ✓ should create feed activity when adding first movie (22 ms)
    ✓ should delete old feed activities when adding first movie (97 ms)
    ✓ should enrich missing posterPath and overview from TMDB (117 ms)
    ✓ should send SSE notification to friends when adding first movie (274 ms)
    ✓ should handle FCM notification failure gracefully (126 ms)
    ✓ should reject duplicate movie (10 ms)
    ✓ should remove from watchlist even for duplicate movie (15 ms)
    ✓ should start comparison session with existing movies (19 ms)
    ✓ should remove from watchlist when starting comparison (11 ms)
    ✓ should calculate middle index correctly for comparison (8 ms)
    ✕ should reject comparison without active session (8 ms)
    ✓ should handle preferring new movie in comparison (15 ms)
    ✓ should handle preferring existing movie in comparison (15 ms)
    ✕ should finalize ranking when low > high (14 ms)
    ✕ should update ranks when finalizing (14 ms)
    ✓ should create feed activity when finalizing (100 ms)
    ✓ should send notifications when finalizing (183 ms)
    ✓ should continue comparison when not finalized (23 ms)
    ✓ should handle error in addMovie (37 ms)
    ✓ should handle error in compareMovies (27 ms)

  ● Movie Comparison Controller - Complete Coverage › should reject comparison without active session

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      354 |       });
      355 |
    > 356 |     expect(res.status).toBe(400);
          |                        ^
      357 |     expect(res.body.message).toContain('No active comparison');
      358 |   });
      359 |

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:356:24)

  ● Movie Comparison Controller - Complete Coverage › should finalize ranking when low > high

    expect(received).toBe(expected) // Object.is equality

    Expected: "added"
    Received: "compare"

      490 |       });
      491 |
    > 492 |     expect(res.body.status).toBe('added');
          |                             ^
      493 |     const movie = await RankedMovie.findOne({
      494 |       userId: user1._id,
      495 |       movieId: 200000

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:492:29)

  ● Movie Comparison Controller - Complete Coverage › should update ranks when finalizing

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 2

      533 |
      534 |     const movies = await RankedMovie.find({ userId: user1._id }).sort({ rank: 1 });
    > 535 |     expect(movies.length).toBe(3);
          |                           ^
      536 |   });
      537 |
      538 |   it('should create feed activity when finalizing', async () => {

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:535:27)

🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 71ms: Request failed with status code 401
PASS tests/unmocked/allFeedRoutes.unmocked.test.ts (12.707 s)
  Comprehensive Feed Routes Tests
    ✓ should get empty feed with no friends (44 ms)
    ✓ should get feed with friend activities (331 ms)
    ✓ should like a feed activity (28 ms)
    ✓ should handle duplicate like (22 ms)
    ✓ should unlike a feed activity (15 ms)
    ✓ should get comments for activity (15 ms)
    ✓ should add comment to activity (21 ms)
    ✓ should handle empty comment (9 ms)
    ✓ should handle long comment (11 ms)
    ✓ should handle liking non-existent activity (13 ms)
    ✓ should handle unliking when no like exists (9 ms)
    ✓ should handle commenting on non-existent activity (7 ms)
    ✓ should handle feed pagination (420 ms)
    ✓ should get multiple comments (13 ms)
    ✓ should handle different activity types (106 ms)
    ✓ should reject unauthorized feed access (5 ms)
    ✓ should handle invalid activity ID format (5 ms)

FAIL tests/unmocked/allRecommendationRoutes.unmocked.test.ts (12.856 s)
  Comprehensive Recommendation Routes Tests
    ✓ should get recommendations with no ranked movies (31 ms)
    ✓ should get recommendations based on ranked movies (785 ms)
    ✓ should handle recommendations with minimal data (303 ms)
    ✓ should handle recommendations with many ranked movies (957 ms)
    ✓ should get trending movie recommendations (160 ms)
    ✓ should handle trending without auth (4 ms)
    ✓ should incorporate friend rankings in recommendations (347 ms)
    ✓ should handle recommendation query parameters (471 ms)
    ✓ should reject unauthorized recommendation request (4 ms)
    ✓ should handle recommendations with different genres (477 ms)
    ✕ should handle recommendation errors gracefully (3 ms)

  ● Comprehensive Recommendation Routes Tests › should handle recommendation errors gracefully

    ValidationError: RankedMovie validation failed: movieId: Path `movieId` is required., title: Path `title` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1416:9

[2m[2025-10-29T06:53:50.178Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d0479fc {
  "name": "updating"
}
[2m[2025-10-29T06:53:50.182Z][0m [32mSUCCESS[0m Profile updated for user 6901b9fe485471994d0479fc
[2m[2025-10-29T06:53:50.190Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d047a06 {
  "name": "updating"
}
[2m[2025-10-29T06:53:50.192Z][0m [32mSUCCESS[0m Profile updated for user 6901b9fe485471994d047a06
[2m[2025-10-29T06:53:50.197Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d047a0f {
  "name": "unchanged"
}
[2m[2025-10-29T06:53:50.197Z][0m [33mWARN[0m Profile update failed: no name provided
[2m[2025-10-29T06:53:50.201Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d047a17 {
  "name": "unchanged"
}
[2m[2025-10-29T06:53:50.201Z][0m [33mWARN[0m Profile update failed: no name provided
[2m[2025-10-29T06:53:50.206Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d047a1f {
  "name": "updating"
}
[2m[2025-10-29T06:53:50.206Z][0m [33mWARN[0m Profile update failed: empty name
[2m[2025-10-29T06:53:50.212Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d047a2d {
  "name": "updating"
}
[2m[2025-10-29T06:53:50.213Z][0m [31mERROR[0m Profile update failed: user 6901b9fe485471994d047a2d not found
[2m[2025-10-29T06:53:50.219Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d047a31 {
  "name": "updating"
}
[2m[2025-10-29T06:53:50.222Z][0m [32mSUCCESS[0m Profile updated for user 6901b9fe485471994d047a31
[2m[2025-10-29T06:53:50.230Z][0m [36mINFO[0m Profile update request for user 6901b9fe485471994d047a3b {
  "name": "updating"
}
[2m[2025-10-29T06:53:50.232Z][0m [31mERROR[0m Profile update error: {
  "errorLabelSet": {}
}
[2m[2025-10-29T06:53:50.246Z][0m [32mSUCCESS[0m FCM token registered for user 6901b9fe485471994d047a47
[2m[2025-10-29T06:53:50.255Z][0m [32mSUCCESS[0m FCM token registered for user 6901b9fe485471994d047a51
[2m[2025-10-29T06:53:50.262Z][0m [32mSUCCESS[0m FCM token registered for user 6901b9fe485471994d047a5c
[2m[2025-10-29T06:53:50.296Z][0m [31mERROR[0m FCM token registration error: {
  "errorLabelSet": {}
}
FAIL tests/unmocked/friendRoutesAdvanced.unmocked.test.ts
  Advanced Friend Routes Tests
    ✓ should send friend request using email (18 ms)
    ✓ should create bilateral friendship on accept (18 ms)
    ✕ should remove bilateral friendships on delete (10 ms)
    ✓ should reject friend request with accept=false (8 ms)
    ✓ should reject friend request to self (4 ms)
    ✓ should reject duplicate friend request (10 ms)
    ✓ should handle reverse pending request (6 ms)
    ✓ should get all friends with populated data (21 ms)
    ✓ should get pending requests with sender populated (6 ms)
    ✓ should get detailed pending requests (9 ms)
    ✓ should get outgoing friend requests (7 ms)
    ✓ should get detailed outgoing friend requests (10 ms)
    ✓ should handle request to non-existent email (3 ms)
    ✓ should reject invalid email format (2 ms)
    ✓ should reject request without email (3 ms)
    ✓ should handle respond to non-existent request (4 ms)
    ✓ should reject respond to request for different receiver (5 ms)
    ✓ should reject respond to already accepted request (6 ms)
    ✓ should reject respond to already rejected request (5 ms)
    ✓ should handle delete of non-existent friendship (3 ms)
    ✓ should handle delete with invalid friendId format (4 ms)
    ✓ should reject unauthorized access to friends list (3 ms)
    ✓ should reject unauthorized access to pending requests (2 ms)
    ✓ should reject unauthorized friend request (4 ms)
    ✓ should reject unauthorized respond (4 ms)
    ✓ should reject unauthorized delete friendship (4 ms)
    ✓ should handle multiple rapid friend requests (6 ms)
    ✓ should reject request to existing friend (14 ms)
    ✓ should get empty friends list when no friends (6 ms)
    ✓ should get empty pending requests when none exist (3 ms)
    ✓ should get empty detailed requests when none exist (4 ms)
    ✓ should get empty outgoing requests when none exist (3 ms)
    ✓ should get empty detailed outgoing requests when none exist (3 ms)
    ✓ should handle respond with missing accept field (5 ms)
    ✓ should handle respond with missing requestId field (4 ms)
    ✓ should handle complex friendship network (19 ms)
    ✓ should prevent double acceptance of friend request (17 ms)
    ✓ should handle invalid requestId format in respond (4 ms)
    ✓ should only return pending requests, not accepted/rejected (6 ms)
    ✓ should only return outgoing requests from user (5 ms)

  ● Advanced Friend Routes Tests › should remove bilateral friendships on delete

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

      114 |     const count2 = await Friendship.countDocuments({ userId: user2._id, friendId: user1._id });
      115 |
    > 116 |     expect(count1).toBe(0);
          |                    ^
      117 |     expect(count2).toBe(0);
      118 |   });
      119 |

      at Object.<anonymous> (tests/unmocked/friendRoutesAdvanced.unmocked.test.ts:116:20)

[2m[2025-10-29T06:53:50.879Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
FAIL tests/unmocked/movieComparison.unmocked.test.ts (14.103 s)
  Unmocked: POST /movies/rank
    ✓ should add first movie without comparison (230 ms)
    ✓ should start comparison for second movie (20 ms)
    ✓ should reject duplicate movie (11 ms)
    ✕ should reject missing required fields (9 ms)
    ✓ should reject unauthenticated rank request (6 ms)
    ✓ should remove movie from watchlist when ranked (152 ms)
  Unmocked: POST /movies/compare
    ✓ should process comparison choice (15 ms)
    ✕ should reject comparison without preferredMovieId (7 ms)
    ✕ should reject comparison without active session (90 ms)
    ✓ should reject unauthenticated compare request (9 ms)

  ● Unmocked: POST /movies/rank › should reject missing required fields

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      150 |       });
      151 |
    > 152 |     expect(res.status).toStrictEqual(400);
          |                        ^
      153 |   });
      154 |
      155 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:152:24)

  ● Unmocked: POST /movies/compare › should reject comparison without preferredMovieId

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      300 |       .send({});
      301 |
    > 302 |     expect(res.status).toStrictEqual(400);
          |                        ^
      303 |   });
      304 |
      305 |   // Input: No active comparison session

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:302:24)

  ● Unmocked: POST /movies/compare › should reject comparison without active session

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 200

      315 |       });
      316 |
    > 317 |     expect(res.status).toStrictEqual(400);
          |                        ^
      318 |   });
      319 |
      320 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:317:24)

🌐 TMDB ⬅️  GET /trending/movie/week ERROR 196ms: Request failed with status code 401
[2m[2025-10-29T06:53:51.207Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
[2m[2025-10-29T06:53:51.220Z][0m [36mINFO[0m Profile update request for user test-user-id {
  "name": "updating"
}
[2m[2025-10-29T06:53:51.220Z][0m [31mERROR[0m Profile update error: {}
[2m[2025-10-29T06:53:51.223Z][0m [31mERROR[0m FCM token registration error: {}
FAIL tests/mocked/apis.mocked.test.ts
  Mocked: Feed API Errors
    ✓ should handle feed fetch failure (7 ms)
    ✓ should handle like creation failure (6 ms)
    ✓ should handle invalid comment text (3 ms)
  Mocked: Friends API Errors
    ✕ should handle friends list fetch failure (5 ms)
    ✓ should handle friend request creation failure (5 ms)
    ✓ should handle user lookup failure (2 ms)
  Mocked: Watchlist API Errors
    ✕ should handle watchlist fetch failure (2 ms)
    ✓ should handle watchlist item creation failure (4 ms)
    ✓ should handle watchlist item deletion failure (3 ms)
  Mocked: Recommendations API Errors
    ✓ should handle trending movies fetch failure (240 ms)
    ✕ should handle recommendations generation failure
  Mocked: User API Errors
    ✕ should handle profile update failure (4 ms)
    ✕ should handle FCM token registration failure (2 ms)

  ● Mocked: Friends API Errors › should handle friends list fetch failure

    Database connection failed

       98 |   it('should handle friends list fetch failure', async () => {
       99 |     jest.spyOn(Friendship, 'find').mockRejectedValueOnce(
    > 100 |       new Error('Database connection failed')
          |       ^
      101 |     );
      102 |
      103 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:100:7)

  ● Mocked: Watchlist API Errors › should handle watchlist fetch failure

    Database connection lost

      163 |   it('should handle watchlist fetch failure', async () => {
      164 |     jest.spyOn(WatchlistItem, 'find').mockRejectedValueOnce(
    > 165 |       new Error('Database connection lost')
          |       ^
      166 |     );
      167 |
      168 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:165:7)

  ● Mocked: Recommendations API Errors › should handle recommendations generation failure

    Property `find` does not exist in the provided object

      244 |   // Expected output: Error message
      245 |   it('should handle recommendations generation failure', async () => {
    > 246 |     jest.spyOn(require('../../src/models/movie/RankedMovie'), 'find')
          |          ^
      247 |       .mockRejectedValueOnce(new Error('Database error'));
      248 |
      249 |     const res = await request(app)

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:246:10)

  ● Mocked: User API Errors › should handle profile update failure

    Database write failed

      273 |   it('should handle profile update failure', async () => {
      274 |     jest.spyOn(User, 'findByIdAndUpdate').mockRejectedValueOnce(
    > 275 |       new Error('Database write failed')
          |       ^
      276 |     );
      277 |
      278 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:275:7)

  ● Mocked: User API Errors › should handle FCM token registration failure

    Database write failed

      291 |   it('should handle FCM token registration failure', async () => {
      292 |     jest.spyOn(User, 'findByIdAndUpdate').mockRejectedValueOnce(
    > 293 |       new Error('Database write failed')
          |       ^
      294 |     );
      295 |
      296 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:293:7)

🌐 TMDB ➡️  GET  params={"query":"test","api_key":"***"}
🌐 TMDB ➡️  GET  params={"api_key":"***"}
🌐 TMDB ➡️  GET /test params={"api_key":"***"}
🌐 TMDB ➡️  GET /movie/123 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /test params={"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/123 200 100ms
🌐 TMDB ⬅️  GET /test 200 150ms
🌐 TMDB ⬅️  GET /test ERROR 50ms: Network Error
🌐 TMDB ⬅️  GET  ERROR: Network Error
FAIL tests/mocked/tmdbServices.mocked.test.ts
  TMDB Client Tests
    ✓ should create axios instance with correct baseURL (2 ms)
    ✓ should add API key to request params (1 ms)
    ✓ should use TMDB_KEY environment variable as fallback
    ✓ should handle request with no existing params
    ✕ should log outgoing request (2 ms)
    ✕ should redact API key in request logs (1 ms)
    ✕ should log successful response
    ✕ should calculate and log response time (1 ms)
    ✕ should log error response
    ✕ should handle error without config (1 ms)
  TMDB Tagline Service Tests
    ✓ should fetch tagline successfully (1 ms)
    ✓ should return cached tagline on cache hit
    ✓ should refetch after cache expires (1 ms)
    ✓ should search without year parameter (1 ms)
    ✓ should return null when no search results (1 ms)
    ✓ should return null when result has no ID
    ✓ should return null when movie has no tagline (1 ms)
    ✓ should return null when movie has empty tagline
    ✓ should return null on API error (1 ms)
    ✕ should treat titles as case-insensitive for caching (2 ms)
    ✓ should create different cache entries for same title with different years (2 ms)
    ✕ should handle year as string parameter (1 ms)
    ✓ should trim whitespace from title for cache key
    ✓ should include year in search query (1 ms)
    ✓ should send correct search parameters

  ● TMDB Client Tests › should log outgoing request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ➡️"

    Number of calls: 0

      140 |     getTmdbClient();
      141 |
    > 142 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      143 |       expect.stringContaining('TMDB ➡️')
      144 |     );
      145 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:142:27)

  ● TMDB Client Tests › should redact API key in request logs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "***"

    Number of calls: 0

      167 |     getTmdbClient();
      168 |
    > 169 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      170 |       expect.stringContaining('***')
      171 |     );
      172 |     expect(consoleLogSpy).not.toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:169:27)

  ● TMDB Client Tests › should log successful response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ⬅️"

    Number of calls: 0

      201 |     responseInterceptor(mockResponse);
      202 |
    > 203 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      204 |       expect.stringContaining('TMDB ⬅️')
      205 |     );
      206 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:203:27)

  ● TMDB Client Tests › should calculate and log response time

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringMatching /\d+ms/

    Number of calls: 0

      235 |     responseInterceptor(mockResponse);
      236 |
    > 237 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      238 |       expect.stringMatching(/\d+ms/)
      239 |     );
      240 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:237:27)

  ● TMDB Client Tests › should log error response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "ERROR"

    Number of calls: 0

      266 |     expect(() => errorInterceptor(mockError)).toThrow();
      267 |
    > 268 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      269 |       expect.stringContaining('ERROR')
      270 |     );
      271 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:268:27)

  ● TMDB Client Tests › should handle error without config

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      292 |
      293 |     expect(() => errorInterceptor(mockError)).toThrow();
    > 294 |     expect(consoleLogSpy).toHaveBeenCalled();
          |                           ^
      295 |   });
      296 | });
      297 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:294:27)

  ● TMDB Tagline Service Tests › should treat titles as case-insensitive for caching

    expect(received).toBe(expected) // Object.is equality

    Expected: "Cached"
    Received: "An amazing movie"

      519 |     const tagline = await fetchMovieTagline('TEST MOVIE', 2024);
      520 |
    > 521 |     expect(tagline).toBe('Cached');
          |                     ^
      522 |     expect(mockClient.get).toHaveBeenCalledTimes(2);
      523 |   });
      524 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:521:21)

  ● TMDB Tagline Service Tests › should handle year as string parameter

    expect(received).toBe(expected) // Object.is equality

    Expected: "String year"
    Received: "New tagline"

      570 |     const tagline = await fetchMovieTagline('Movie', '2024');
      571 |
    > 572 |     expect(tagline).toBe('String year');
          |                     ^
      573 |   });
      574 |
      575 |   // Test Case 23: Trim whitespace from title

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:572:21)

[2m[2025-10-29T06:53:51.373Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:51.393Z][0m [36mINFO[0m Test info message
[2m[2025-10-29T06:53:51.405Z][0m [36mINFO[0m User logged in {
  "userId": "123",
  "email": "test@example.com"
}
[2m[2025-10-29T06:53:51.406Z][0m [36mINFO[0m Multiple args arg1 123 true
[2m[2025-10-29T06:53:51.406Z][0m [32mSUCCESS[0m Operation completed
[2m[2025-10-29T06:53:51.406Z][0m [32mSUCCESS[0m Movie ranked {
  "movieId": 550,
  "rank": 1
}
[2m[2025-10-29T06:53:51.406Z][0m [33mWARN[0m API rate limit approaching
[2m[2025-10-29T06:53:51.407Z][0m [33mWARN[0m Slow query detected {
  "duration": 5000,
  "query": "complex query"
}
[2m[2025-10-29T06:53:51.407Z][0m [31mERROR[0m Database connection failed
[2m[2025-10-29T06:53:51.408Z][0m [31mERROR[0m Unexpected error {
  "error": "Something went wrong",
  "stack": "stack trace"
}
[2m[2025-10-29T06:53:51.409Z][0m [35mDEBUG[0m Debug information
[2m[2025-10-29T06:53:51.410Z][0m [35mDEBUG[0m State dump {
  "user": {
    "id": 1,
    "name": "Test"
  },
  "session": {
    "active": true
  }
}
[2m[2025-10-29T06:53:51.410Z][0m [1m[34mGET[0m /api/movies [32m200[0m [2m(45ms)[0m
[2m[2025-10-29T06:53:51.410Z][0m [1m[34mPOST[0m /api/auth/signin [32m[0m
[2m[2025-10-29T06:53:51.411Z][0m [1m[34mDELETE[0m /api/friends/123 [32m204[0m
[2m[2025-10-29T06:53:51.411Z][0m [1m[34mGET[0m /api/users [32m200[0m [2m(10ms)[0m
[2m[2025-10-29T06:53:51.411Z][0m [1m[34mPOST[0m /api/movies [31m404[0m [2m(20ms)[0m
[2m[2025-10-29T06:53:51.412Z][0m [1m[34mGET[0m /api/recommendations [31m500[0m [2m(100ms)[0m
[2m[2025-10-29T06:53:51.412Z][0m [1m[34mPUT[0m /api/profile [32m200[0m
[2m[2025-10-29T06:53:51.412Z][0m [1m[34mPATCH[0m /api/movies/123 [32m200[0m
[2m[2025-10-29T06:53:51.412Z][0m [1m[34mHEAD[0m /api/health [32m200[0m
[2m[2025-10-29T06:53:51.412Z][0m [36mINFO[0m Test message
[2m[2025-10-29T06:53:51.413Z][0m [36mINFO[0m Message string arg
[2m[2025-10-29T06:53:51.413Z][0m [36mINFO[0m Message 42 3.14
[2m[2025-10-29T06:53:51.414Z][0m [36mINFO[0m Message true false
[2m[2025-10-29T06:53:51.414Z][0m [36mINFO[0m Message {
  "key": "value",
  "nested": {
    "data": 123
  }
}
[2m[2025-10-29T06:53:51.414Z][0m [36mINFO[0m Message [
  1,
  2,
  3
]
[2m[2025-10-29T06:53:51.414Z][0m [36mINFO[0m Message null undefined
[2m[2025-10-29T06:53:51.415Z][0m [36mINFO[0m Message {}
[2m[2025-10-29T06:53:51.415Z][0m [36mINFO[0m Message []
[2m[2025-10-29T06:53:51.415Z][0m [36mINFO[0m Message 1
[2m[2025-10-29T06:53:51.415Z][0m [32mSUCCESS[0m Message 2
[2m[2025-10-29T06:53:51.415Z][0m [33mWARN[0m Message 3
[2m[2025-10-29T06:53:51.415Z][0m [31mERROR[0m Message 4
[2m[2025-10-29T06:53:51.415Z][0m [36mINFO[0m Complex data {
  "user": {
    "id": 123,
    "profile": {
      "name": "Test User",
      "preferences": {
        "theme": "dark",
        "notifications": true
      }
    }
  },
  "timestamp": "2025-10-29T06:53:51.415Z"
}
FAIL tests/unit/logger.unit.test.ts
  Logger Utility
    info
      ✕ should log info message (2 ms)
      ✕ should log info message with arguments
      ✕ should handle multiple arguments (1 ms)
    success
      ✕ should log success message
      ✕ should log success with object data
    warn
      ✕ should log warning message (1 ms)
      ✕ should log warning with details
    error
      ✕ should log error message
      ✕ should log error with error object
    debug
      ✕ should log debug message in development mode (1 ms)
      ✓ should NOT log debug message in production mode
      ✓ should NOT log debug message when NODE_ENV is test
      ✕ should log debug with detailed data in development (1 ms)
    http
      ✕ should log HTTP request with all parameters
      ✕ should log HTTP request without status code (1 ms)
      ✕ should log HTTP request without duration
      ✕ should handle successful status codes (200-399)
      ✕ should handle error status codes (400+) (1 ms)
      ✕ should handle server error status codes (500+)
      ✕ should handle various HTTP methods
    Timestamp formatting
      ✕ should include ISO timestamp in all log messages (1 ms)
    Argument formatting
      ✕ should format string arguments
      ✕ should format number arguments
      ✕ should format boolean arguments
      ✕ should format object arguments as JSON
      ✕ should format array arguments
      ✕ should handle null and undefined arguments
      ✕ should handle empty object (1 ms)
      ✕ should handle empty array
    Integration scenarios
      ✕ should handle rapid sequential log calls
      ✕ should handle complex nested objects

  ● Logger Utility › info › should log info message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      23 |       logger.info('Test info message');
      24 |
    > 25 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      26 |       const call = consoleLogSpy.mock.calls[0][0];
      27 |       expect(call).toContain('INFO');
      28 |       expect(call).toContain('Test info message');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:25:29)

  ● Logger Utility › info › should log info message with arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      32 |       logger.info('User logged in', { userId: '123', email: 'test@example.com' });
      33 |
    > 34 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      35 |       const call = consoleLogSpy.mock.calls[0][0];
      36 |       expect(call).toContain('INFO');
      37 |       expect(call).toContain('User logged in');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:34:29)

  ● Logger Utility › info › should handle multiple arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      43 |       logger.info('Multiple args', 'arg1', 123, true);
      44 |
    > 45 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      46 |       const call = consoleLogSpy.mock.calls[0][0];
      47 |       expect(call).toContain('arg1');
      48 |       expect(call).toContain('123');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:45:29)

  ● Logger Utility › success › should log success message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      55 |       logger.success('Operation completed');
      56 |
    > 57 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      58 |       const call = consoleLogSpy.mock.calls[0][0];
      59 |       expect(call).toContain('SUCCESS');
      60 |       expect(call).toContain('Operation completed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:57:29)

  ● Logger Utility › success › should log success with object data

    TypeError: Cannot read properties of undefined (reading '0')

      64 |       logger.success('Movie ranked', { movieId: 550, rank: 1 });
      65 |
    > 66 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      67 |       expect(call).toContain('SUCCESS');
      68 |       expect(call).toContain('Movie ranked');
      69 |       expect(call).toContain('movieId');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:66:47)

  ● Logger Utility › warn › should log warning message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      75 |       logger.warn('API rate limit approaching');
      76 |
    > 77 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      78 |       const call = consoleLogSpy.mock.calls[0][0];
      79 |       expect(call).toContain('WARN');
      80 |       expect(call).toContain('API rate limit approaching');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:77:29)

  ● Logger Utility › warn › should log warning with details

    TypeError: Cannot read properties of undefined (reading '0')

      84 |       logger.warn('Slow query detected', { duration: 5000, query: 'complex query' });
      85 |
    > 86 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      87 |       expect(call).toContain('WARN');
      88 |       expect(call).toContain('Slow query detected');
      89 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:86:47)

  ● Logger Utility › error › should log error message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      94 |       logger.error('Database connection failed');
      95 |
    > 96 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      97 |       const call = consoleLogSpy.mock.calls[0][0];
      98 |       expect(call).toContain('ERROR');
      99 |       expect(call).toContain('Database connection failed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:96:29)

  ● Logger Utility › error › should log error with error object

    TypeError: Cannot read properties of undefined (reading '0')

      104 |       logger.error('Unexpected error', { error: error.message, stack: 'stack trace' });
      105 |
    > 106 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      107 |       expect(call).toContain('ERROR');
      108 |       expect(call).toContain('Unexpected error');
      109 |       expect(call).toContain('Something went wrong');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:106:47)

  ● Logger Utility › debug › should log debug message in development mode

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      117 |       logger.debug('Debug information');
      118 |
    > 119 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      120 |       const call = consoleLogSpy.mock.calls[0][0];
      121 |       expect(call).toContain('DEBUG');
      122 |       expect(call).toContain('Debug information');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:119:29)

  ● Logger Utility › debug › should log debug with detailed data in development

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      147 |       });
      148 |
    > 149 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      150 |       const call = consoleLogSpy.mock.calls[0][0];
      151 |       expect(call).toContain('DEBUG');
      152 |       expect(call).toContain('State dump');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:149:29)

  ● Logger Utility › http › should log HTTP request with all parameters

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      158 |       logger.http('GET', '/api/movies', 200, 45);
      159 |
    > 160 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      161 |       const call = consoleLogSpy.mock.calls[0][0];
      162 |       expect(call).toContain('GET');
      163 |       expect(call).toContain('/api/movies');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:160:29)

  ● Logger Utility › http › should log HTTP request without status code

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      169 |       logger.http('POST', '/api/auth/signin');
      170 |
    > 171 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      172 |       const call = consoleLogSpy.mock.calls[0][0];
      173 |       expect(call).toContain('POST');
      174 |       expect(call).toContain('/api/auth/signin');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:171:29)

  ● Logger Utility › http › should log HTTP request without duration

    TypeError: Cannot read properties of undefined (reading '0')

      178 |       logger.http('DELETE', '/api/friends/123', 204);
      179 |
    > 180 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      181 |       expect(call).toContain('DELETE');
      182 |       expect(call).toContain('/api/friends/123');
      183 |       expect(call).toContain('204');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:180:47)

  ● Logger Utility › http › should handle successful status codes (200-399)

    TypeError: Cannot read properties of undefined (reading '0')

      187 |       logger.http('GET', '/api/users', 200, 10);
      188 |
    > 189 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      190 |       expect(call).toContain('200');
      191 |     });
      192 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:189:47)

  ● Logger Utility › http › should handle error status codes (400+)

    TypeError: Cannot read properties of undefined (reading '0')

      194 |       logger.http('POST', '/api/movies', 404, 20);
      195 |
    > 196 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      197 |       expect(call).toContain('404');
      198 |     });
      199 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:196:47)

  ● Logger Utility › http › should handle server error status codes (500+)

    TypeError: Cannot read properties of undefined (reading '0')

      201 |       logger.http('GET', '/api/recommendations', 500, 100);
      202 |
    > 203 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      204 |       expect(call).toContain('500');
      205 |       expect(call).toContain('100ms');
      206 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:203:47)

  ● Logger Utility › http › should handle various HTTP methods

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 3
    Received number of calls: 0

      211 |       logger.http('HEAD', '/api/health', 200);
      212 |
    > 213 |       expect(consoleLogSpy).toHaveBeenCalledTimes(3);
          |                             ^
      214 |       expect(consoleLogSpy.mock.calls[0][0]).toContain('PUT');
      215 |       expect(consoleLogSpy.mock.calls[1][0]).toContain('PATCH');
      216 |       expect(consoleLogSpy.mock.calls[2][0]).toContain('HEAD');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:213:29)

  ● Logger Utility › Timestamp formatting › should include ISO timestamp in all log messages

    TypeError: Cannot read properties of undefined (reading '0')

      222 |       logger.info('Test message');
      223 |
    > 224 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      225 |       // ISO format: YYYY-MM-DDTHH:mm:ss.sssZ
      226 |       expect(call).toMatch(/\[\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z\]/);
      227 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:224:47)

  ● Logger Utility › Argument formatting › should format string arguments

    TypeError: Cannot read properties of undefined (reading '0')

      232 |       logger.info('Message', 'string arg');
      233 |
    > 234 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      235 |       expect(call).toContain('string arg');
      236 |     });
      237 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:234:47)

  ● Logger Utility › Argument formatting › should format number arguments

    TypeError: Cannot read properties of undefined (reading '0')

      239 |       logger.info('Message', 42, 3.14);
      240 |
    > 241 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      242 |       expect(call).toContain('42');
      243 |       expect(call).toContain('3.14');
      244 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:241:47)

  ● Logger Utility › Argument formatting › should format boolean arguments

    TypeError: Cannot read properties of undefined (reading '0')

      247 |       logger.info('Message', true, false);
      248 |
    > 249 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      250 |       expect(call).toContain('true');
      251 |       expect(call).toContain('false');
      252 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:249:47)

  ● Logger Utility › Argument formatting › should format object arguments as JSON

    TypeError: Cannot read properties of undefined (reading '0')

      255 |       logger.info('Message', { key: 'value', nested: { data: 123 } });
      256 |
    > 257 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      258 |       expect(call).toContain('"key"');
      259 |       expect(call).toContain('"value"');
      260 |       expect(call).toContain('"nested"');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:257:47)

  ● Logger Utility › Argument formatting › should format array arguments

    TypeError: Cannot read properties of undefined (reading '0')

      264 |       logger.info('Message', [1, 2, 3]);
      265 |
    > 266 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      267 |       expect(call).toContain('[');
      268 |       expect(call).toContain('1');
      269 |       expect(call).toContain('2');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:266:47)

  ● Logger Utility › Argument formatting › should handle null and undefined arguments

    TypeError: Cannot read properties of undefined (reading '0')

      274 |       logger.info('Message', null, undefined);
      275 |
    > 276 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      277 |       expect(call).toContain('null');
      278 |       expect(call).toContain('undefined');
      279 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:276:47)

  ● Logger Utility › Argument formatting › should handle empty object

    TypeError: Cannot read properties of undefined (reading '0')

      282 |       logger.info('Message', {});
      283 |
    > 284 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      285 |       expect(call).toContain('{}');
      286 |     });
      287 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:284:47)

  ● Logger Utility › Argument formatting › should handle empty array

    TypeError: Cannot read properties of undefined (reading '0')

      289 |       logger.info('Message', []);
      290 |
    > 291 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      292 |       expect(call).toContain('[]');
      293 |     });
      294 |   });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:291:47)

  ● Logger Utility › Integration scenarios › should handle rapid sequential log calls

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 4
    Received number of calls: 0

      301 |       logger.error('Message 4');
      302 |
    > 303 |       expect(consoleLogSpy).toHaveBeenCalledTimes(4);
          |                             ^
      304 |     });
      305 |
      306 |     it('should handle complex nested objects', () => {

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:303:29)

  ● Logger Utility › Integration scenarios › should handle complex nested objects

    TypeError: Cannot read properties of undefined (reading '0')

      321 |       logger.info('Complex data', complexObject);
      322 |
    > 323 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      324 |       expect(call).toContain('Complex data');
      325 |       expect(call).toContain('user');
      326 |       expect(call).toContain('profile');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:323:47)

FAIL tests/mocked/movie.mocked.test.ts
  Mocked: GET /movies/search - TMDB API Failure
    ✓ should handle TMDB API server error (7 ms)
    ✓ should handle TMDB API timeout (2 ms)
    ✕ should return empty array for no matching results (3 ms)
    ✓ should handle invalid TMDB API key (2 ms)
  Mocked: Movie Comparison and Addition - Database Failures
    ✓ should handle ranking creation database error (6 ms)
    ✕ should reject duplicate movie ranking (4 ms)
  Mocked: GET /movies/ranked - Database Query Failure
    ✕ should handle ranked movies query failure (3 ms)
  Mocked: DELETE /movies/ranked/:id - Database Errors
    ✓ should handle rank adjustment failure (3 ms)

  ● Mocked: GET /movies/search - TMDB API Failure › should return empty array for no matching results

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      75 |       .query({ query: 'xyz123nonexistent' });
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      79 |   });
      80 |

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:77:24)

  ● Mocked: Movie Comparison and Addition - Database Failures › should reject duplicate movie ranking

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      153 |       });
      154 |
    > 155 |     expect(res.status).toStrictEqual(400);
          |                        ^
      156 |     findOneySpy.mockRestore();
      157 |   });
      158 | });

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:155:24)

  ● Mocked: GET /movies/ranked - Database Query Failure › should handle ranked movies query failure

    Database connection lost

      175 |   it('should handle ranked movies query failure', async () => {
      176 |     const findSpy = jest.spyOn(RankedMovie, 'find')
    > 177 |       .mockRejectedValueOnce(new Error('Database connection lost'));
          |                              ^
      178 |
      179 |     const res = await request(app)
      180 |       .get('/api/movies/ranked')

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:177:30)

FAIL tests/unmocked/userRoutes.unmocked.test.ts
  User Routes - Unmocked Tests
    GET /search
      ✓ should search users by name (629 ms)
      ✓ should search users by email (18 ms)
      ✓ should exclude current user from search results (8 ms)
      ✓ should return empty array when no users match (7 ms)
      ✓ should reject query with less than 2 characters (6 ms)
      ✓ should reject empty query (10 ms)
      ✓ should reject missing query parameter (8 ms)
      ✓ should handle case-insensitive search (9 ms)
      ✓ should limit results to 20 users (18 ms)
      ✓ should trim whitespace from query (10 ms)
      ✓ should handle database error gracefully (39 ms)
    PUT /profile
      ✓ should update user profile name successfully (17 ms)
      ✓ should trim whitespace from name (8 ms)
      ✓ should reject missing name (5 ms)
      ✓ should reject empty name (4 ms)
      ✓ should reject whitespace-only name (6 ms)
      ✓ should handle user not found (7 ms)
      ✓ should preserve other user fields (10 ms)
      ✓ should handle database error gracefully (12 ms)
    POST /fcm-token
      ✓ should register FCM token successfully (12 ms)
      ✓ should update existing FCM token (8 ms)
      ✓ should trim whitespace from token (8 ms)
      ✓ should reject missing token (5 ms)
      ✓ should reject empty token (5 ms)
      ✓ should reject whitespace-only token (6 ms)
      ✓ should handle user not found (9 ms)
      ✓ should handle database error gracefully (11 ms)
    GET /:userId
      ✕ should get user by ID successfully (16 ms)
      ✓ should reject invalid user ID format (6 ms)
      ✕ should handle user not found (6 ms)
      ✕ should return selected fields only (5 ms)
      ✕ should handle database error gracefully (9 ms)
    GET /:userId/watchlist
      ✕ should get user watchlist successfully (1 ms)
      ✕ should return empty array for user with no watchlist items
      ✕ should sort watchlist by createdAt descending
      ✕ should reject invalid user ID format
      ✕ should return watchlist even for non-existent user (empty array) (1 ms)
      ✕ should handle database error gracefully

  ● User Routes - Unmocked Tests › GET /:userId › should get user by ID successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      420 |         .set('Authorization', `Bearer ${token1}`);
      421 |
    > 422 |       expect(res.status).toBe(200);
          |                          ^
      423 |       expect(res.body.success).toBe(true);
      424 |       expect(res.body.data._id).toBe((user2 as any)._id.toString());
      425 |       expect(res.body.data.email).toBe(user2.email);

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:422:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle user not found

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

      445 |
      446 |       expect(res.status).toBe(404);
    > 447 |       expect(res.body.success).toBe(false);
          |                                ^
      448 |       expect(res.body.message).toContain('not found');
      449 |     });
      450 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:447:32)

  ● User Routes - Unmocked Tests › GET /:userId › should return selected fields only

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      454 |         .set('Authorization', `Bearer ${token1}`);
      455 |
    > 456 |       expect(res.status).toBe(200);
          |                          ^
      457 |       expect(res.body.data).toHaveProperty('_id');
      458 |       expect(res.body.data).toHaveProperty('email');
      459 |       expect(res.body.data).toHaveProperty('name');

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:456:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle database error gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 404

      469 |         .set('Authorization', `Bearer ${token1}`);
      470 |
    > 471 |       expect(res.status).toBe(500);
          |                          ^
      472 |       expect(res.body.success).toBe(false);
      473 |       expect(res.body.message).toContain('Unable to load user');
      474 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:471:26)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should get user watchlist successfully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return empty array for user with no watchlist items

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should sort watchlist by createdAt descending

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should reject invalid user ID format

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return watchlist even for non-existent user (empty array)

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should handle database error gracefully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

[2m[2025-10-29T06:53:51.682Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
[2m[2025-10-29T06:53:51.857Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
FAIL tests/unmocked/userProfile.unmocked.test.ts (15.918 s)
  Unmocked: PUT /users/profile
    ✕ should update user profile name (201 ms)
    ✕ should update user profile image (12 ms)
    ✕ should update multiple profile fields (8 ms)
    ✓ should reject empty name (4 ms)
    ✓ should reject whitespace-only name (5 ms)
    ✓ should reject unauthenticated profile update (2 ms)
    ✓ should reject invalid token (5 ms)
  Unmocked: POST /users/fcm-token
    ✓ should register FCM token (205 ms)
    ✓ should update existing FCM token (11 ms)
    ✓ should reject missing FCM token (11 ms)
    ✓ should reject empty FCM token (2 ms)
    ✓ should reject unauthenticated FCM token registration (1 ms)
  Unmocked: GET /users/profile/:userId
    ✕ should get user profile by ID (15 ms)
    ✕ should get own profile (10 ms)
    ✓ should return 404 for non-existent user (11 ms)
    ✕ should reject invalid user ID format (11 ms)
    ✕ should reject unauthenticated profile request (21 ms)

  ● Unmocked: PUT /users/profile › should update user profile name

    TypeError: Cannot read properties of undefined (reading 'name')

      47 |
      48 |     expect(res.status).toStrictEqual(200);
    > 49 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      50 |
      51 |     const updatedUser = await User.findById(user._id);
      52 |     expect(updatedUser!.name).toStrictEqual(newName);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:49:26)

  ● Unmocked: PUT /users/profile › should update user profile image

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      64 |       .send({ profileImageUrl: newImageUrl });
      65 |
    > 66 |     expect(res.status).toStrictEqual(200);
         |                        ^
      67 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      68 |
      69 |     const updatedUser = await User.findById(user._id);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:66:24)

  ● Unmocked: PUT /users/profile › should update multiple profile fields

    TypeError: Cannot read properties of undefined (reading 'name')

      88 |
      89 |     expect(res.status).toStrictEqual(200);
    > 90 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      91 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      92 |   });
      93 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:90:26)

  ● Unmocked: GET /users/profile/:userId › should get user profile by ID

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      283 |       .set('Authorization', `Bearer ${token}`);
      284 |
    > 285 |     expect(res.status).toStrictEqual(200);
          |                        ^
      286 |     expect(res.body.user).toBeDefined();
      287 |     expect(res.body.user.email).toStrictEqual(otherUser.email);
      288 |   });

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:285:24)

  ● Unmocked: GET /users/profile/:userId › should get own profile

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      297 |       .set('Authorization', `Bearer ${token}`);
      298 |
    > 299 |     expect(res.status).toStrictEqual(200);
          |                        ^
      300 |     expect(res.body.user.email).toStrictEqual(user.email);
      301 |   });
      302 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:299:24)

  ● Unmocked: GET /users/profile/:userId › should reject invalid user ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      323 |       .set('Authorization', `Bearer ${token}`);
      324 |
    > 325 |     expect(res.status).toStrictEqual(400);
          |                        ^
      326 |   });
      327 |
      328 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:325:24)

  ● Unmocked: GET /users/profile/:userId › should reject unauthenticated profile request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      334 |       .get(`/api/users/profile/${otherUser._id}`);
      335 |
    > 336 |     expect(res.status).toStrictEqual(401);
          |                        ^
      337 |   });
      338 | });
      339 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:336:24)

FAIL tests/mocked/friendRoutes.mocked.test.ts
  Friend Routes - Mocked Error Tests
    GET / (friends list) error handling
      ✓ should handle database error gracefully (909 ms)
    GET /requests error handling
      ✓ should handle database error gracefully (11 ms)
    GET /requests/detailed error handling
      ✓ should handle database error gracefully (8 ms)
    GET /requests/outgoing error handling
      ✓ should handle database error gracefully (7 ms)
    GET /requests/outgoing/detailed error handling
      ✓ should handle database error gracefully (7 ms)
    POST /request error handling
      ✓ should return 401 when authenticated user not found in database (11 ms)
      ✓ should handle database error when creating friend request (10 ms)
      ✕ should handle notification service failure gracefully (9 ms)
    POST /respond error handling
      ✓ should handle database error when finding friend request (7 ms)
      ✓ should handle database error when creating friendships (35 ms)
      ✓ should handle notification failure when accepting request (29 ms)
    DELETE /:friendId error handling
      ✓ should handle database error gracefully (16 ms)
      ✓ should return 404 when friendship not found (14 ms)
    Additional edge cases
      ✓ should handle missing accept field in respond request (8 ms)
      ✓ should handle missing requestId field in respond request (8 ms)
      ✓ should reject friend request when user not found (13 ms)
      ✓ should reject responding to non-existent friend request (9 ms)
      ✓ should reject responding to request not directed to user (17 ms)

  ● Friend Routes - Mocked Error Tests › POST /request error handling › should handle notification service failure gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      194 |
      195 |       // Should still succeed even if notification fails
    > 196 |       expect(res.status).toBe(200);
          |                          ^
      197 |       expect(res.body.success).toBe(true);
      198 |     });
      199 |   });

      at Object.<anonymous> (tests/mocked/friendRoutes.mocked.test.ts:196:26)

FAIL tests/unmocked/quote.unmocked.test.ts
  Unmocked: GET /quotes
    ✕ should return quote for movie (7 ms)
    ✕ should return fallback quote for unknown movie (4 ms)
    ✕ should reject unauthenticated quote request (3 ms)
    ✕ should reject quote request without title (3 ms)

  ● Unmocked: GET /quotes › should return quote for movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      45 |       .query({ title: 'Inception' });
      46 |
    > 47 |     expect(res.status).toStrictEqual(200);
         |                        ^
      48 |     expect(res.body).toHaveProperty('quote');
      49 |   });
      50 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:47:24)

  ● Unmocked: GET /quotes › should return fallback quote for unknown movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      59 |       .query({ title: 'NonexistentMoviexyz123' });
      60 |
    > 61 |     expect(res.status).toStrictEqual(200);
         |                        ^
      62 |     expect(res.body).toHaveProperty('quote');
      63 |   });
      64 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:61:24)

  ● Unmocked: GET /quotes › should reject unauthenticated quote request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      72 |       .query({ title: 'Inception' });
      73 |
    > 74 |     expect(res.status).toStrictEqual(401);
         |                        ^
      75 |   });
      76 |
      77 |   // Input: Missing title query parameter

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:74:24)

  ● Unmocked: GET /quotes › should reject quote request without title

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      84 |       .set('Authorization', `Bearer ${token}`);
      85 |
    > 86 |     expect(res.status).toStrictEqual(400);
         |                        ^
      87 |   });
      88 | });
      89 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:86:24)

FAIL tests/unmocked/watchlistOperations.unmocked.test.ts (16.333 s)
  Unmocked: POST /watchlist - Additional Tests
    ✕ should add movie to watchlist with all fields (252 ms)
    ✓ should add movie with only required fields (96 ms)
    ✕ should reject duplicate movie in watchlist (12 ms)
    ✓ should reject missing movieId (5 ms)
    ✓ should reject missing title (6 ms)
    ✕ should reject missing year (80 ms)
    ✕ should reject missing posterUrl (134 ms)
    ✓ should reject unauthenticated watchlist addition (3 ms)
    ✓ should add multiple movies to watchlist (468 ms)
  Unmocked: DELETE /watchlist/:movieId - Additional Tests
    ✕ should delete movie from watchlist (8 ms)
    ✓ should return 404 for non-existent movie (5 ms)
    ✕ should delete only specified movie from watchlist (4 ms)
    ✕ should reject unauthenticated delete request (3 ms)
    ✕ should handle invalid movieId format (17 ms)
  Unmocked: GET /watchlist - Additional Tests
    ✕ should get multiple watchlist items (24 ms)
    ✕ should return only authenticated user watchlist (11 ms)
    ✕ should return empty array for empty watchlist (5 ms)
    ✓ should reject unauthenticated get watchlist request (5 ms)
    ✕ should return complete movie details in watchlist (12 ms)

  ● Unmocked: POST /watchlist - Additional Tests › should add movie to watchlist with all fields

    expect(received).toBeDefined()

    Received: undefined

      61 |     expect(res.status).toStrictEqual(201);
      62 |     expect(res.body.success).toStrictEqual(true);
    > 63 |     expect(res.body.watchlistItem).toBeDefined();
         |                                    ^
      64 |     expect(res.body.watchlistItem.movieId).toStrictEqual(mockMovies.inception.id);
      65 |
      66 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:63:36)

  ● Unmocked: POST /watchlist - Additional Tests › should reject duplicate movie in watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      119 |       });
      120 |
    > 121 |     expect(res.status).toStrictEqual(400);
          |                        ^
      122 |     expect(res.body.message).toMatch(/already|watchlist/i);
      123 |   });
      124 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:121:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing year

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      171 |       });
      172 |
    > 173 |     expect(res.status).toStrictEqual(400);
          |                        ^
      174 |   });
      175 |
      176 |   // Input: Missing posterUrl

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:173:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing posterUrl

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      188 |       });
      189 |
    > 190 |     expect(res.status).toStrictEqual(400);
          |                        ^
      191 |   });
      192 |
      193 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:190:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      296 |       .set('Authorization', `Bearer ${token}`);
      297 |
    > 298 |     expect(res.status).toStrictEqual(200);
          |                        ^
      299 |     expect(res.body.success).toStrictEqual(true);
      300 |
      301 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:298:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete only specified movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      343 |       .set('Authorization', `Bearer ${token}`);
      344 |
    > 345 |     expect(res.status).toStrictEqual(200);
          |                        ^
      346 |
      347 |     const deletedItem = await WatchlistItem.findOne({
      348 |       userId: user._id,

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:345:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should reject unauthenticated delete request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      366 |       .delete(`/api/watchlist/${mockMovies.inception.id}`);
      367 |
    > 368 |     expect(res.status).toStrictEqual(401);
          |                        ^
      369 |   });
      370 |
      371 |   // Input: Invalid movieId format

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:368:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should handle invalid movieId format

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [400, 404]

      378 |       .set('Authorization', `Bearer ${token}`);
      379 |
    > 380 |     expect([400, 404]).toContain(res.status);
          |                        ^
      381 |   });
      382 | });
      383 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:380:24)

  ● Unmocked: GET /watchlist - Additional Tests › should get multiple watchlist items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      443 |
      444 |     expect(res.status).toStrictEqual(200);
    > 445 |     expect(Array.isArray(res.body.watchlist || res.body)).toBe(true);
          |                                                           ^
      446 |     const watchlist = res.body.watchlist || res.body;
      447 |     expect(watchlist.length).toStrictEqual(2);
      448 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:445:59)

  ● Unmocked: GET /watchlist - Additional Tests › should return only authenticated user watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 1
    Received: undefined

      475 |     expect(res.status).toStrictEqual(200);
      476 |     const watchlist = res.body.watchlist || res.body;
    > 477 |     expect(watchlist.length).toStrictEqual(1);
          |                              ^
      478 |     expect(watchlist[0].movieId).toStrictEqual(mockMovies.inception.id);
      479 |   });
      480 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:477:30)

  ● Unmocked: GET /watchlist - Additional Tests › should return empty array for empty watchlist

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      490 |     expect(res.status).toStrictEqual(200);
      491 |     const watchlist = res.body.watchlist || res.body;
    > 492 |     expect(Array.isArray(watchlist)).toBe(true);
          |                                      ^
      493 |     expect(watchlist.length).toStrictEqual(0);
      494 |   });
      495 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:492:38)

  ● Unmocked: GET /watchlist - Additional Tests › should return complete movie details in watchlist

    TypeError: Cannot read properties of undefined (reading 'title')

      527 |     expect(res.status).toStrictEqual(200);
      528 |     const watchlist = res.body.watchlist || res.body;
    > 529 |     expect(watchlist[0].title).toStrictEqual(mockMovies.inception.title);
          |                         ^
      530 |     expect(watchlist[0].year).toStrictEqual(mockMovies.inception.year);
      531 |     expect(watchlist[0].rating).toStrictEqual(mockMovies.inception.rating);
      532 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:529:25)

[2m[2025-10-29T06:53:53.541Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:53.826Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:53.897Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:53.970Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
FAIL tests/unmocked/watchlistRoutes.unmocked.test.ts
  Watchlist Routes - Unmocked Tests
    GET /
      ✓ should get user watchlist successfully (1150 ms)
      ✓ should return empty array for empty watchlist (40 ms)
      ✓ should only return current user watchlist items (22 ms)
      ✓ should sort watchlist by createdAt descending (32 ms)
      ✓ should handle database error gracefully (44 ms)
    POST /
      ✓ should add movie to watchlist successfully (15 ms)
      ✓ should add movie with minimal fields (movieId and title only) (9 ms)
      ✓ should enrich missing posterPath from TMDB (7 ms)
      ✓ should enrich missing overview from TMDB (7 ms)
      ✓ should handle TMDB enrichment failure gracefully (9 ms)
      ✓ should reject missing movieId (5 ms)
      ✓ should reject missing title (7 ms)
      ✓ should reject duplicate movie (7 ms)
      ✓ should allow different users to add same movie (11 ms)
      ✓ should handle movieId as number (8 ms)
      ✓ should preserve all provided fields (8 ms)
      ✓ should handle database save error gracefully (12 ms)
    DELETE /:movieId
      ✓ should remove movie from watchlist successfully (13 ms)
      ✓ should only remove from current user watchlist (9 ms)
      ✓ should return 404 when movie not in watchlist (11 ms)
      ✓ should handle movieId as number parameter (10 ms)
      ✓ should handle invalid movieId format gracefully (23 ms)
      ✓ should handle database error gracefully (36 ms)
      ✓ should not affect other watchlist items (15 ms)
    Edge Cases
      ✕ should handle very long movie titles (10 ms)
      ✕ should handle special characters in title (8 ms)
      ✓ should handle zero as movieId (8 ms)
      ✕ should handle large movieId numbers (13 ms)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle very long movie titles

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      521 |         });
      522 |
    > 523 |       expect(res.status).toBe(200);
          |                          ^
      524 |       expect(res.body.data.title).toBe(longTitle);
      525 |     });
      526 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:523:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle special characters in title

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      536 |         });
      537 |
    > 538 |       expect(res.status).toBe(200);
          |                          ^
      539 |       expect(res.body.data.title).toBe(specialTitle);
      540 |     });
      541 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:538:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle large movieId numbers

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      565 |         });
      566 |
    > 567 |       expect(res.status).toBe(200);
          |                          ^
      568 |       expect(res.body.data.movieId).toBe(largeId);
      569 |     });
      570 |   });

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:567:26)

🌐 TMDB ⬅️  GET /movie/27205 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.051Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.121Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.196Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.268Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.337Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.412Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.488Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.559Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 65ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.625Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100000 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.707Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100001 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.780Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100002 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.852Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 170ms: Request failed with status code 401
FAIL tests/unmocked/movie.unmocked.test.ts (17.951 s)
  Unmocked: GET /movies/search
    ✕ should return search results for valid movie query (253 ms)
    ✓ should reject search query shorter than 2 characters (6 ms)
    ✓ should reject empty search query (3 ms)
    ✓ should reject unauthenticated search (3 ms)
  Unmocked: GET /movies/ranked
    ✓ should return user ranked movies sorted by rank (19 ms)
    ✓ should return empty array for user with no ranked movies (6 ms)
    ✓ should reject unauthenticated ranked movies request (4 ms)
  Unmocked: DELETE /movies/ranked/:id
    ✕ should delete ranked movie and adjust ranks (12 ms)
    ✓ should reject deletion of non-existent movie (6 ms)
    ✓ should reject deletion with invalid ID format (9 ms)

  ● Unmocked: GET /movies/search › should return search results for valid movie query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      46 |       .query({ query: 'Inception' });
      47 |
    > 48 |     expect(res.status).toStrictEqual(200);
         |                        ^
      49 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      50 |   });
      51 |

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:48:24)

  ● Unmocked: DELETE /movies/ranked/:id › should delete ranked movie and adjust ranks

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      216 |       .set('Authorization', `Bearer ${token}`);
      217 |
    > 218 |     expect(res.status).toStrictEqual(200);
          |                        ^
      219 |
      220 |     // Verify movie is deleted
      221 |     const remaining = await RankedMovie.find({ userId: user._id });

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:218:24)

🌐 TMDB ⬅️  GET /movie/100003 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.925Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100004 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:54.997Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100005 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.065Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100006 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.134Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100007 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:55.159Z][0m [36mINFO[0m Profile update request for user 6901ba028afd7dd524c2b2c9 {
  "name": "updating"
}
🌐 TMDB ⬅️  GET /movie/278 ERROR 84ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/100007 ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.209Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 100007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100000/similar params={"language":"en-US","page":1,"api_key":"***"}
[2m[2025-10-29T06:53:55.213Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:55.269Z][0m [32mSUCCESS[0m Profile updated for user 6901ba028afd7dd524c2b2c9
[2m[2025-10-29T06:53:55.277Z][0m [36mINFO[0m Profile update request for user 6901ba028afd7dd524c2b2c9 {
  "name": "unchanged"
}
[2m[2025-10-29T06:53:55.277Z][0m [33mWARN[0m Profile update failed: no name provided
🌐 TMDB ⬅️  GET /movie/100000/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.278Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.284Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100001/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.349Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.355Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba02ce3ffe83afc7a289",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100002/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.420Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.425Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba02ce3ffe83afc7a289",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100003/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.491Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.499Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba02ce3ffe83afc7a289",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100004/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.563Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 135ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.635Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba02ce3ffe83afc7a289",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ⬅️  GET /movie/100000/recommendations ERROR 140ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.703Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/100001/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.775Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/100002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 85ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/100002/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:55.844Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 100002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 71ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 74ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 225ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.077Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 69ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/238 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.147Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.216Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 69ms: Request failed with status code 401
FAIL tests/unmocked/auth.unmocked.test.ts (19.376 s)
  Unmocked: POST /auth/signin
    ✕ should successfully sign in an existing user (1137 ms)
    ✓ should reject signin without idToken (141 ms)
    ✕ should reject signin for non-existent user (7 ms)
  Unmocked: POST /auth/signup
    ✕ should successfully create a new user account (15 ms)
    ✓ should reject signup without idToken (5 ms)
    ✕ should reject signup with existing email (696 ms)
  Unmocked: POST /auth/signout
    ✓ should successfully sign out authenticated user (832 ms)
    ✓ should reject signout without authentication token (127 ms)
    ✓ should reject signout with invalid token (7 ms)
  Unmocked: DELETE /auth/account
    ✓ should successfully delete user account and cascade delete related data (947 ms)
    ✓ should reject account deletion without authentication (10 ms)
    ✓ should reject account deletion with invalid token (7 ms)

  ● Unmocked: POST /auth/signin › should successfully sign in an existing user

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      63 |       });
      64 |
    > 65 |     expect(res.status).toStrictEqual(200);
         |                        ^
      66 |     expect(res.body).toHaveProperty('user');
      67 |     expect(res.body).toHaveProperty('token');
      68 |     expect(res.body.user.email).toStrictEqual('test@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:65:24)

  ● Unmocked: POST /auth/signin › should reject signin for non-existent user

    expect(received).toMatch(expected)

    Expected pattern: /not found|error/i
    Received string:  "Invalid Google token"

      101 |
      102 |     expect([400, 404]).toContain(res.status);
    > 103 |     expect(res.body.message).toMatch(/not found|error/i);
          |                              ^
      104 |   });
      105 | });
      106 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:103:30)

  ● Unmocked: POST /auth/signup › should successfully create a new user account

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 201
    Received: 400

      143 |       });
      144 |
    > 145 |     expect(res.status).toStrictEqual(201);
          |                        ^
      146 |     expect(res.body).toHaveProperty('user');
      147 |     expect(res.body).toHaveProperty('token');
      148 |     expect(res.body.user.email).toStrictEqual('newuser@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:145:24)

  ● Unmocked: POST /auth/signup › should reject signup with existing email

    expect(received).toMatch(expected)

    Expected pattern: /already exists|duplicate/i
    Received string:  "Invalid Google token"

      194 |
      195 |     expect(res.status).toStrictEqual(400);
    > 196 |     expect(res.body.message).toMatch(/already exists|duplicate/i);
          |                              ^
      197 |   });
      198 | });
      199 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:196:30)

[2m[2025-10-29T06:53:56.287Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 123ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.357Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 184ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 141ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.499Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
FAIL tests/nfr/performance.test.ts (19.6 s)
  NFR: Performance - Response Time
    ✕ should respond to GET /movies/ranked within acceptable time (25 ms)
    ✕ should sign out user within acceptable time (16 ms)
    ✕ should limit feed results to prevent memory bloat (219 ms)
  NFR: Performance - Database Index Efficiency
    ✕ should efficiently fetch ranked movies using indexes (29 ms)
  NFR: Performance - Bulk Operations
    ✕ should complete cascade delete within acceptable time (248 ms)

  ● NFR: Performance - Response Time › should respond to GET /movies/ranked within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      60 |     const responseTime = Date.now() - startTime;
      61 |
    > 62 |     expect(res.status).toStrictEqual(200);
         |                        ^
      63 |     expect(responseTime).toBeLessThan(ACCEPTABLE_RESPONSE_TIME_MS);
      64 |   });
      65 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:62:24)

  ● NFR: Performance - Response Time › should sign out user within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      75 |     const responseTime = Date.now() - startTime;
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(responseTime).toBeLessThan(500);
      79 |   });
      80 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:77:24)

  ● NFR: Performance - Response Time › should limit feed results to prevent memory bloat

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      117 |       .set('Authorization', `Bearer ${token}`);
      118 |
    > 119 |     expect(res.status).toStrictEqual(200);
          |                        ^
      120 |     expect(Array.isArray(res.body)).toBe(true);
      121 |     // Feed should limit results, verify it's not unbounded
      122 |     expect(res.body.length).toBeLessThanOrEqual(50);

      at Object.<anonymous> (tests/nfr/performance.test.ts:119:24)

  ● NFR: Performance - Database Index Efficiency › should efficiently fetch ranked movies using indexes

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      166 |     const queryTime = Date.now() - startTime;
      167 |
    > 168 |     expect(res.status).toStrictEqual(200);
          |                        ^
      169 |     expect(Array.isArray(res.body)).toBe(true);
      170 |     expect(res.body.length).toBe(100);
      171 |     // With proper indexing, 100 items should still be fast

      at Object.<anonymous> (tests/nfr/performance.test.ts:168:24)

  ● NFR: Performance - Bulk Operations › should complete cascade delete within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      236 |     const deleteTime = Date.now() - startTime;
      237 |
    > 238 |     expect(res.status).toStrictEqual(200);
          |                        ^
      239 |     expect(deleteTime).toBeLessThan(ACCEPTABLE_BULK_TIME_MS);
      240 |   });
      241 | });

      at Object.<anonymous> (tests/nfr/performance.test.ts:238:24)

🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.575Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
FAIL tests/unmocked/friendOperations.unmocked.test.ts (19.685 s)
  Unmocked: POST /friends/request - Additional Tests
    ✓ should send friend request by email (51 ms)
    ✓ should reject friend request to self (13 ms)
    ✕ should reject duplicate friend request (13 ms)
    ✕ should reject request to existing friend (20 ms)
    ✓ should reject request without email (8 ms)
    ✓ should reject invalid email format (5 ms)
  Unmocked: POST /friends/respond - Additional Tests
    ✕ should accept friend request (7 ms)
    ✕ should reject friend request (9 ms)
    ✓ should reject invalid action (5 ms)
    ✕ should return 404 for non-existent request (12 ms)
    ✓ should reject missing requestId (5 ms)
    ✓ should reject missing action (4 ms)
  Unmocked: DELETE /friends/:friendId - Additional Tests
    ✓ should remove friend (bidirectional) (497 ms)
    ✓ should return 404 for non-existent friend (22 ms)
    ✕ should reject invalid friend ID format (80 ms)
    ✕ should reject removing self (17 ms)
  Unmocked: GET /friends/search - Search Users
    ✕ should search users by email (8 ms)
    ✕ should search users by name (3 ms)
    ✕ should reject empty search query (5 ms)
    ✕ should return empty array for no matches (1 ms)

  ● Unmocked: POST /friends/request - Additional Tests › should reject duplicate friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      104 |       .send({ email: user2.email });
      105 |
    > 106 |     expect(res.status).toStrictEqual(400);
          |                        ^
      107 |     expect(res.body.message).toMatch(/already|pending/i);
      108 |   });
      109 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:106:24)

  ● Unmocked: POST /friends/request - Additional Tests › should reject request to existing friend

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      124 |       .send({ email: user2.email });
      125 |
    > 126 |     expect(res.status).toStrictEqual(400);
          |                        ^
      127 |     expect(res.body.message).toMatch(/already.*friend/i);
      128 |   });
      129 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:126:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should accept friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      209 |       });
      210 |
    > 211 |     expect(res.status).toStrictEqual(200);
          |                        ^
      212 |     expect(res.body.success).toStrictEqual(true);
      213 |
      214 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:211:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should reject friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      241 |       });
      242 |
    > 243 |     expect(res.status).toStrictEqual(200);
          |                        ^
      244 |     expect(res.body.success).toStrictEqual(true);
      245 |
      246 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:243:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should return 404 for non-existent request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 404
    Received: 400

      284 |       });
      285 |
    > 286 |     expect(res.status).toStrictEqual(404);
          |                        ^
      287 |   });
      288 |
      289 |   // Input: Missing requestId

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:286:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject invalid friend ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      407 |       .set('Authorization', `Bearer ${token1}`);
      408 |
    > 409 |     expect(res.status).toStrictEqual(400);
          |                        ^
      410 |   });
      411 |
      412 |   // Input: Remove self as friend

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:409:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject removing self

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      419 |       .set('Authorization', `Bearer ${token1}`);
      420 |
    > 421 |     expect(res.status).toStrictEqual(400);
          |                        ^
      422 |   });
      423 | });
      424 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:421:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by email

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      463 |       .query({ query: 'searchable' });
      464 |
    > 465 |     expect(res.status).toStrictEqual(200);
          |                        ^
      466 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      467 |   });
      468 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:465:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by name

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      477 |       .query({ query: 'Searchable' });
      478 |
    > 479 |     expect(res.status).toStrictEqual(200);
          |                        ^
      480 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      481 |   });
      482 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:479:24)

  ● Unmocked: GET /friends/search - Search Users › should reject empty search query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      491 |       .query({ query: '' });
      492 |
    > 493 |     expect(res.status).toStrictEqual(400);
          |                        ^
      494 |   });
      495 |
      496 |   // Input: Search with no matches

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:493:24)

  ● Unmocked: GET /friends/search - Search Users › should return empty array for no matches

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      504 |       .query({ query: 'nonexistentuser12345' });
      505 |
    > 506 |     expect(res.status).toStrictEqual(200);
          |                        ^
      507 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      508 |   });
      509 | });

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:506:24)

🌐 TMDB ⬅️  GET /movie/155 ERROR 136ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/157336 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 137ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.712Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/157336 ERROR 71ms: Request failed with status code 401
🌐 TMDB ➡️  GET /movie/155 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.787Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/155 ERROR 68ms: Request failed with status code 401
🌐 TMDB ⬅️  GET /movie/200000 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.885Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200001 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:56.950Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ⬅️  GET /movie/200001 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:56.956Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200002 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.026Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200003 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.097Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200004 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.169Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200005 ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.236Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200006 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.308Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200007 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.379Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200008 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:57.405Z][0m [31mERROR[0m Error sending like notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/200008 ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.447Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200009 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:57.471Z][0m [31mERROR[0m Error sending like notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
[2m[2025-10-29T06:53:57.570Z][0m [31mERROR[0m Error sending comment notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/200009 ERROR 128ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.575Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 200009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200000/similar params={"language":"en-US","page":1,"api_key":"***"}
[2m[2025-10-29T06:53:57.630Z][0m [31mERROR[0m Error sending comment notification: {
  "code": "messaging/invalid-argument",
  "message": "The registration token is not a valid FCM registration token"
}
🌐 TMDB ⬅️  GET /movie/200000/similar ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.641Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200001/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.710Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200002/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.778Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200003/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.852Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200004/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.924Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200005/similar ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:53:57.992Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200000/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.064Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200001/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.134Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200002/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.208Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/200003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/200003/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.280Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 200003,
  "error": "Request failed with status code 401"
}
[2m[2025-10-29T06:53:58.301Z][0m [32mSUCCESS[0m FCM token registered for user 6901ba058afd7dd524c2b2d0
🌐 TMDB ➡️  GET /movie/300000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300000 ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.406Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300001 params={"language":"en-US","api_key":"***"}
PASS tests/unmocked/allMovieRoutes.unmocked.test.ts (5.13 s)
  Comprehensive Movie Routes Tests
    ✓ should rank first movie directly (140 ms)
    ✓ should trigger comparison when ranking second movie (82 ms)
    ✓ should handle movie comparison (88 ms)
    ✓ should delete ranked movie and adjust ranks (6 ms)
    ✓ should get all ranked movies in order (6 ms)
    ✓ should handle watchlist removal when ranking movie (81 ms)
    ✓ should handle ranking with missing fields (5 ms)
    ✓ should handle comparison without session (3 ms)
    ✓ should handle deleting non-existent movie (4 ms)
    ✓ should handle duplicate movie ranking (135 ms)
    ✓ should handle multiple movie rankings (456 ms)
    ✓ should handle comparison with invalid movie ID (102 ms)

🌐 TMDB ⬅️  GET /trending/movie/week ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.438Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ⬅️  GET /movie/300001 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.479Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300002 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.548Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300003 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.619Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300004 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.691Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300005 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.760Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300006 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.829Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300007 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.899Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300008 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:58.968Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300009 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/movieComparisionController.mocked.test.ts (5.017 s)
  Movie Comparison Controller - Mocked Tests
    POST /add
      Case 1: First movie (empty ranking)
        ✓ should add first movie without comparison (992 ms)
        ✓ should remove from watchlist when adding first movie (83 ms)
        ✓ should enrich missing poster and overview from TMDB (14 ms)
        ✓ should create feed activity when adding first movie (12 ms)
        ✓ should notify friends via SSE when adding first movie (21 ms)
        ✓ should send FCM notification to friends with tokens (15 ms)
        ✓ should handle TMDB enrichment failure gracefully (54 ms)
        ✓ should handle FCM notification failure gracefully (45 ms)
      Case 2: Duplicate movie
        ✓ should reject duplicate movie (26 ms)
        ✓ should remove from watchlist even when rejecting duplicate (37 ms)
      Case 3: Begin comparison
        ✓ should start comparison session for second movie (22 ms)
        ✓ should remove from watchlist when starting comparison (27 ms)
        ✓ should use middle index for first comparison (33 ms)
      Error handling
        ✓ should handle database errors gracefully (14 ms)
    POST /compare
      ✓ should return error when no active session (38 ms)
      ✓ should continue comparison when not finished (52 ms)
      ✓ should insert movie when comparison finishes (prefer new) (48 ms)
      ✓ should insert movie at correct position (prefer existing) (46 ms)
      ✓ should remove from watchlist when finalizing insert (41 ms)
      ✓ should enrich with TMDB data when finalizing (25 ms)
      ✓ should create feed activity when finalizing (30 ms)
      ✓ should notify friends when finalizing (30 ms)
      ✓ should send FCM notification when finalizing (23 ms)
      ✓ should handle TMDB enrichment failure when finalizing (28 ms)
      ✓ should handle FCM notification failure when finalizing (25 ms)
      ✓ should handle database errors gracefully (9 ms)

🌐 TMDB ⬅️  GET /movie/300009 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.037Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300010 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300010 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.108Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300011 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.180Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300012 params={"language":"en-US","api_key":"***"}
[2m[2025-10-29T06:53:59.183Z][0m [32mSUCCESS[0m Firebase Admin initialized with service account
🌐 TMDB ⬅️  GET /movie/300012 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.251Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300013 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300013 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.323Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300013,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300014 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300014 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.392Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300014,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300015 params={"language":"en-US","api_key":"***"}
PASS tests/mocked/feedRoutes.mocked.test.ts
  Feed Routes - Mocked Error Tests
    GET / (friends feed) error handling
      ✓ should handle TMDB enrichment errors gracefully (1219 ms)
      ✓ should handle database error gracefully (11 ms)
    GET /me error handling
      ✓ should handle TMDB enrichment errors gracefully (22 ms)
      ✓ should handle database error gracefully (10 ms)
    GET /stream error handling
      ✓ should handle SSE setup errors gracefully (9 ms)
    POST /:activityId/like error handling
      ✓ should handle notification errors gracefully (22 ms)
      ✓ should handle duplicate like error (14 ms)
      ✓ should handle database error gracefully (13 ms)
    DELETE /:activityId/like error handling
      ✓ should handle database error gracefully (10 ms)
    GET /:activityId/comments error handling
      ✓ should handle database error gracefully (11 ms)
    POST /:activityId/comments error handling
      ✓ should handle notification errors gracefully (37 ms)
      ✓ should handle database error gracefully (18 ms)

PASS tests/unmocked/user.unmocked.test.ts (6.211 s)
  Unmocked: PUT /users/profile
    ✓ should successfully update user profile name (129 ms)
    ✓ should reject empty name update (3 ms)
    ✓ should reject profile update without authentication (2 ms)
  Unmocked: POST /users/fcm-token
    ✓ should successfully register FCM token (191 ms)
    ✓ should reject missing FCM token (2 ms)
    ✓ should reject FCM token registration without authentication (2 ms)

🌐 TMDB ⬅️  GET /movie/300015 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.462Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300015,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300016 params={"language":"en-US","api_key":"***"}
PASS tests/unmocked/recommendations.unmocked.test.ts (6.538 s)
  Unmocked: GET /recommendations
    ✓ should return recommendations for user with ranked movies (563 ms)
    ✓ should return empty recommendations for user with no ranked movies (6 ms)
    ✓ should reject unauthenticated recommendation request (3 ms)
  Unmocked: GET /recommendations/trending
    ✓ should return trending movies (71 ms)
    ✓ should reject unauthenticated trending request (1 ms)

🌐 TMDB ⬅️  GET /movie/300016 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.532Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300016,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300017 params={"language":"en-US","api_key":"***"}
FAIL tests/unmocked/feedRouteHandlers.unmocked.test.ts (22.625 s)
  Feed Route Handlers - Inline Handlers
    ✓ should get friends feed activities with enrichment (297 ms)
    ✓ should return empty feed when user has no friends (19 ms)
    ✓ should handle activities missing overview and poster (91 ms)
    ✓ should include like counts in feed (194 ms)
    ✓ should include comment counts in feed (143 ms)
    ✓ should mark activities liked by user (104 ms)
    ✓ should show current rank from RankedMovie collection (160 ms)
    ✓ should aggregate activities from multiple friends (257 ms)
    ✓ should handle errors gracefully (38 ms)
    ✓ should get users own activities (175 ms)
    ✓ should return empty array when user has no activities (9 ms)
    ✕ should establish SSE stream (10004 ms)
    ✓ should like an activity (135 ms)
    ✓ should return 404 when liking non-existent activity (8 ms)
    ✓ should allow liking own activity without notification (12 ms)
    ✓ should handle duplicate like gracefully (51 ms)
    ✓ should unlike an activity (12 ms)
    ✓ should handle unlike when not previously liked (8 ms)
    ✓ should get comments for an activity (13 ms)
    ✓ should return empty array when no comments (7 ms)
    ✓ should add comment to activity (53 ms)
    ✓ should reject comment without text (6 ms)
    ✓ should return 404 when commenting on non-existent activity (5 ms)
    ✓ should send notification when commenting (47 ms)
    ✓ should not send notification when commenting on own activity (11 ms)
    ✓ should reject unauthorized access to feed (4 ms)
    ✓ should reject unauthorized access to /me (3 ms)
    ✓ should reject unauthorized access to /stream (4 ms)
    ✓ should reject unauthorized like (6 ms)
    ✓ should reject unauthorized comment (4 ms)

  ● Feed Route Handlers - Inline Handlers › should establish SSE stream

    thrown: "Exceeded timeout of 10000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      289 |
      290 |   // Test Case 12: GET /stream (SSE)
    > 291 |   it('should establish SSE stream', async () => {
          |   ^
      292 |     const res = await request(app)
      293 |       .get('/api/feed/stream')
      294 |       .set('Authorization', `Bearer ${token1}`)

      at tests/unmocked/feedRouteHandlers.unmocked.test.ts:291:3
      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:19:1)

PASS tests/mocked/notificationService.mocked.test.ts
  Notification Service Tests - Mocked
    ✓ should send feed notification successfully (5 ms)
    ✓ should handle invalid registration token error (2 ms)
    ✓ should handle registration token not registered error (2 ms)
    ✓ should handle generic sending error (1 ms)
    ✓ should send friend request notification (2 ms)
    ✓ should send friend request accepted notification (2 ms)
    ✓ should send like notification (1 ms)
    ✓ should send comment notification (1 ms)
    ✓ should truncate long comments in notification (2 ms)
    ✓ should send multicast notification to multiple tokens (2 ms)
    ✓ should handle multicast with partial failures (2 ms)
    ✓ should handle multicast with empty token array (1 ms)
    ✓ should handle multicast network error (2 ms)
    ✓ should include Android configuration in feed notification (2 ms)
    ✓ should use normal priority for friend request accepted (1 ms)
    ✓ should handle invalid token error in sendLikeNotification (1 ms)
    ✓ should handle token not registered error in sendLikeNotification (1 ms)
    ✓ should handle generic error in sendLikeNotification (2 ms)
    ✓ should handle invalid token error in sendCommentNotification (1 ms)
    ✓ should handle token not registered error in sendCommentNotification (1 ms)
    ✓ should handle generic error in sendCommentNotification (1 ms)
    ✓ should handle errors in sendFriendRequestNotification (1 ms)
    ✓ should handle errors in sendFriendRequestAcceptedNotification (1 ms)
    ✓ should handle multicast with all failures (1 ms)
    ✓ should include data payload in multicast notification (1 ms)

🌐 TMDB ⬅️  GET /movie/300017 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.606Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300017,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300018 params={"language":"en-US","api_key":"***"}
PASS tests/unit/comparisonSession.unit.test.ts
  Comparison Session Utility
    startSession
      ✓ should create a new session with correct initial values (3 ms)
      ✓ should overwrite existing session for same user (1 ms)
      ✓ should handle movie without posterPath
    getSession
      ✓ should return session for existing user
      ✓ should return undefined for non-existent user
    updateSession
      ✓ should update session low and high values
      ✓ should not affect newMovie when updating (1 ms)
      ✓ should handle updating to same values
      ✓ should handle non-existent session gracefully
      ✓ should return early when session does not exist
    endSession
      ✓ should delete existing session (3 ms)
      ✓ should handle deleting non-existent session gracefully
      ✓ should only delete specified user session
    Integration scenarios
      ✓ should handle complete comparison workflow (1 ms)
      ✓ should handle multiple concurrent users

[2m[2025-10-29T06:53:59.629Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:53:59.629Z][0m [32mSUCCESS[0m All SSE connections closed
[2m[2025-10-29T06:53:59.629Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:53:59.629Z][0m [32mSUCCESS[0m All SSE connections closed
[2m[2025-10-29T06:53:59.629Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:53:59.629Z][0m [32mSUCCESS[0m All SSE connections closed
[2m[2025-10-29T06:53:59.630Z][0m [36mINFO[0m Closing all SSE connections...
[2m[2025-10-29T06:53:59.630Z][0m [32mSUCCESS[0m All SSE connections closed
[2m[2025-10-29T06:53:59.632Z][0m [36mINFO[0m Sign in attempt for email: test@example.com
PASS tests/unmocked/sseService.unmocked.test.ts
  SSE Service Tests
    ✓ should add client for new user (1 ms)
    ✓ should add multiple clients for same user (1 ms)
    ✓ should add clients for different users
    ✓ should auto-remove client when connection closes
    ✓ should remove client manually
    ✓ should delete user entry when last client is removed (1 ms)
    ✓ should handle removing client from non-existent user
    ✓ should send event to existing client
    ✓ should handle sending to non-existent user
    ✓ should send event to all clients of same user
    ✓ should skip sending to closed connection
    ✓ should skip sending to destroyed connection (1 ms)
    ✓ should remove client when write throws error
    ✓ should remove only failed clients and keep working ones
    ✓ should clear all connections
    ✓ should handle clearing already-closed connections
    ✓ should handle clearing destroyed connections
    ✓ should handle errors during clear (1 ms)
    ✓ should serialize various data types correctly (1 ms)
    ✓ should format event name correctly
    ✓ should handle multiple sends to same client
    ✓ should handle complex nested data structures
    ✓ should handle concurrent add and remove operations (1 ms)
    ✓ should handle empty event name
    ✓ should handle special characters in data

[2m[2025-10-29T06:53:59.635Z][0m [36mINFO[0m Sign in attempt for email: test@example.com
[2m[2025-10-29T06:53:59.639Z][0m [36mINFO[0m Sign up attempt for email: existing@example.com
[2m[2025-10-29T06:53:59.639Z][0m [33mWARN[0m Sign up failed: user already exists for existing@example.com
[2m[2025-10-29T06:53:59.641Z][0m [36mINFO[0m Sign up attempt for email: newuser@example.com
PASS tests/mocked/auth.mocked.test.ts
  Mocked: POST /auth/signin
    ✓ should handle Google token verification error (5 ms)
    ✓ should handle database error during signin (3 ms)
    ✓ should handle JWT generation failure (2 ms)
    ✓ should successfully sign in with valid credentials (2 ms)
  Mocked: POST /auth/signup
    ✓ should handle database duplicate key error (3 ms)
    ✓ should handle database write failure (3 ms)
    ✓ should reject invalid Google token during signup (2 ms)
    ✓ should successfully sign up with valid credentials (2 ms)
  Mocked: POST /auth/signout
    ✓ should reject signout with tampered JWT (2 ms)
    ✓ should reject signout with expired token (5 ms)
  Mocked: DELETE /auth/account
    ✓ should handle cascading delete failure (5 ms)
    ✓ should reject deletion with invalid token signature (2 ms)

🌐 TMDB ⬅️  GET /movie/300018 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.675Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300018,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300019 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300019 ERROR 111ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.786Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300019,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300020 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300020 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.856Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300020,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300021 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300021 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.925Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300021,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300022 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300022 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:53:59.995Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300022,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300023 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300023 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.064Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300023,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300024 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300024 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.135Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 300024,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300000/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.204Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300001/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.273Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300002/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.344Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300003/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.413Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300004/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.483Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300005/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.553Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300006/similar params={"language":"en-US","page":1,"api_key":"***"}
PASS tests/mocked/movieRoutes.mocked.test.ts
  Movie Routes - Mocked Tests
    GET /search
      ✓ should search movies successfully (1176 ms)
      ✓ should reject query shorter than 2 characters (136 ms)
      ✓ should search with includeCast parameter (7 ms)
      ✓ should handle Chinese characters and fallback to zh-CN (6 ms)
      ✓ should handle CJK search when detail fetch fails (7 ms)
      ✓ should handle empty results (6 ms)
      ✓ should handle TMDB API errors (6 ms)
      ✓ should return 500 when TMDB API key not configured (5 ms)
      ✓ should handle cast enrichment API failure (7 ms)
    GET /ranked
      ✓ should get ranked movies (13 ms)
      ✓ should return empty array when no ranked movies (7 ms)
      ✓ should handle database error gracefully (8 ms)
    POST /rank
      ✓ should rank movie successfully (22 ms)
      ✓ should enrich missing overview and poster from TMDB (14 ms)
      ✓ should create feed activity when ranking (18 ms)
      ✓ should handle TMDB enrichment failure gracefully (19 ms)
      ✓ should notify friends via SSE when ranking (20 ms)
      ✓ should handle database error gracefully (8 ms)
    DELETE /ranked/:id
      ✓ should delete ranked movie and resequence ranks (19 ms)
      ✓ should reject invalid ID format (6 ms)
      ✓ should return 404 for non-existent movie (9 ms)
      ✓ should delete related feed activities (12 ms)
      ✓ should handle database error gracefully (7 ms)
    GET /:movieId/providers
      ✓ should get watch providers successfully (6 ms)
      ✓ should use fallback link when no provider link (6 ms)
      ✓ should reject invalid movie ID (6 ms)
      ✓ should return 500 when TMDB API key not configured (8 ms)
      ✓ should handle TMDB API error gracefully (7 ms)
    GET /:movieId/details
      ✓ should get movie details with cast (7 ms)
      ✓ should reject invalid movie ID (6 ms)
      ✓ should return 500 when TMDB API key not configured (6 ms)
      ✓ should handle TMDB API error gracefully (5 ms)
    GET /:movieId/videos
      ✓ should get official trailer (6 ms)
      ✓ should fallback to non-official trailer (5 ms)
      ✓ should fallback to teaser when no trailer available (5 ms)
      ✓ should return null when no videos available (7 ms)
      ✓ should reject invalid movie ID (22 ms)
      ✓ should return 500 when TMDB API key not configured (6 ms)
      ✓ should handle TMDB API error gracefully (6 ms)

🌐 TMDB ⬅️  GET /movie/300006/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.622Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300007/similar params={"language":"en-US","page":1,"api_key":"***"}
PASS tests/mocked/authService.mocked.test.ts
  AuthService - Mocked Tests
    ✓ should verify valid Google token successfully (8 ms)
    ✓ should throw error when token payload missing email (13 ms)
    ✓ should throw error when token payload missing sub (2 ms)
    ✓ should throw error when token payload is null (1 ms)
    ✓ should throw error when token verification fails
    ✓ should use email as name when name is missing (1 ms)
    ✓ should sign in existing user successfully (476 ms)
    ✓ should throw error when user not found (150 ms)
    ✓ should fail signin when Google token is invalid (1 ms)
    ✓ should create new user successfully (8 ms)
    ✓ should throw error when user already exists (5 ms)
    ✓ should fail signup when Google token is invalid (1 ms)
    ✓ should generate valid JWT token (1 ms)
    ✓ should generate unique tokens for different users (7 ms)
    ✓ should set token expiration to 30 days (4 ms)
    ✓ should handle signup without picture (4 ms)
    ✓ should return JWT token on successful signin (2 ms)
    ✓ should handle multiple signin attempts for same user (1005 ms)
    ✓ should create user with all Google profile fields (4 ms)
    ✓ should handle empty token string (2 ms)
    ✓ should use default secret when JWT_SECRET not provided (1 ms)
    ✓ should handle undefined fields in payload gracefully (1 ms)

🌐 TMDB ⬅️  GET /movie/300007/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.692Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300008/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300008/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.763Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300009/similar params={"language":"en-US","page":1,"api_key":"***"}
PASS tests/unmocked/rerankAdvanced.unmocked.test.ts
  Advanced Rerank Controller Tests
    ✓ should rerank movie from middle to top position (37 ms)
    ✓ should rerank movie from middle to bottom position (18 ms)
    ✓ should handle rerank with 10 movies (20 ms)
    ✓ should handle rerank with 20 movies (24 ms)
    ✓ should rerank movie from top position (12 ms)
    ✓ should rerank movie from bottom position (8 ms)
    ✓ should handle rerank with invalid format movieId (2 ms)
    ✓ should reject rerank of another users movie (4 ms)
    ✓ should handle compare without active rerank session (3 ms)
    ✓ should handle rerank start without movieId (4 ms)
    ✓ should handle compare with invalid preferredMovieId (10 ms)
    ✓ should handle multiple sequential rerank sessions (14 ms)
    ✓ should handle rerank with only 2 movies (8 ms)
    ✓ should reject unauthorized rerank request (4 ms)
    ✓ should reject unauthorized rerank compare (2 ms)
    ✓ should handle rerank where movie stays at same position (10 ms)
    ✓ should handle rerank with 15 movies (17 ms)
    ✓ should handle reranking all movies one by one (20 ms)
    ✓ should handle compare with missing preferredMovieId field (8 ms)
    ✓ should handle rerank with 7 movies (balanced binary tree) (10 ms)

🌐 TMDB ⬅️  GET /movie/300009/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.834Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300000/recommendations ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.903Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300001/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:00.974Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300002/recommendations params={"page":1,"api_key":"***"}
PASS tests/mocked/recommendationController.mocked.test.ts
  Recommendation Controller - Mocked Tests
    GET /trending
      ✓ should return trending movies successfully (446 ms)
      ✓ should return empty array when no trending movies (144 ms)
      ✓ should return empty array when TMDB returns no data (6 ms)
      ✓ should limit results to 20 movies (5 ms)
      ✓ should handle null/undefined movie fields (4 ms)
      ✓ should handle TMDB API error (4 ms)
    GET /
      ✓ should return empty array when user has no ranked movies (5 ms)
      ✓ should analyze preferences and return recommendations (8 ms)
      ✓ should handle discover API failure gracefully (6 ms)
      ✓ should handle similar movies API failure gracefully (6 ms)
      ✓ should handle recommendations API failure gracefully (5 ms)
      ✓ should return empty array when all API sources fail (4 ms)
      ✓ should filter out already seen movies (6 ms)
      ✓ should deduplicate recommendations from multiple sources (6 ms)
      ✓ should score movies based on genre matching (5 ms)
      ✓ should handle preference analysis failures gracefully (4 ms)
      ✓ should limit final recommendations to 20 movies (5 ms)
      ✓ should handle database error gracefully (32 ms)
      ✓ should calculate top 50% of ranked movies for preferences (14 ms)
      ✓ should handle discover recommendations failure gracefully (7 ms)

🌐 TMDB ⬅️  GET /movie/300002/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.043Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300003/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.115Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300004/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.185Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300005/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300005/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.259Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300006/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300006/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.330Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/300007/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/300007/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.399Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 300007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.490Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.561Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.635Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.708Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.778Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.851Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400000 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.930Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400001 ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:54:01.997Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400002 params={"language":"en-US","api_key":"***"}
PASS tests/unmocked/watchlist.unmocked.test.ts (9.195 s)
  Unmocked: GET /watchlist
    ✓ should return user watchlist (15 ms)
    ✓ should return empty watchlist (4 ms)
    ✓ should reject unauthenticated watchlist request (2 ms)
  Unmocked: POST /watchlist
    ✓ should successfully add movie to watchlist (12 ms)
    ✓ should reject duplicate watchlist item (6 ms)
    ✓ should reject incomplete watchlist entry (2 ms)
  Unmocked: DELETE /watchlist/:movieId
    ✓ should successfully remove movie from watchlist (7 ms)
    ✓ should reject removal of non-existent watchlist item (3 ms)

🌐 TMDB ⬅️  GET /movie/400002 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.070Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400003 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.142Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 400003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400000/similar params={"language":"en-US","page":1,"api_key":"***"}
PASS tests/unmocked/quoteRoutes.unmocked.test.ts
  Quote Routes - Unmocked Tests
    GET /
      ✓ should fetch tagline with title and year (343 ms)
      ✓ should fetch tagline with title only (96 ms)
      ✓ should reject request with missing title (6 ms)
      ✓ should reject request with empty title (5 ms)
      ✓ should return 404 when no tagline found (4 ms)
      ✓ should handle service errors gracefully (4 ms)
      ✓ should trim title whitespace (4 ms)
      ✓ should handle title with special characters (5 ms)
      ✓ should handle empty year parameter (4 ms)
      ✓ should require authentication (3 ms)

🌐 TMDB ⬅️  GET /movie/400000/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.211Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 400000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400001/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.282Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 400001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400002/similar ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.351Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 400002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400000/recommendations params={"page":1,"api_key":"***"}
FAIL tests/unmocked/friendRoutesDetailed.unmocked.test.ts
  Friend Routes Detailed Endpoints
    ✓ should get detailed pending requests (24 ms)
    ✓ should get empty detailed pending requests (4 ms)
    ✓ should get multiple detailed pending requests (8 ms)
    ✓ should get outgoing friend requests (6 ms)
    ✓ should get empty outgoing requests (5 ms)
    ✓ should get multiple outgoing requests (8 ms)
    ✓ should get detailed outgoing requests (6 ms)
    ✓ should get empty detailed outgoing requests (3 ms)
    ✓ should get multiple detailed outgoing requests (5 ms)
    ✓ should handle multiple rapid friend requests (14 ms)
    ✓ should accept friend request with accept boolean (13 ms)
    ✓ should reject friend request with accept boolean (6 ms)
    ✓ should reject respond from non-receiver (5 ms)
    ✓ should reject respond to already accepted request (4 ms)
    ✓ should get friends list with population (7 ms)
    ✓ should reject unauthorized detailed requests (3 ms)
    ✓ should reject unauthorized outgoing requests (2 ms)
    ✓ should reject unauthorized outgoing detailed requests (2 ms)
    ✓ should handle reverse pending request scenario (6 ms)
    ✓ should create bilateral friendships on accept (10 ms)
    ✓ should handle delete with invalid friendId (4 ms)
    ✕ should validate email format in friend request (66 ms)
    ✓ should enforce rate limiting on friend requests (13 ms)

  ● Friend Routes Detailed Endpoints › should validate email format in friend request

    socket hang up



🌐 TMDB ⬅️  GET /movie/400000/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.424Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 400000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400001/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.493Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 400001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/400002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/400002/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.565Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 400002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500000 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.644Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500001 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.716Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500002 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.788Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500003 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.856Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500004 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.929Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500005 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:02.997Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 500005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500000/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.067Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 500000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500001/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.135Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 500001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500002/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.205Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 500002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500003/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.277Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 500003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500000/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.348Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 500000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500001/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.421Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 500001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/500002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/500002/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.492Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 500002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600000 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.576Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600001 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.645Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600002 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.714Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600003 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.785Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600004 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.854Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600005 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.924Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600006 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:03.997Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600007 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.070Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600008 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.138Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600009 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600009 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.212Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600010 params={"language":"en-US","api_key":"***"}
PASS tests/unmocked/friends.unmocked.test.ts (12.801 s)
  Unmocked: GET /friends
    ✓ should return user friends list (28 ms)
    ✓ should return empty friends list for isolated user (5 ms)
    ✓ should reject unauthenticated friends request (2 ms)
  Unmocked: GET /friends/requests
    ✓ should return pending friend requests (5 ms)
  Unmocked: POST /friends/request
    ✓ should successfully send friend request (13 ms)
    ✓ should reject request to non-existent user (6 ms)
    ✓ should reject self-friend request (5 ms)
    ✓ should reject request to existing friend (7 ms)
    ✓ should reject duplicate pending request (9 ms)
  Unmocked: POST /friends/respond
    ✓ should successfully accept friend request (12 ms)
    ✓ should successfully reject friend request (5 ms)
  Unmocked: DELETE /friends/:friendId
    ✓ should successfully remove friend (6 ms)
    ✓ should reject removal of non-existent friend (3 ms)

🌐 TMDB ⬅️  GET /movie/600010 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.284Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600011 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.355Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600012 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600012 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.428Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 600012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600000/similar params={"language":"en-US","page":1,"api_key":"***"}
PASS tests/unmocked/feed.unmocked.test.ts (12.896 s)
  Unmocked: GET /feed
    ✓ should return feed activities from friends (236 ms)
    ✓ should return empty feed for user with no friends (13 ms)
    ✓ should reject unauthenticated feed request (4 ms)
  Unmocked: POST /feed/:activityId/like
    ✓ should successfully like an activity (79 ms)
    ✓ should reject like on non-existent activity (5 ms)
    ✓ should reject duplicate like on same activity (8 ms)
  Unmocked: GET /feed/:activityId/comments
    ✓ should return comments for activity (31 ms)
    ✓ should return empty array for activity with no comments (3 ms)
  Unmocked: POST /feed/:activityId/comments
    ✓ should successfully post a comment (24 ms)
    ✓ should reject empty comment (3 ms)
    ✓ should reject comment exceeding 500 characters (2 ms)

🌐 TMDB ⬅️  GET /movie/600000/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.498Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600001/similar ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.572Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600002/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.643Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600003/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.717Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600004/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.790Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600005/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.862Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600006/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600006/similar ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.928Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600007/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600007/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:04.997Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600000/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.071Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600001/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.142Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600002/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.217Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600003/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.287Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/600004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/600004/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.359Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 600004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700000 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.457Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700001 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.528Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700002 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.599Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700003 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.672Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700004 ERROR 76ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.749Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700005 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.824Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700006 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.895Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700007 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:05.964Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700008 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.035Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700009 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700009 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.107Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700010 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700010 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.177Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700011 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.246Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700012 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700012 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.315Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700013 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700013 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.388Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700013,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700014 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700014 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.460Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 700014,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700000/similar ERROR 102ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.566Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700001/similar ERROR 77ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.644Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700002/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.716Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700003/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.789Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700004/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.862Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700005/similar ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.929Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700006/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700006/similar ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:06.999Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700007/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700007/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.067Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700008/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700008/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.136Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700000/recommendations ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.206Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700001/recommendations ERROR 76ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.283Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700002/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.355Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700003/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.425Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700004/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.497Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/700005/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/700005/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.571Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 700005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800000 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800000 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.715Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800001 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800001 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.785Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800002 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800002 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.854Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800003 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800003 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.928Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800004 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800004 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:07.999Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800005 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800005 ERROR 66ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.065Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800006 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800006 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.136Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800007 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800007 ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.206Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800008 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800008 ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.273Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800009 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800009 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.345Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800010 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800010 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.418Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800010,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800011 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800011 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.492Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800011,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800012 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800012 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.563Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800012,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800013 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800013 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.634Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800013,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800014 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800014 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.708Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800014,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800015 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800015 ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.782Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800015,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800016 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800016 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.852Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800016,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800017 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800017 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.922Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800017,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800018 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800018 ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:08.991Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800018,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800019 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800019 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.061Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 800019,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800000/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800000/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.132Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800001/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800001/similar ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.204Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800002/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800002/similar ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.278Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800003/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800003/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.350Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800004/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800004/similar ERROR 116ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.467Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800005/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800005/similar ERROR 68ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.536Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800006/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800006/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.609Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800007/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800007/similar ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.684Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800008/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800008/similar ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.760Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800008,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800009/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800009/similar ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.832Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800009,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800000/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800000/recommendations ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.905Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800000,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800001/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800001/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:09.978Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800001,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800002/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800002/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.051Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800002,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800003/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800003/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.122Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800003,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800004/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800004/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.192Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800004,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800005/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800005/recommendations ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.262Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800005,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800006/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800006/recommendations ERROR 76ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.341Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800006,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/800007/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/800007/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.411Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 800007,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.498Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 75ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.574Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.645Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /trending/movie/week ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.718Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /trending/movie/week params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /trending/movie/week ERROR 127ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.849Z][0m [31mERROR[0m Trending movies error {
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.930Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:54:10.997Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba120322118f12772465",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 74ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.071Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba120322118f12772465",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205 ERROR 70ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.149Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238 ERROR 72ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.222Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278 params={"language":"en-US","api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278 ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.296Z][0m [33mWARN[0m Failed to fetch TMDB details for preference analysis {
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/similar ERROR 67ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.363Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.433Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/similar params={"language":"en-US","page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/similar ERROR 69ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.502Z][0m [33mWARN[0m Failed to fetch similar movies {
  "userId": "6901ba000322118f1277228b",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/27205/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/27205/recommendations ERROR 71ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.574Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 27205,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/238/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/238/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.649Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 238,
  "error": "Request failed with status code 401"
}
🌐 TMDB ➡️  GET /movie/278/recommendations params={"page":1,"api_key":"***"}
🌐 TMDB ⬅️  GET /movie/278/recommendations ERROR 73ms: Request failed with status code 401
[2m[2025-10-29T06:54:11.723Z][0m [33mWARN[0m Failed to fetch TMDB recommendations {
  "userId": "6901ba000322118f1277228b",
  "movieId": 278,
  "error": "Request failed with status code 401"
}
PASS tests/unmocked/recommendationController.unmocked.test.ts (20.509 s)
  Recommendation Controller Direct Tests
    ✓ should handle recommendations with 1 ranked movie (262 ms)
    ✓ should handle recommendations with 3 ranked movies (654 ms)
    ✓ should handle recommendations with many ranked movies (1220 ms)
    ✓ should handle recommendations with 5 ranked movies (943 ms)
    ✓ should handle recommendations with 20 ranked movies (1493 ms)
    ✓ should handle recommendations with 50 ranked movies (3120 ms)
    ✓ should handle recommendations with 2 ranked movies (449 ms)
    ✓ should handle recommendations with 7 ranked movies (714 ms)
    ✓ should handle recommendations with 12 ranked movies (927 ms)
    ✓ should handle recommendations with 25 ranked movies (1868 ms)
    ✓ should handle recommendations with 30 ranked movies (2221 ms)
    ✓ should handle recommendations with 40 ranked movies (2832 ms)
    ✓ should handle recommendations with limit param (231 ms)
    ✓ should get trending movies (74 ms)
    ✓ should get trending movies without query params (131 ms)
    ✓ should handle recommendations for different user (222 ms)
    ✓ should handle recommendations with varied movie IDs (652 ms)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
-----------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------
File                               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                 
-----------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------
All files                          |   90.57 |     72.8 |   91.87 |   91.14 |                                                                   
 src                               |   26.31 |    35.29 |       0 |   26.31 |                                                                   
  config.ts                        |   26.31 |    35.29 |       0 |   26.31 | 8-28,34,36                                                        
 src/controllers                   |   95.65 |    71.79 |     100 |   95.36 |                                                                   
  movieComparisionController.ts    |   96.12 |       70 |     100 |   95.86 | 23,26,36,154,183                                                  
  rerankController.ts              |   93.75 |    77.77 |     100 |   93.33 | 10,46                                                             
 src/controllers/auth              |   97.05 |    69.23 |     100 |   96.66 |                                                                   
  authController.ts                |   97.05 |    69.23 |     100 |   96.66 | 83                                                                
 src/controllers/recommendations   |   98.52 |    72.36 |     100 |   98.47 |                                                                   
  movieRecommendationController.ts |   98.52 |    72.36 |     100 |   98.47 | 108,135                                                           
 src/middleware                    |     100 |    66.66 |     100 |     100 |                                                                   
  auth.ts                          |     100 |    66.66 |     100 |     100 | 19                                                                
 src/models/feed                   |     100 |      100 |     100 |     100 |                                                                   
  Comment.ts                       |     100 |      100 |     100 |     100 |                                                                   
  FeedActivity.ts                  |     100 |      100 |     100 |     100 |                                                                   
  Like.ts                          |     100 |      100 |     100 |     100 |                                                                   
 src/models/friend                 |     100 |      100 |     100 |     100 |                                                                   
  Friend.ts                        |     100 |      100 |     100 |     100 |                                                                   
 src/models/movie                  |     100 |      100 |     100 |     100 |                                                                   
  RankedMovie.ts                   |     100 |      100 |     100 |     100 |                                                                   
 src/models/user                   |     100 |      100 |     100 |     100 |                                                                   
  User.ts                          |     100 |      100 |     100 |     100 |                                                                   
 src/models/watch                  |     100 |      100 |     100 |     100 |                                                                   
  WatchlistItem.ts                 |     100 |      100 |     100 |     100 |                                                                   
 src/routes                        |   88.21 |    72.95 |   86.84 |   89.41 |                                                                   
  authRoutes.ts                    |     100 |      100 |     100 |     100 |                                                                   
  feedRoutes.ts                    |   81.68 |    62.02 |   81.48 |   85.63 | 38-42,154-158,172-173,185-186,201-202,255,442-464                 
  friendRoutes.ts                  |   80.83 |    77.77 |   81.25 |   80.24 | 173-180,252-258,278,305-321,327-347                               
  movieRoutes.ts                   |   99.45 |    73.22 |   95.65 |     100 | 20,52-60,71-93,114,194,200-201,327-328,374-387,411                
  quoteRoutes.ts                   |     100 |      100 |     100 |     100 |                                                                   
  recommendationRoutes.ts          |     100 |      100 |     100 |     100 |                                                                   
  userRoutes.ts                    |   82.08 |    88.23 |   83.33 |   82.08 | 114-120,126-134                                                   
  watchlistRoutes.ts               |     100 |    85.71 |     100 |     100 | 51-52                                                             
 src/services                      |      80 |       58 |     100 |      80 |                                                                   
  notification.service.ts          |      80 |       58 |     100 |      80 | 34,38,51-67,81-82,133-134,169,183-184,215,233-234,286-287,344-345 
 src/services/auth                 |     100 |      100 |     100 |     100 |                                                                   
  authService.ts                   |     100 |      100 |     100 |     100 |                                                                   
 src/services/sse                  |     100 |      100 |     100 |     100 |                                                                   
  sseService.ts                    |     100 |      100 |     100 |     100 |                                                                   
 src/services/tmdb                 |   98.59 |    84.44 |     100 |     100 |                                                                   
  tmdbClient.ts                    |   97.56 |       80 |     100 |     100 | 8,41-44,54                                                        
  tmdbTaglineService.ts            |     100 |    93.33 |     100 |     100 | 41                                                                
 src/utils                         |   97.82 |      100 |   94.11 |     100 |                                                                   
  asyncHandler.ts                  |      80 |      100 |   66.66 |     100 |                                                                   
  comparisonSession.ts             |     100 |      100 |     100 |     100 |                                                                   
  logger.ts                        |     100 |      100 |     100 |     100 |                                                                   
-----------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------

=============================== Coverage summary ===============================
Statements   : 90.57% ( 1259/1390 )
Branches     : 72.8% ( 407/559 )
Functions    : 91.87% ( 147/160 )
Lines        : 91.14% ( 1214/1332 )
================================================================================
Summary of all failing tests
FAIL tests/unmocked/rerankController.unmocked.test.ts (10.084 s)
  ● Rerank Controller - Complete Coverage › should handle reranking immediately after ranking

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      529 |       .send({ rankedId: (movie as any)._id.toString() });
      530 |
    > 531 |     expect(res.status).toBe(200);
          |                        ^
      532 |     expect(res.body.status).toBe('added');
      533 |   });
      534 |

      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:531:24)

  ● Rerank Controller - Complete Coverage › should handle movie with special characters in title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

  ● Rerank Controller - Complete Coverage › should handle rerank of movie with very long title

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await RankedMovie.deleteMany({});
         |     ^
      40 |   });
      41 |
      42 |   // ========== Invalid rankedId Validation ==========

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/rerankController.unmocked.test.ts:39:5)

FAIL tests/unmocked/movieComparisonController.unmocked.test.ts (11.886 s)
  ● Movie Comparison Controller - Complete Coverage › should reject comparison without active session

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      354 |       });
      355 |
    > 356 |     expect(res.status).toBe(400);
          |                        ^
      357 |     expect(res.body.message).toContain('No active comparison');
      358 |   });
      359 |

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:356:24)

  ● Movie Comparison Controller - Complete Coverage › should finalize ranking when low > high

    expect(received).toBe(expected) // Object.is equality

    Expected: "added"
    Received: "compare"

      490 |       });
      491 |
    > 492 |     expect(res.body.status).toBe('added');
          |                             ^
      493 |     const movie = await RankedMovie.findOne({
      494 |       userId: user1._id,
      495 |       movieId: 200000

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:492:29)

  ● Movie Comparison Controller - Complete Coverage › should update ranks when finalizing

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 2

      533 |
      534 |     const movies = await RankedMovie.find({ userId: user1._id }).sort({ rank: 1 });
    > 535 |     expect(movies.length).toBe(3);
          |                           ^
      536 |   });
      537 |
      538 |   it('should create feed activity when finalizing', async () => {

      at Object.<anonymous> (tests/unmocked/movieComparisonController.unmocked.test.ts:535:27)

FAIL tests/unmocked/allRecommendationRoutes.unmocked.test.ts (12.856 s)
  ● Comprehensive Recommendation Routes Tests › should handle recommendation errors gracefully

    ValidationError: RankedMovie validation failed: movieId: Path `movieId` is required., title: Path `title` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1416:9

FAIL tests/unmocked/friendRoutesAdvanced.unmocked.test.ts
  ● Advanced Friend Routes Tests › should remove bilateral friendships on delete

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

      114 |     const count2 = await Friendship.countDocuments({ userId: user2._id, friendId: user1._id });
      115 |
    > 116 |     expect(count1).toBe(0);
          |                    ^
      117 |     expect(count2).toBe(0);
      118 |   });
      119 |

      at Object.<anonymous> (tests/unmocked/friendRoutesAdvanced.unmocked.test.ts:116:20)

FAIL tests/unmocked/movieComparison.unmocked.test.ts (14.103 s)
  ● Unmocked: POST /movies/rank › should reject missing required fields

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      150 |       });
      151 |
    > 152 |     expect(res.status).toStrictEqual(400);
          |                        ^
      153 |   });
      154 |
      155 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:152:24)

  ● Unmocked: POST /movies/compare › should reject comparison without preferredMovieId

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      300 |       .send({});
      301 |
    > 302 |     expect(res.status).toStrictEqual(400);
          |                        ^
      303 |   });
      304 |
      305 |   // Input: No active comparison session

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:302:24)

  ● Unmocked: POST /movies/compare › should reject comparison without active session

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 200

      315 |       });
      316 |
    > 317 |     expect(res.status).toStrictEqual(400);
          |                        ^
      318 |   });
      319 |
      320 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/movieComparison.unmocked.test.ts:317:24)

FAIL tests/mocked/apis.mocked.test.ts
  ● Mocked: Friends API Errors › should handle friends list fetch failure

    Database connection failed

       98 |   it('should handle friends list fetch failure', async () => {
       99 |     jest.spyOn(Friendship, 'find').mockRejectedValueOnce(
    > 100 |       new Error('Database connection failed')
          |       ^
      101 |     );
      102 |
      103 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:100:7)

  ● Mocked: Watchlist API Errors › should handle watchlist fetch failure

    Database connection lost

      163 |   it('should handle watchlist fetch failure', async () => {
      164 |     jest.spyOn(WatchlistItem, 'find').mockRejectedValueOnce(
    > 165 |       new Error('Database connection lost')
          |       ^
      166 |     );
      167 |
      168 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:165:7)

  ● Mocked: Recommendations API Errors › should handle recommendations generation failure

    Property `find` does not exist in the provided object

      244 |   // Expected output: Error message
      245 |   it('should handle recommendations generation failure', async () => {
    > 246 |     jest.spyOn(require('../../src/models/movie/RankedMovie'), 'find')
          |          ^
      247 |       .mockRejectedValueOnce(new Error('Database error'));
      248 |
      249 |     const res = await request(app)

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:246:10)

  ● Mocked: User API Errors › should handle profile update failure

    Database write failed

      273 |   it('should handle profile update failure', async () => {
      274 |     jest.spyOn(User, 'findByIdAndUpdate').mockRejectedValueOnce(
    > 275 |       new Error('Database write failed')
          |       ^
      276 |     );
      277 |
      278 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:275:7)

  ● Mocked: User API Errors › should handle FCM token registration failure

    Database write failed

      291 |   it('should handle FCM token registration failure', async () => {
      292 |     jest.spyOn(User, 'findByIdAndUpdate').mockRejectedValueOnce(
    > 293 |       new Error('Database write failed')
          |       ^
      294 |     );
      295 |
      296 |     const res = await request(app)

      at Object.<anonymous> (tests/mocked/apis.mocked.test.ts:293:7)

FAIL tests/mocked/tmdbServices.mocked.test.ts
  ● TMDB Client Tests › should log outgoing request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ➡️"

    Number of calls: 0

      140 |     getTmdbClient();
      141 |
    > 142 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      143 |       expect.stringContaining('TMDB ➡️')
      144 |     );
      145 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:142:27)

  ● TMDB Client Tests › should redact API key in request logs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "***"

    Number of calls: 0

      167 |     getTmdbClient();
      168 |
    > 169 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      170 |       expect.stringContaining('***')
      171 |     );
      172 |     expect(consoleLogSpy).not.toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:169:27)

  ● TMDB Client Tests › should log successful response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "TMDB ⬅️"

    Number of calls: 0

      201 |     responseInterceptor(mockResponse);
      202 |
    > 203 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      204 |       expect.stringContaining('TMDB ⬅️')
      205 |     );
      206 |     expect(consoleLogSpy).toHaveBeenCalledWith(

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:203:27)

  ● TMDB Client Tests › should calculate and log response time

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringMatching /\d+ms/

    Number of calls: 0

      235 |     responseInterceptor(mockResponse);
      236 |
    > 237 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      238 |       expect.stringMatching(/\d+ms/)
      239 |     );
      240 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:237:27)

  ● TMDB Client Tests › should log error response

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "ERROR"

    Number of calls: 0

      266 |     expect(() => errorInterceptor(mockError)).toThrow();
      267 |
    > 268 |     expect(consoleLogSpy).toHaveBeenCalledWith(
          |                           ^
      269 |       expect.stringContaining('ERROR')
      270 |     );
      271 |   });

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:268:27)

  ● TMDB Client Tests › should handle error without config

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      292 |
      293 |     expect(() => errorInterceptor(mockError)).toThrow();
    > 294 |     expect(consoleLogSpy).toHaveBeenCalled();
          |                           ^
      295 |   });
      296 | });
      297 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:294:27)

  ● TMDB Tagline Service Tests › should treat titles as case-insensitive for caching

    expect(received).toBe(expected) // Object.is equality

    Expected: "Cached"
    Received: "An amazing movie"

      519 |     const tagline = await fetchMovieTagline('TEST MOVIE', 2024);
      520 |
    > 521 |     expect(tagline).toBe('Cached');
          |                     ^
      522 |     expect(mockClient.get).toHaveBeenCalledTimes(2);
      523 |   });
      524 |

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:521:21)

  ● TMDB Tagline Service Tests › should handle year as string parameter

    expect(received).toBe(expected) // Object.is equality

    Expected: "String year"
    Received: "New tagline"

      570 |     const tagline = await fetchMovieTagline('Movie', '2024');
      571 |
    > 572 |     expect(tagline).toBe('String year');
          |                     ^
      573 |   });
      574 |
      575 |   // Test Case 23: Trim whitespace from title

      at Object.<anonymous> (tests/mocked/tmdbServices.mocked.test.ts:572:21)

FAIL tests/unit/logger.unit.test.ts
  ● Logger Utility › info › should log info message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      23 |       logger.info('Test info message');
      24 |
    > 25 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      26 |       const call = consoleLogSpy.mock.calls[0][0];
      27 |       expect(call).toContain('INFO');
      28 |       expect(call).toContain('Test info message');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:25:29)

  ● Logger Utility › info › should log info message with arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      32 |       logger.info('User logged in', { userId: '123', email: 'test@example.com' });
      33 |
    > 34 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      35 |       const call = consoleLogSpy.mock.calls[0][0];
      36 |       expect(call).toContain('INFO');
      37 |       expect(call).toContain('User logged in');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:34:29)

  ● Logger Utility › info › should handle multiple arguments

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      43 |       logger.info('Multiple args', 'arg1', 123, true);
      44 |
    > 45 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      46 |       const call = consoleLogSpy.mock.calls[0][0];
      47 |       expect(call).toContain('arg1');
      48 |       expect(call).toContain('123');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:45:29)

  ● Logger Utility › success › should log success message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      55 |       logger.success('Operation completed');
      56 |
    > 57 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      58 |       const call = consoleLogSpy.mock.calls[0][0];
      59 |       expect(call).toContain('SUCCESS');
      60 |       expect(call).toContain('Operation completed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:57:29)

  ● Logger Utility › success › should log success with object data

    TypeError: Cannot read properties of undefined (reading '0')

      64 |       logger.success('Movie ranked', { movieId: 550, rank: 1 });
      65 |
    > 66 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      67 |       expect(call).toContain('SUCCESS');
      68 |       expect(call).toContain('Movie ranked');
      69 |       expect(call).toContain('movieId');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:66:47)

  ● Logger Utility › warn › should log warning message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      75 |       logger.warn('API rate limit approaching');
      76 |
    > 77 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      78 |       const call = consoleLogSpy.mock.calls[0][0];
      79 |       expect(call).toContain('WARN');
      80 |       expect(call).toContain('API rate limit approaching');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:77:29)

  ● Logger Utility › warn › should log warning with details

    TypeError: Cannot read properties of undefined (reading '0')

      84 |       logger.warn('Slow query detected', { duration: 5000, query: 'complex query' });
      85 |
    > 86 |       const call = consoleLogSpy.mock.calls[0][0];
         |                                               ^
      87 |       expect(call).toContain('WARN');
      88 |       expect(call).toContain('Slow query detected');
      89 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:86:47)

  ● Logger Utility › error › should log error message

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      94 |       logger.error('Database connection failed');
      95 |
    > 96 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
         |                             ^
      97 |       const call = consoleLogSpy.mock.calls[0][0];
      98 |       expect(call).toContain('ERROR');
      99 |       expect(call).toContain('Database connection failed');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:96:29)

  ● Logger Utility › error › should log error with error object

    TypeError: Cannot read properties of undefined (reading '0')

      104 |       logger.error('Unexpected error', { error: error.message, stack: 'stack trace' });
      105 |
    > 106 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      107 |       expect(call).toContain('ERROR');
      108 |       expect(call).toContain('Unexpected error');
      109 |       expect(call).toContain('Something went wrong');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:106:47)

  ● Logger Utility › debug › should log debug message in development mode

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      117 |       logger.debug('Debug information');
      118 |
    > 119 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      120 |       const call = consoleLogSpy.mock.calls[0][0];
      121 |       expect(call).toContain('DEBUG');
      122 |       expect(call).toContain('Debug information');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:119:29)

  ● Logger Utility › debug › should log debug with detailed data in development

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      147 |       });
      148 |
    > 149 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      150 |       const call = consoleLogSpy.mock.calls[0][0];
      151 |       expect(call).toContain('DEBUG');
      152 |       expect(call).toContain('State dump');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:149:29)

  ● Logger Utility › http › should log HTTP request with all parameters

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      158 |       logger.http('GET', '/api/movies', 200, 45);
      159 |
    > 160 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      161 |       const call = consoleLogSpy.mock.calls[0][0];
      162 |       expect(call).toContain('GET');
      163 |       expect(call).toContain('/api/movies');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:160:29)

  ● Logger Utility › http › should log HTTP request without status code

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      169 |       logger.http('POST', '/api/auth/signin');
      170 |
    > 171 |       expect(consoleLogSpy).toHaveBeenCalledTimes(1);
          |                             ^
      172 |       const call = consoleLogSpy.mock.calls[0][0];
      173 |       expect(call).toContain('POST');
      174 |       expect(call).toContain('/api/auth/signin');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:171:29)

  ● Logger Utility › http › should log HTTP request without duration

    TypeError: Cannot read properties of undefined (reading '0')

      178 |       logger.http('DELETE', '/api/friends/123', 204);
      179 |
    > 180 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      181 |       expect(call).toContain('DELETE');
      182 |       expect(call).toContain('/api/friends/123');
      183 |       expect(call).toContain('204');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:180:47)

  ● Logger Utility › http › should handle successful status codes (200-399)

    TypeError: Cannot read properties of undefined (reading '0')

      187 |       logger.http('GET', '/api/users', 200, 10);
      188 |
    > 189 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      190 |       expect(call).toContain('200');
      191 |     });
      192 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:189:47)

  ● Logger Utility › http › should handle error status codes (400+)

    TypeError: Cannot read properties of undefined (reading '0')

      194 |       logger.http('POST', '/api/movies', 404, 20);
      195 |
    > 196 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      197 |       expect(call).toContain('404');
      198 |     });
      199 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:196:47)

  ● Logger Utility › http › should handle server error status codes (500+)

    TypeError: Cannot read properties of undefined (reading '0')

      201 |       logger.http('GET', '/api/recommendations', 500, 100);
      202 |
    > 203 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      204 |       expect(call).toContain('500');
      205 |       expect(call).toContain('100ms');
      206 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:203:47)

  ● Logger Utility › http › should handle various HTTP methods

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 3
    Received number of calls: 0

      211 |       logger.http('HEAD', '/api/health', 200);
      212 |
    > 213 |       expect(consoleLogSpy).toHaveBeenCalledTimes(3);
          |                             ^
      214 |       expect(consoleLogSpy.mock.calls[0][0]).toContain('PUT');
      215 |       expect(consoleLogSpy.mock.calls[1][0]).toContain('PATCH');
      216 |       expect(consoleLogSpy.mock.calls[2][0]).toContain('HEAD');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:213:29)

  ● Logger Utility › Timestamp formatting › should include ISO timestamp in all log messages

    TypeError: Cannot read properties of undefined (reading '0')

      222 |       logger.info('Test message');
      223 |
    > 224 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      225 |       // ISO format: YYYY-MM-DDTHH:mm:ss.sssZ
      226 |       expect(call).toMatch(/\[\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z\]/);
      227 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:224:47)

  ● Logger Utility › Argument formatting › should format string arguments

    TypeError: Cannot read properties of undefined (reading '0')

      232 |       logger.info('Message', 'string arg');
      233 |
    > 234 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      235 |       expect(call).toContain('string arg');
      236 |     });
      237 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:234:47)

  ● Logger Utility › Argument formatting › should format number arguments

    TypeError: Cannot read properties of undefined (reading '0')

      239 |       logger.info('Message', 42, 3.14);
      240 |
    > 241 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      242 |       expect(call).toContain('42');
      243 |       expect(call).toContain('3.14');
      244 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:241:47)

  ● Logger Utility › Argument formatting › should format boolean arguments

    TypeError: Cannot read properties of undefined (reading '0')

      247 |       logger.info('Message', true, false);
      248 |
    > 249 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      250 |       expect(call).toContain('true');
      251 |       expect(call).toContain('false');
      252 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:249:47)

  ● Logger Utility › Argument formatting › should format object arguments as JSON

    TypeError: Cannot read properties of undefined (reading '0')

      255 |       logger.info('Message', { key: 'value', nested: { data: 123 } });
      256 |
    > 257 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      258 |       expect(call).toContain('"key"');
      259 |       expect(call).toContain('"value"');
      260 |       expect(call).toContain('"nested"');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:257:47)

  ● Logger Utility › Argument formatting › should format array arguments

    TypeError: Cannot read properties of undefined (reading '0')

      264 |       logger.info('Message', [1, 2, 3]);
      265 |
    > 266 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      267 |       expect(call).toContain('[');
      268 |       expect(call).toContain('1');
      269 |       expect(call).toContain('2');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:266:47)

  ● Logger Utility › Argument formatting › should handle null and undefined arguments

    TypeError: Cannot read properties of undefined (reading '0')

      274 |       logger.info('Message', null, undefined);
      275 |
    > 276 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      277 |       expect(call).toContain('null');
      278 |       expect(call).toContain('undefined');
      279 |     });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:276:47)

  ● Logger Utility › Argument formatting › should handle empty object

    TypeError: Cannot read properties of undefined (reading '0')

      282 |       logger.info('Message', {});
      283 |
    > 284 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      285 |       expect(call).toContain('{}');
      286 |     });
      287 |

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:284:47)

  ● Logger Utility › Argument formatting › should handle empty array

    TypeError: Cannot read properties of undefined (reading '0')

      289 |       logger.info('Message', []);
      290 |
    > 291 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      292 |       expect(call).toContain('[]');
      293 |     });
      294 |   });

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:291:47)

  ● Logger Utility › Integration scenarios › should handle rapid sequential log calls

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 4
    Received number of calls: 0

      301 |       logger.error('Message 4');
      302 |
    > 303 |       expect(consoleLogSpy).toHaveBeenCalledTimes(4);
          |                             ^
      304 |     });
      305 |
      306 |     it('should handle complex nested objects', () => {

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:303:29)

  ● Logger Utility › Integration scenarios › should handle complex nested objects

    TypeError: Cannot read properties of undefined (reading '0')

      321 |       logger.info('Complex data', complexObject);
      322 |
    > 323 |       const call = consoleLogSpy.mock.calls[0][0];
          |                                               ^
      324 |       expect(call).toContain('Complex data');
      325 |       expect(call).toContain('user');
      326 |       expect(call).toContain('profile');

      at Object.<anonymous> (tests/unit/logger.unit.test.ts:323:47)

FAIL tests/mocked/movie.mocked.test.ts
  ● Mocked: GET /movies/search - TMDB API Failure › should return empty array for no matching results

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      75 |       .query({ query: 'xyz123nonexistent' });
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      79 |   });
      80 |

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:77:24)

  ● Mocked: Movie Comparison and Addition - Database Failures › should reject duplicate movie ranking

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      153 |       });
      154 |
    > 155 |     expect(res.status).toStrictEqual(400);
          |                        ^
      156 |     findOneySpy.mockRestore();
      157 |   });
      158 | });

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:155:24)

  ● Mocked: GET /movies/ranked - Database Query Failure › should handle ranked movies query failure

    Database connection lost

      175 |   it('should handle ranked movies query failure', async () => {
      176 |     const findSpy = jest.spyOn(RankedMovie, 'find')
    > 177 |       .mockRejectedValueOnce(new Error('Database connection lost'));
          |                              ^
      178 |
      179 |     const res = await request(app)
      180 |       .get('/api/movies/ranked')

      at Object.<anonymous> (tests/mocked/movie.mocked.test.ts:177:30)

FAIL tests/unmocked/userRoutes.unmocked.test.ts
  ● User Routes - Unmocked Tests › GET /:userId › should get user by ID successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      420 |         .set('Authorization', `Bearer ${token1}`);
      421 |
    > 422 |       expect(res.status).toBe(200);
          |                          ^
      423 |       expect(res.body.success).toBe(true);
      424 |       expect(res.body.data._id).toBe((user2 as any)._id.toString());
      425 |       expect(res.body.data.email).toBe(user2.email);

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:422:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle user not found

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

      445 |
      446 |       expect(res.status).toBe(404);
    > 447 |       expect(res.body.success).toBe(false);
          |                                ^
      448 |       expect(res.body.message).toContain('not found');
      449 |     });
      450 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:447:32)

  ● User Routes - Unmocked Tests › GET /:userId › should return selected fields only

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      454 |         .set('Authorization', `Bearer ${token1}`);
      455 |
    > 456 |       expect(res.status).toBe(200);
          |                          ^
      457 |       expect(res.body.data).toHaveProperty('_id');
      458 |       expect(res.body.data).toHaveProperty('email');
      459 |       expect(res.body.data).toHaveProperty('name');

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:456:26)

  ● User Routes - Unmocked Tests › GET /:userId › should handle database error gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 404

      469 |         .set('Authorization', `Bearer ${token1}`);
      470 |
    > 471 |       expect(res.status).toBe(500);
          |                          ^
      472 |       expect(res.body.success).toBe(false);
      473 |       expect(res.body.message).toContain('Unable to load user');
      474 |

      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:471:26)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should get user watchlist successfully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return empty array for user with no watchlist items

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should sort watchlist by createdAt descending

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should reject invalid user ID format

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should return watchlist even for non-existent user (empty array)

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

  ● User Routes - Unmocked Tests › GET /:userId/watchlist › should handle database error gracefully

    MongoNotConnectedError: Client must be connected before running operations

      37 |
      38 |   beforeEach(async () => {
    > 39 |     await User.deleteMany({});
         |     ^
      40 |     await WatchlistItem.deleteMany({});
      41 |
      42 |     user1 = await User.create({

      at autoConnect (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:135:13)
      at executeOperation (node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts:69:25)
      at Collection.deleteMany (node_modules/mongoose/node_modules/mongodb/src/collection.ts:458:34)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)
      at model.Query._deleteMany (node_modules/mongoose/lib/query.js:3286:34)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4627:80)
      at Object.<anonymous> (tests/unmocked/userRoutes.unmocked.test.ts:39:5)

FAIL tests/unmocked/userProfile.unmocked.test.ts (15.918 s)
  ● Unmocked: PUT /users/profile › should update user profile name

    TypeError: Cannot read properties of undefined (reading 'name')

      47 |
      48 |     expect(res.status).toStrictEqual(200);
    > 49 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      50 |
      51 |     const updatedUser = await User.findById(user._id);
      52 |     expect(updatedUser!.name).toStrictEqual(newName);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:49:26)

  ● Unmocked: PUT /users/profile › should update user profile image

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      64 |       .send({ profileImageUrl: newImageUrl });
      65 |
    > 66 |     expect(res.status).toStrictEqual(200);
         |                        ^
      67 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      68 |
      69 |     const updatedUser = await User.findById(user._id);

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:66:24)

  ● Unmocked: PUT /users/profile › should update multiple profile fields

    TypeError: Cannot read properties of undefined (reading 'name')

      88 |
      89 |     expect(res.status).toStrictEqual(200);
    > 90 |     expect(res.body.user.name).toStrictEqual(newName);
         |                          ^
      91 |     expect(res.body.user.profileImageUrl).toStrictEqual(newImageUrl);
      92 |   });
      93 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:90:26)

  ● Unmocked: GET /users/profile/:userId › should get user profile by ID

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      283 |       .set('Authorization', `Bearer ${token}`);
      284 |
    > 285 |     expect(res.status).toStrictEqual(200);
          |                        ^
      286 |     expect(res.body.user).toBeDefined();
      287 |     expect(res.body.user.email).toStrictEqual(otherUser.email);
      288 |   });

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:285:24)

  ● Unmocked: GET /users/profile/:userId › should get own profile

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      297 |       .set('Authorization', `Bearer ${token}`);
      298 |
    > 299 |     expect(res.status).toStrictEqual(200);
          |                        ^
      300 |     expect(res.body.user.email).toStrictEqual(user.email);
      301 |   });
      302 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:299:24)

  ● Unmocked: GET /users/profile/:userId › should reject invalid user ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      323 |       .set('Authorization', `Bearer ${token}`);
      324 |
    > 325 |     expect(res.status).toStrictEqual(400);
          |                        ^
      326 |   });
      327 |
      328 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:325:24)

  ● Unmocked: GET /users/profile/:userId › should reject unauthenticated profile request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      334 |       .get(`/api/users/profile/${otherUser._id}`);
      335 |
    > 336 |     expect(res.status).toStrictEqual(401);
          |                        ^
      337 |   });
      338 | });
      339 |

      at Object.<anonymous> (tests/unmocked/userProfile.unmocked.test.ts:336:24)

FAIL tests/mocked/friendRoutes.mocked.test.ts
  ● Friend Routes - Mocked Error Tests › POST /request error handling › should handle notification service failure gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      194 |
      195 |       // Should still succeed even if notification fails
    > 196 |       expect(res.status).toBe(200);
          |                          ^
      197 |       expect(res.body.success).toBe(true);
      198 |     });
      199 |   });

      at Object.<anonymous> (tests/mocked/friendRoutes.mocked.test.ts:196:26)

FAIL tests/unmocked/quote.unmocked.test.ts
  ● Unmocked: GET /quotes › should return quote for movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      45 |       .query({ title: 'Inception' });
      46 |
    > 47 |     expect(res.status).toStrictEqual(200);
         |                        ^
      48 |     expect(res.body).toHaveProperty('quote');
      49 |   });
      50 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:47:24)

  ● Unmocked: GET /quotes › should return fallback quote for unknown movie

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      59 |       .query({ title: 'NonexistentMoviexyz123' });
      60 |
    > 61 |     expect(res.status).toStrictEqual(200);
         |                        ^
      62 |     expect(res.body).toHaveProperty('quote');
      63 |   });
      64 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:61:24)

  ● Unmocked: GET /quotes › should reject unauthenticated quote request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      72 |       .query({ title: 'Inception' });
      73 |
    > 74 |     expect(res.status).toStrictEqual(401);
         |                        ^
      75 |   });
      76 |
      77 |   // Input: Missing title query parameter

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:74:24)

  ● Unmocked: GET /quotes › should reject quote request without title

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      84 |       .set('Authorization', `Bearer ${token}`);
      85 |
    > 86 |     expect(res.status).toStrictEqual(400);
         |                        ^
      87 |   });
      88 | });
      89 |

      at Object.<anonymous> (tests/unmocked/quote.unmocked.test.ts:86:24)

FAIL tests/unmocked/watchlistOperations.unmocked.test.ts (16.333 s)
  ● Unmocked: POST /watchlist - Additional Tests › should add movie to watchlist with all fields

    expect(received).toBeDefined()

    Received: undefined

      61 |     expect(res.status).toStrictEqual(201);
      62 |     expect(res.body.success).toStrictEqual(true);
    > 63 |     expect(res.body.watchlistItem).toBeDefined();
         |                                    ^
      64 |     expect(res.body.watchlistItem.movieId).toStrictEqual(mockMovies.inception.id);
      65 |
      66 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:63:36)

  ● Unmocked: POST /watchlist - Additional Tests › should reject duplicate movie in watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      119 |       });
      120 |
    > 121 |     expect(res.status).toStrictEqual(400);
          |                        ^
      122 |     expect(res.body.message).toMatch(/already|watchlist/i);
      123 |   });
      124 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:121:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing year

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      171 |       });
      172 |
    > 173 |     expect(res.status).toStrictEqual(400);
          |                        ^
      174 |   });
      175 |
      176 |   // Input: Missing posterUrl

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:173:24)

  ● Unmocked: POST /watchlist - Additional Tests › should reject missing posterUrl

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 201

      188 |       });
      189 |
    > 190 |     expect(res.status).toStrictEqual(400);
          |                        ^
      191 |   });
      192 |
      193 |   // Input: No authentication

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:190:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      296 |       .set('Authorization', `Bearer ${token}`);
      297 |
    > 298 |     expect(res.status).toStrictEqual(200);
          |                        ^
      299 |     expect(res.body.success).toStrictEqual(true);
      300 |
      301 |     const watchlistItem = await WatchlistItem.findOne({

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:298:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should delete only specified movie from watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      343 |       .set('Authorization', `Bearer ${token}`);
      344 |
    > 345 |     expect(res.status).toStrictEqual(200);
          |                        ^
      346 |
      347 |     const deletedItem = await WatchlistItem.findOne({
      348 |       userId: user._id,

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:345:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should reject unauthenticated delete request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 401
    Received: 404

      366 |       .delete(`/api/watchlist/${mockMovies.inception.id}`);
      367 |
    > 368 |     expect(res.status).toStrictEqual(401);
          |                        ^
      369 |   });
      370 |
      371 |   // Input: Invalid movieId format

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:368:24)

  ● Unmocked: DELETE /watchlist/:movieId - Additional Tests › should handle invalid movieId format

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [400, 404]

      378 |       .set('Authorization', `Bearer ${token}`);
      379 |
    > 380 |     expect([400, 404]).toContain(res.status);
          |                        ^
      381 |   });
      382 | });
      383 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:380:24)

  ● Unmocked: GET /watchlist - Additional Tests › should get multiple watchlist items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      443 |
      444 |     expect(res.status).toStrictEqual(200);
    > 445 |     expect(Array.isArray(res.body.watchlist || res.body)).toBe(true);
          |                                                           ^
      446 |     const watchlist = res.body.watchlist || res.body;
      447 |     expect(watchlist.length).toStrictEqual(2);
      448 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:445:59)

  ● Unmocked: GET /watchlist - Additional Tests › should return only authenticated user watchlist

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 1
    Received: undefined

      475 |     expect(res.status).toStrictEqual(200);
      476 |     const watchlist = res.body.watchlist || res.body;
    > 477 |     expect(watchlist.length).toStrictEqual(1);
          |                              ^
      478 |     expect(watchlist[0].movieId).toStrictEqual(mockMovies.inception.id);
      479 |   });
      480 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:477:30)

  ● Unmocked: GET /watchlist - Additional Tests › should return empty array for empty watchlist

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      490 |     expect(res.status).toStrictEqual(200);
      491 |     const watchlist = res.body.watchlist || res.body;
    > 492 |     expect(Array.isArray(watchlist)).toBe(true);
          |                                      ^
      493 |     expect(watchlist.length).toStrictEqual(0);
      494 |   });
      495 |

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:492:38)

  ● Unmocked: GET /watchlist - Additional Tests › should return complete movie details in watchlist

    TypeError: Cannot read properties of undefined (reading 'title')

      527 |     expect(res.status).toStrictEqual(200);
      528 |     const watchlist = res.body.watchlist || res.body;
    > 529 |     expect(watchlist[0].title).toStrictEqual(mockMovies.inception.title);
          |                         ^
      530 |     expect(watchlist[0].year).toStrictEqual(mockMovies.inception.year);
      531 |     expect(watchlist[0].rating).toStrictEqual(mockMovies.inception.rating);
      532 |   });

      at Object.<anonymous> (tests/unmocked/watchlistOperations.unmocked.test.ts:529:25)

FAIL tests/unmocked/watchlistRoutes.unmocked.test.ts
  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle very long movie titles

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      521 |         });
      522 |
    > 523 |       expect(res.status).toBe(200);
          |                          ^
      524 |       expect(res.body.data.title).toBe(longTitle);
      525 |     });
      526 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:523:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle special characters in title

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      536 |         });
      537 |
    > 538 |       expect(res.status).toBe(200);
          |                          ^
      539 |       expect(res.body.data.title).toBe(specialTitle);
      540 |     });
      541 |

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:538:26)

  ● Watchlist Routes - Unmocked Tests › Edge Cases › should handle large movieId numbers

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 201

      565 |         });
      566 |
    > 567 |       expect(res.status).toBe(200);
          |                          ^
      568 |       expect(res.body.data.movieId).toBe(largeId);
      569 |     });
      570 |   });

      at Object.<anonymous> (tests/unmocked/watchlistRoutes.unmocked.test.ts:567:26)

FAIL tests/unmocked/movie.unmocked.test.ts (17.951 s)
  ● Unmocked: GET /movies/search › should return search results for valid movie query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 500

      46 |       .query({ query: 'Inception' });
      47 |
    > 48 |     expect(res.status).toStrictEqual(200);
         |                        ^
      49 |     expect(Array.isArray(res.body.results || res.body)).toBe(true);
      50 |   });
      51 |

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:48:24)

  ● Unmocked: DELETE /movies/ranked/:id › should delete ranked movie and adjust ranks

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      216 |       .set('Authorization', `Bearer ${token}`);
      217 |
    > 218 |     expect(res.status).toStrictEqual(200);
          |                        ^
      219 |
      220 |     // Verify movie is deleted
      221 |     const remaining = await RankedMovie.find({ userId: user._id });

      at Object.<anonymous> (tests/unmocked/movie.unmocked.test.ts:218:24)

FAIL tests/unmocked/auth.unmocked.test.ts (19.376 s)
  ● Unmocked: POST /auth/signin › should successfully sign in an existing user

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      63 |       });
      64 |
    > 65 |     expect(res.status).toStrictEqual(200);
         |                        ^
      66 |     expect(res.body).toHaveProperty('user');
      67 |     expect(res.body).toHaveProperty('token');
      68 |     expect(res.body.user.email).toStrictEqual('test@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:65:24)

  ● Unmocked: POST /auth/signin › should reject signin for non-existent user

    expect(received).toMatch(expected)

    Expected pattern: /not found|error/i
    Received string:  "Invalid Google token"

      101 |
      102 |     expect([400, 404]).toContain(res.status);
    > 103 |     expect(res.body.message).toMatch(/not found|error/i);
          |                              ^
      104 |   });
      105 | });
      106 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:103:30)

  ● Unmocked: POST /auth/signup › should successfully create a new user account

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 201
    Received: 400

      143 |       });
      144 |
    > 145 |     expect(res.status).toStrictEqual(201);
          |                        ^
      146 |     expect(res.body).toHaveProperty('user');
      147 |     expect(res.body).toHaveProperty('token');
      148 |     expect(res.body.user.email).toStrictEqual('newuser@example.com');

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:145:24)

  ● Unmocked: POST /auth/signup › should reject signup with existing email

    expect(received).toMatch(expected)

    Expected pattern: /already exists|duplicate/i
    Received string:  "Invalid Google token"

      194 |
      195 |     expect(res.status).toStrictEqual(400);
    > 196 |     expect(res.body.message).toMatch(/already exists|duplicate/i);
          |                              ^
      197 |   });
      198 | });
      199 |

      at Object.<anonymous> (tests/unmocked/auth.unmocked.test.ts:196:30)

FAIL tests/nfr/performance.test.ts (19.6 s)
  ● NFR: Performance - Response Time › should respond to GET /movies/ranked within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      60 |     const responseTime = Date.now() - startTime;
      61 |
    > 62 |     expect(res.status).toStrictEqual(200);
         |                        ^
      63 |     expect(responseTime).toBeLessThan(ACCEPTABLE_RESPONSE_TIME_MS);
      64 |   });
      65 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:62:24)

  ● NFR: Performance - Response Time › should sign out user within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      75 |     const responseTime = Date.now() - startTime;
      76 |
    > 77 |     expect(res.status).toStrictEqual(200);
         |                        ^
      78 |     expect(responseTime).toBeLessThan(500);
      79 |   });
      80 |

      at Object.<anonymous> (tests/nfr/performance.test.ts:77:24)

  ● NFR: Performance - Response Time › should limit feed results to prevent memory bloat

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      117 |       .set('Authorization', `Bearer ${token}`);
      118 |
    > 119 |     expect(res.status).toStrictEqual(200);
          |                        ^
      120 |     expect(Array.isArray(res.body)).toBe(true);
      121 |     // Feed should limit results, verify it's not unbounded
      122 |     expect(res.body.length).toBeLessThanOrEqual(50);

      at Object.<anonymous> (tests/nfr/performance.test.ts:119:24)

  ● NFR: Performance - Database Index Efficiency › should efficiently fetch ranked movies using indexes

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      166 |     const queryTime = Date.now() - startTime;
      167 |
    > 168 |     expect(res.status).toStrictEqual(200);
          |                        ^
      169 |     expect(Array.isArray(res.body)).toBe(true);
      170 |     expect(res.body.length).toBe(100);
      171 |     // With proper indexing, 100 items should still be fast

      at Object.<anonymous> (tests/nfr/performance.test.ts:168:24)

  ● NFR: Performance - Bulk Operations › should complete cascade delete within acceptable time

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      236 |     const deleteTime = Date.now() - startTime;
      237 |
    > 238 |     expect(res.status).toStrictEqual(200);
          |                        ^
      239 |     expect(deleteTime).toBeLessThan(ACCEPTABLE_BULK_TIME_MS);
      240 |   });
      241 | });

      at Object.<anonymous> (tests/nfr/performance.test.ts:238:24)

FAIL tests/unmocked/friendOperations.unmocked.test.ts (19.685 s)
  ● Unmocked: POST /friends/request - Additional Tests › should reject duplicate friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      104 |       .send({ email: user2.email });
      105 |
    > 106 |     expect(res.status).toStrictEqual(400);
          |                        ^
      107 |     expect(res.body.message).toMatch(/already|pending/i);
      108 |   });
      109 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:106:24)

  ● Unmocked: POST /friends/request - Additional Tests › should reject request to existing friend

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 409

      124 |       .send({ email: user2.email });
      125 |
    > 126 |     expect(res.status).toStrictEqual(400);
          |                        ^
      127 |     expect(res.body.message).toMatch(/already.*friend/i);
      128 |   });
      129 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:126:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should accept friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      209 |       });
      210 |
    > 211 |     expect(res.status).toStrictEqual(200);
          |                        ^
      212 |     expect(res.body.success).toStrictEqual(true);
      213 |
      214 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:211:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should reject friend request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 400

      241 |       });
      242 |
    > 243 |     expect(res.status).toStrictEqual(200);
          |                        ^
      244 |     expect(res.body.success).toStrictEqual(true);
      245 |
      246 |     const friendship = await Friendship.findOne({

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:243:24)

  ● Unmocked: POST /friends/respond - Additional Tests › should return 404 for non-existent request

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 404
    Received: 400

      284 |       });
      285 |
    > 286 |     expect(res.status).toStrictEqual(404);
          |                        ^
      287 |   });
      288 |
      289 |   // Input: Missing requestId

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:286:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject invalid friend ID format

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 500

      407 |       .set('Authorization', `Bearer ${token1}`);
      408 |
    > 409 |     expect(res.status).toStrictEqual(400);
          |                        ^
      410 |   });
      411 |
      412 |   // Input: Remove self as friend

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:409:24)

  ● Unmocked: DELETE /friends/:friendId - Additional Tests › should reject removing self

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      419 |       .set('Authorization', `Bearer ${token1}`);
      420 |
    > 421 |     expect(res.status).toStrictEqual(400);
          |                        ^
      422 |   });
      423 | });
      424 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:421:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by email

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      463 |       .query({ query: 'searchable' });
      464 |
    > 465 |     expect(res.status).toStrictEqual(200);
          |                        ^
      466 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      467 |   });
      468 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:465:24)

  ● Unmocked: GET /friends/search - Search Users › should search users by name

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      477 |       .query({ query: 'Searchable' });
      478 |
    > 479 |     expect(res.status).toStrictEqual(200);
          |                        ^
      480 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      481 |   });
      482 |

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:479:24)

  ● Unmocked: GET /friends/search - Search Users › should reject empty search query

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 400
    Received: 404

      491 |       .query({ query: '' });
      492 |
    > 493 |     expect(res.status).toStrictEqual(400);
          |                        ^
      494 |   });
      495 |
      496 |   // Input: Search with no matches

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:493:24)

  ● Unmocked: GET /friends/search - Search Users › should return empty array for no matches

    expect(received).toStrictEqual(expected) // deep equality

    Expected: 200
    Received: 404

      504 |       .query({ query: 'nonexistentuser12345' });
      505 |
    > 506 |     expect(res.status).toStrictEqual(200);
          |                        ^
      507 |     expect(Array.isArray(res.body.users || res.body)).toBe(true);
      508 |   });
      509 | });

      at Object.<anonymous> (tests/unmocked/friendOperations.unmocked.test.ts:506:24)

FAIL tests/unmocked/feedRouteHandlers.unmocked.test.ts (22.625 s)
  ● Feed Route Handlers - Inline Handlers › should establish SSE stream

    thrown: "Exceeded timeout of 10000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      289 |
      290 |   // Test Case 12: GET /stream (SSE)
    > 291 |   it('should establish SSE stream', async () => {
          |   ^
      292 |     const res = await request(app)
      293 |       .get('/api/feed/stream')
      294 |       .set('Authorization', `Bearer ${token1}`)

      at tests/unmocked/feedRouteHandlers.unmocked.test.ts:291:3
      at Object.<anonymous> (tests/unmocked/feedRouteHandlers.unmocked.test.ts:19:1)

FAIL tests/unmocked/friendRoutesDetailed.unmocked.test.ts
  ● Friend Routes Detailed Endpoints › should validate email format in friend request

    socket hang up




Test Suites: 21 failed, 20 passed, 41 total
Tests:       117 failed, 619 passed, 736 total
Snapshots:   0 total
Time:        36.521 s
Ran all test suites.
