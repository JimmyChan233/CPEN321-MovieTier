TEST CONSOLIDATION QUICK REFERENCE
==================================

TOTAL CONSOLIDATION POTENTIAL: ~30% reduction (7,700 → 5,500 lines)

TOP 5 CONSOLIDATION TARGETS
===========================

1. DUPLICATE FILE PAIRS (CRITICAL)
   - friendRoutesAdvanced.unmocked.test.ts (574 lines)
   + friendOperations.unmocked.test.ts (514 lines)
   = 1,088 lines → 700 lines (36% reduction)
   
   ACTION: Merge friendOperations into friendRoutesAdvanced, parameterize overlapping tests

2. MOVIE COMPARISON/RERANK FILES (CRITICAL)
   - movieComparisonController.unmocked.test.ts (711 lines)
   - movieComparisonAdvanced.unmocked.test.ts (260 lines)
   - rerankController.unmocked.test.ts (549 lines)
   - rerankAdvanced.unmocked.test.ts (187 lines)
   = 1,707 lines → 1,000 lines (41% reduction)
   
   ACTION: Keep main files, delete Advanced variants, parameterize edge cases

3. AUTHORIZATION TESTS (MULTIPLE FILES)
   Files: friendRoutesAdvanced, feed, auth, feedRouteHandlers
   = 15+ duplicate unauthorized tests
   
   ACTION: Create shared authorizationTests utility, 90% reduction

4. WATCHLIST OPERATIONS (MEDIUM PRIORITY)
   - watchlistRoutes.unmocked.test.ts (571 lines)
   - watchlistOperations.unmocked.test.ts (508 lines)
   = 1,079 lines → 800 lines (26% reduction)
   
   ACTION: Parameterize POST and DELETE operations

5. VALIDATION TESTS (MULTIPLE FILES)
   = 20+ nearly-identical validation tests
   
   ACTION: Parameterize all validation tests, 60% reduction

QUICK CONSOLIDATION BY EFFORT
=============================

LOW EFFORT (1-2 days):
- Extract shared database setup → ~1,500 lines saved
- Consolidate authorization tests → ~400 lines saved
- Merge error handling tests → ~200 lines saved
SUBTOTAL: ~2,100 lines

MEDIUM EFFORT (3-4 days):
- Merge friendOperations into friendRoutesAdvanced → ~400 lines saved
- Parameterize watchlist tests → ~250 lines saved
- Consolidate rerank validation → ~100 lines saved
SUBTOTAL: ~750 lines

HIGH EFFORT (4-5 days):
- Consolidate 4 movie comparison files → ~700 lines saved
- Review and optimize feed tests → ~250 lines saved
SUBTOTAL: ~950 lines

TOTAL POTENTIAL: ~3,800 lines (50% of codebase)
MORE REALISTIC TARGET: ~2,100 lines (30% reduction, Phase 1+2)

FILES TO DELETE
===============
1. movieComparisonAdvanced.unmocked.test.ts (260 lines) - REDUNDANT
2. rerankAdvanced.unmocked.test.ts (187 lines) - REDUNDANT
3. friendOperations.unmocked.test.ts (514 lines) - MERGE INTO friendRoutesAdvanced
4. watchlistOperations.unmocked.test.ts (508 lines) - MERGE INTO watchlistRoutes

TOTAL DELETIONS: 1,469 lines

TESTS WITH DUPLICATE PATTERNS
=============================

Friend Request Tests (6 duplicates):
- Send friend request by email
- Reject friend request to self
- Reject duplicate request
- Request to existing friend
- Missing email field
- Invalid email format

Friend Response Tests (5 duplicates):
- Accept friend request
- Reject friend request
- Non-existent request
- Missing requestId
- Missing accept field

Unauthorized Access Tests (15+ duplicates):
- Missing header → 401
- Invalid token → 401
- Expired token → 401
- Missing token → 401

Watchlist Add Tests (similar patterns):
- Add with all fields
- Add with minimal fields
- Missing movieId
- Missing title
- Duplicate handling

Validation Tests (20+ total):
- Missing rankedId tests (4)
- Invalid rankedId format (4)
- Invalid email tests (6)
- Invalid input type tests (6+)

PARAMETERIZATION EXAMPLES
=========================

Before:
it('should send friend request by email', ...);
it('should reject friend request to self', ...);
it('should reject duplicate request', ...);
it('should reject existing friend', ...);
(4 separate tests, ~40 lines)

After:
const cases = [
  { name: 'send by email', email: user2.email, status: 201 },
  { name: 'reject self', email: user1.email, status: 400 },
  { name: 'reject duplicate', setup: ..., email: user2.email, status: 409 },
  { name: 'reject existing friend', setup: ..., email: user2.email, status: 409 },
];
cases.forEach(c => it(`should ${c.name}`, ...));
(1 describe + loop, ~20 lines, 50% reduction)

IMPLEMENTATION ORDER
====================

PHASE 1 (Week 1) - Low Risk, Quick Wins
1. Create tests/utils/testSetup.ts
2. Create tests/utils/authorizationTests.ts
3. Create tests/utils/errorHandling.ts
4. Update all files to use shared utilities
ESTIMATED: 2-3 days, ~2,100 lines saved

PHASE 2 (Week 2) - Medium Risk, Good ROI
1. Merge friendOperations into friendRoutesAdvanced
2. Parameterize watchlist tests
3. Parameterize rerank validation tests
ESTIMATED: 3-4 days, ~750 lines saved

PHASE 3 (Week 3) - Highest Impact, More Complex
1. Consolidate 4 movie comparison files into 2
2. Merge/parameterize feed route tests
ESTIMATED: 4-5 days, ~950 lines saved

METRICS TO TRACK
================
- Lines of test code (target: 7,700 → 5,500)
- Number of test files (target: 18 → 14)
- Number of describe blocks (should increase slightly)
- Number of individual it() tests (should stay same or increase)
- Test execution time (should decrease)
- Code coverage % (should stay same or improve)

